{% extends "admin/base.html" %}

{% block title %}Статистика турниров{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h2 class="mb-4"><i class="bi bi-bar-chart"></i> Статистика турниров</h2>
            
            <!-- Общая статистика -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card text-center bg-primary text-white">
                        <div class="card-body">
                            <h3>{{ total_tournaments }}</h3>
                            <p class="mb-0">Всего турниров</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center bg-warning text-white">
                        <div class="card-body">
                            <h3>{{ scheduled_tournaments }}</h3>
                            <p class="mb-0">Запланировано</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center bg-success text-white">
                        <div class="card-body">
                            <h3>{{ ongoing_tournaments }}</h3>
                            <p class="mb-0">Идут сейчас</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center bg-secondary text-white">
                        <div class="card-body">
                            <h3>{{ completed_tournaments }}</h3>
                            <p class="mb-0">Завершено</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ближайшие турниры -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-calendar-check"></i> Ближайшие турниры
                            </h5>
                        </div>
                        <div class="card-body">
                            <h4>{{ upcoming_tournaments }}</h4>
                            <p class="text-muted">Турниров в ближайшие 30 дней</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <!-- По категориям -->
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-tags"></i> Турниры по категориям
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="list-group">
                                {% for category, count in category_stats.items() %}
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    {{ category }}
                                    <span class="badge bg-primary rounded-pill">{{ count }}</span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- По статусам -->
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-info-circle"></i> Турниры по статусам
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="list-group">
                                {% for status, count in status_stats.items() %}
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    {{ status }}
                                    <span class="badge bg-{% if status == 'Scheduled' %}warning{% elif status == 'Ongoing' %}success{% elif status == 'Completed' %}secondary{% else %}primary{% endif %} rounded-pill">{{ count }}</span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row mt-4">
                <!-- По месяцам -->
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-calendar-month"></i> Турниры по месяцам
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="list-group">
                                {% for month, count in monthly_stats.items() %}
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    {{ month }}
                                    <span class="badge bg-info rounded-pill">{{ count }}</span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Топ локаций -->
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-geo-alt"></i> Топ локаций
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="list-group">
                                {% for location, count in top_locations.items() %}
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    {{ location }}
                                    <span class="badge bg-success rounded-pill">{{ count }}</span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- График по времени -->
            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-graph-up"></i> Тренды турниров
                            </h5>
                        </div>
                        <div class="card-body">
                            <canvas id="tournamentsChart" height="100"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Подготавливаем данные для графика
    const monthNames = ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'];
    const monthData = Array(12).fill(0);
    
    {% for month, count in monthly_stats.items() %}
        monthData[{{ month[-1:] }} - 1] = {{ count }};
    {% endfor %}
    
    // Создаем график
    const ctx = document.getElementById('tournamentsChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: monthNames,
            datasets: [{
                label: 'Турниров по месяцам',
                data: monthData,
                borderColor: 'rgb(54, 162, 235)',
                backgroundColor: 'rgba(54, 162, 235, 0.1)',
                borderWidth: 2,
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        precision: 0
                    }
                }
            }
        }
    });
});
</script>
{% endblock %}