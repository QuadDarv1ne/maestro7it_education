# Новые функции ChessCalendar-RU

## Обзор последних обновлений

Этот документ описывает новые функции, добавленные в проект ChessCalendar-RU.

---

## 1. Расширенная система фильтрации (`static/js/filters.js`)

### Возможности
- **Множественные фильтры**: Категория, локация, диапазон дат, рейтинг, статус
- **Сохранение фильтров**: Автоматическое сохранение в localStorage
- **Сортировка**: По дате, рейтингу, названию, популярности
- **Статистика**: Отображение количества найденных турниров
- **Адаптивный UI**: Работает на всех устройствах

### Использование
```javascript
// Автоматическая инициализация при наличии #tournamentsContainer
const filters = new TournamentFilters();

// Программное применение фильтров
filters.filters.category = ['blitz', 'rapid'];
filters.applyFilters();
```

### API
- `applyFilters()` - применить текущие фильтры
- `clearAllFilters()` - сбросить все фильтры
- `saveFilters()` - сохранить в localStorage
- `sortTournaments(sortBy)` - сортировка результатов

---

## 2. Экспорт в календарь (iCal) (`app/utils/ical_export.py`)

### Возможности
- **Экспорт одного турнира**: Создание .ics файла для турнира
- **Экспорт нескольких турниров**: Календарь с множеством событий
- **Экспорт избранного**: Все избранные турниры пользователя
- **Напоминания**: Автоматическое напоминание за день до турнира
- **Совместимость**: Работает с Google Calendar, Apple Calendar, Outlook

### API Endpoints
```
GET /api/tournaments/{id}/export/ical
    - Экспорт одного турнира

GET /api/tournaments/export/ical?category=blitz&days=30
    - Экспорт турниров с фильтрами
    - Параметры: category, location, days

GET /api/users/{id}/favorites/export/ical
    - Экспорт избранных турниров пользователя
```

### Пример использования
```python
from app.utils.ical_export import ICalExporter

# Экспорт турнира
tournament = Tournament.query.get(1)
ical_content = ICalExporter.export_tournament(tournament)

# Экспорт списка турниров
tournaments = Tournament.query.all()
ical_content = ICalExporter.export_tournaments(tournaments)
```

### Формат iCal
- **VEVENT**: Каждый турнир как событие
- **VALARM**: Напоминание за день
- **CATEGORIES**: Категория турнира
- **LOCATION**: Место проведения
- **URL**: Ссылка на страницу турнира

---

## 3. Система достижений (`app/utils/achievements.py`)

### Типы достижений

#### Бронзовые (5-15 очков)
- **Первое избранное**: Добавить первый турнир в избранное
- **Первая оценка**: Оценить первый турнир
- **Ранняя пташка**: Подписаться на уведомления
- **Социальная бабочка**: Поделиться турниром

#### Серебряные (20-30 очков)
- **Коллекционер**: 10 турниров в избранном
- **Перфекционист**: 5 оценок по 5 звезд
- **Активный пользователь**: 7 дней использования

#### Золотые (30-50 очков)
- **Критик**: 20 оценок турниров
- **Ветеран**: 30 дней с момента регистрации

#### Платиновые (50+ очков)
- Специальные достижения для продвинутых пользователей

### Система уровней
- **Уровень**: Рассчитывается по очкам (50 очков = 1 уровень)
- **Прогресс**: Отображение до следующего уровня
- **Таблица лидеров**: Топ пользователей по очкам

### API Endpoints
```
GET /api/users/{id}/achievements
    - Получить все достижения пользователя
    - Возвращает: achievements[], stats{}

GET /api/achievements/leaderboard?limit=10
    - Таблица лидеров
    - Параметры: limit (1-100)
```

### Страница достижений
- URL: `/achievements`
- Вкладки: Все, Разблокированные, Заблокированные, Таблица лидеров
- Прогресс-кольцо с процентом выполнения
- Анимации при разблокировке

---

## 4. Встраиваемый виджет (`static/js/widget.js`)

### Возможности
- **Простая интеграция**: Один тег script
- **Настраиваемый**: Data-атрибуты для конфигурации
- **Адаптивный**: Работает на мобильных устройствах
- **Темы**: Светлая и темная
- **Фильтры**: По категории и локации

### Быстрый старт
```html
<div id="chess-calendar-widget"></div>
<script src="https://chesscalendar.ru/static/js/widget.js"></script>
```

### Настройка
```html
<div id="chess-calendar-widget" 
     data-category="blitz"
     data-location="Москва"
     data-limit="5"
     data-theme="dark"
     data-show-rating="true"
     data-compact="false">
</div>
<script src="https://chesscalendar.ru/static/js/widget.js"></script>
```

### Параметры
| Атрибут | Описание | По умолчанию |
|---------|----------|--------------|
| `data-category` | Фильтр по категории | все |
| `data-location` | Фильтр по локации | все |
| `data-limit` | Количество турниров (1-20) | 5 |
| `data-theme` | Тема (light, dark) | light |
| `data-show-rating` | Показывать рейтинг | true |
| `data-compact` | Компактный режим | false |

### Документация
- URL: `/widget`
- Живой предварительный просмотр
- Примеры кода
- Настройка в реальном времени

---

## 5. Дополнительные улучшения

### Обновленная навигация
- Ссылка на достижения в профиле пользователя
- Ссылка на виджет в футере
- Иконки для всех пунктов меню

### Новые маршруты
```python
/achievements - Страница достижений
/widget - Документация виджета
/offline - Офлайн страница для PWA
```

### Улучшенный профиль пользователя
- Вкладка с достижениями
- Статистика активности
- Экспорт избранного в календарь

---

## Интеграция с существующими функциями

### PWA
- Виджет работает офлайн через Service Worker
- Достижения кэшируются локально
- iCal файлы доступны офлайн

### Аналитика
- Отслеживание использования фильтров
- Статистика экспорта в календарь
- Метрики разблокировки достижений
- Использование виджета на внешних сайтах

### Темная тема
- Все новые компоненты поддерживают темную тему
- Виджет адаптируется к теме сайта
- Страница достижений с темной темой

---

## Производительность

### Оптимизации
- Ленивая загрузка достижений
- Кэширование фильтров
- Debouncing для фильтрации
- Минимальные запросы к API

### Размер файлов
- `filters.js`: ~8 KB
- `widget.js`: ~6 KB
- `achievements.py`: ~10 KB
- `ical_export.py`: ~8 KB

---

## Безопасность

### Меры защиты
- Валидация параметров виджета
- Escape HTML в виджете
- Проверка прав доступа для достижений
- Безопасная генерация iCal файлов

---

## Тестирование

### Покрытие тестами
- Все API endpoints протестированы
- Интеграционные тесты для iCal
- Unit тесты для достижений
- E2E тесты для виджета (планируется)

### Запуск тестов
```bash
python -m pytest test_app.py -v
```

---

## Будущие улучшения

### Планируется
1. **Достижения**
   - Больше типов достижений
   - Сезонные достижения
   - Командные достижения

2. **Виджет**
   - Больше тем оформления
   - Карусель турниров
   - Интерактивная карта

3. **Экспорт**
   - Экспорт в Google Calendar напрямую
   - Синхронизация с внешними календарями
   - Webhook уведомления

4. **Фильтры**
   - Сохраненные наборы фильтров
   - Умные рекомендации фильтров
   - Фильтры на основе истории

---

## Поддержка

### Документация
- API документация: `/api/docs`
- Виджет: `/widget`
- Достижения: `/achievements`

### Контакты
- Email: support@chesscalendar.ru
- Telegram: @chesscalendar_support
- GitHub: github.com/chesscalendar-ru

---

## Changelog

### v2.0.0 (Текущая версия)
- ✅ Расширенная система фильтрации
- ✅ Экспорт в календарь (iCal)
- ✅ Система достижений
- ✅ Встраиваемый виджет
- ✅ Обновленная навигация
- ✅ Улучшенный профиль

### v1.0.0 (Предыдущая версия)
- PWA с Service Worker
- Система аналитики
- Расширенный поиск
- Интерактивный календарь
- Темная тема
- Мобильная оптимизация

---

## Лицензия

MIT License - см. LICENSE файл

## Авторы

ChessCalendar-RU Development Team
