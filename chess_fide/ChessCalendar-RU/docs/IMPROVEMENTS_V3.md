# –£–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ Chess Calendar RU v2.2

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –§–∞–∑–∞ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ (v2.2)
‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

#### 1. –°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–°–æ–∑–¥–∞–Ω–æ**:
- `tests/conftest.py` - –û–±—â–∏–µ fixtures –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- `tests/unit/test_models.py` - Unit —Ç–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π
- `tests/unit/test_cache.py` - Unit —Ç–µ—Å—Ç—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- `tests/unit/test_celery_tasks.py` - Unit —Ç–µ—Å—Ç—ã Celery –∑–∞–¥–∞—á
- `tests/integration/test_api.py` - Integration —Ç–µ—Å—Ç—ã API
- `pytest.ini` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest
- `docs/TESTING.md` - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**:
- ‚úÖ Unit —Ç–µ—Å—Ç—ã –¥–ª—è –º–æ–¥–µ–ª–µ–π
- ‚úÖ Unit —Ç–µ—Å—Ç—ã –¥–ª—è –∫—ç—à–∞
- ‚úÖ Unit —Ç–µ—Å—Ç—ã –¥–ª—è Celery –∑–∞–¥–∞—á
- ‚úÖ Integration —Ç–µ—Å—Ç—ã –¥–ª—è API
- ‚úÖ Fixtures –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Mocking –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ Coverage –æ—Ç—á–µ—Ç—ã (HTML, XML, Terminal)
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π coverage 50%

**–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏**:
- –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–æ–≤
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (L1, L2, –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è)
- Celery –∑–∞–¥–∞—á–∏ (–ø–∞—Ä—Å–∏–Ω–≥, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
- API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

#### 2. –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–°–æ–∑–¥–∞–Ω–æ**: `app/utils/logger.py`

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**:
- ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** (JSON —Ñ–æ—Ä–º–∞—Ç)
- ‚úÖ **–¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥** –≤ –∫–æ–Ω—Å–æ–ª—å
- ‚úÖ **–†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤** (10MB, 10 —Ñ–∞–π–ª–æ–≤)
- ‚úÖ **–†–∞–∑–¥–µ–ª—å–Ω—ã–µ –ª–æ–≥–∏** (all, errors)
- ‚úÖ **Request logging** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **Celery logging** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á
- ‚úÖ **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** (user_id, request_id)

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
```python
# JSON formatter –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤
JSONFormatter()

# –¶–≤–µ—Ç–Ω–æ–π formatter –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏
ColoredFormatter()

# Request logger middleware
RequestLogger()

# Celery logger
CeleryLogger()
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```python
from app.utils.logger import get_logger

logger = get_logger('my_module')
logger.info('Message', extra={'user_id': 123})
logger.error('Error occurred', exc_info=True)
```

#### 3. Prometheus –º–µ—Ç—Ä–∏–∫–∏

**–°–æ–∑–¥–∞–Ω–æ**: `app/utils/metrics.py`

**–ú–µ—Ç—Ä–∏–∫–∏**:

**HTTP –º–µ—Ç—Ä–∏–∫–∏**:
- `http_requests_total` - –í—Å–µ–≥–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- `http_request_duration_seconds` - –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
- `http_requests_in_progress` - –ó–∞–ø—Ä–æ—Å—ã –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ

**Cache –º–µ—Ç—Ä–∏–∫–∏**:
- `cache_requests_total` - –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –∫—ç—à—É
- `cache_hits_total` - –ü–æ–ø–∞–¥–∞–Ω–∏—è –≤ –∫—ç—à
- `cache_misses_total` - –ü—Ä–æ–º–∞—Ö–∏ –∫—ç—à–∞
- `cache_size_bytes` - –†–∞–∑–º–µ—Ä –∫—ç—à–∞

**Database –º–µ—Ç—Ä–∏–∫–∏**:
- `db_queries_total` - –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- `db_query_duration_seconds` - –í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞
- `db_connections_active` - –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

**Celery –º–µ—Ç—Ä–∏–∫–∏**:
- `celery_tasks_total` - –í—Å–µ–≥–æ –∑–∞–¥–∞—á
- `celery_task_duration_seconds` - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `celery_active_tasks` - –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
- `celery_queue_length` - –î–ª–∏–Ω–∞ –æ—á–µ—Ä–µ–¥–∏

**Business –º–µ—Ç—Ä–∏–∫–∏**:
- `tournaments_total` - –í—Å–µ–≥–æ —Ç—É—Ä–Ω–∏—Ä–æ–≤
- `active_users` - –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `tournament_views_total` - –ü—Ä–æ—Å–º–æ—Ç—Ä—ã —Ç—É—Ä–Ω–∏—Ä–æ–≤
- `user_registrations_total` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```python
from app.utils.metrics import track_cache_operation, track_celery_task

@track_cache_operation('L1', 'get')
def get_from_cache(key):
    return cache.get(key)

@track_celery_task('parse_tournaments')
def parse_tournaments():
    # Task code...
    pass
```

#### 4. Pre-commit hooks

**–°–æ–∑–¥–∞–Ω–æ**:
- `.pre-commit-config.yaml` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è hooks
- `pyproject.toml` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

**Hooks**:
- ‚úÖ **black** - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- ‚úÖ **isort** - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤
- ‚úÖ **flake8** - –õ–∏–Ω—Ç–∏–Ω–≥
- ‚úÖ **bandit** - Security –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ **mypy** - Type checking
- ‚úÖ **YAML/JSON validation**
- ‚úÖ **Dockerfile linting** (hadolint)
- ‚úÖ **Shell script linting** (shellcheck)
- ‚úÖ **Commit message validation** (commitizen)

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞**:
```bash
pip install pre-commit
pre-commit install
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ commit
git commit -m "message"

# –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
pre-commit run --all-files
```

#### 5. Database migrations (Alembic)

**–°–æ–∑–¥–∞–Ω–æ**:
- `alembic.ini` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
- `migrations/env.py` - Environment setup
- `migrations/script.py.mako` - –®–∞–±–ª–æ–Ω –º–∏–≥—Ä–∞—Ü–∏–π

**–ö–æ–º–∞–Ω–¥—ã**:
```bash
# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "Add new field"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic downgrade -1

# –ò—Å—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
alembic history

# –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è
alembic current
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
- ‚úÖ –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PostgreSQL, MySQL, SQLite

#### 6. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ requirements.txt**:
```
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
pytest==7.4.3
pytest-cov==4.1.0
pytest-mock==3.12.0
pytest-asyncio==0.21.1

# –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
black==23.12.1
flake8==7.0.0
isort==5.13.2
mypy==1.8.0
bandit==1.7.6
pre-commit==3.6.0

# –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
alembic==1.13.1

# –ú–µ—Ç—Ä–∏–∫–∏
prometheus-client==0.19.0

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
python-json-logger==2.0.7
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–§–∞–∑–∞ 3)

**–¢–µ—Å—Ç—ã**: 5 —Ñ–∞–π–ª–æ–≤
- conftest.py
- test_models.py
- test_cache.py
- test_celery_tasks.py
- test_api.py

**–£—Ç–∏–ª–∏—Ç—ã**: 2 —Ñ–∞–π–ª–∞
- logger.py (~400 —Å—Ç—Ä–æ–∫)
- metrics.py (~350 —Å—Ç—Ä–æ–∫)

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: 4 —Ñ–∞–π–ª–∞
- pytest.ini
- .pre-commit-config.yaml
- pyproject.toml
- alembic.ini

**–ú–∏–≥—Ä–∞—Ü–∏–∏**: 2 —Ñ–∞–π–ª–∞
- env.py
- script.py.mako

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: 2 —Ñ–∞–π–ª–∞
- TESTING.md (~500 —Å—Ç—Ä–æ–∫)
- IMPROVEMENTS_V3.md (—ç—Ç–æ—Ç —Ñ–∞–π–ª)

**–í—Å–µ–≥–æ**: 15 –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤

### –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

**–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤**: 60+ —Ñ–∞–π–ª–æ–≤
**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞**: ~6000 —Å—Ç—Ä–æ–∫
**–°—Ç—Ä–æ–∫ —Ç–µ—Å—Ç–æ–≤**: ~1500 —Å—Ç—Ä–æ–∫
**–°—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**: ~7000 —Å—Ç—Ä–æ–∫
**Test coverage**: 50%+ (—Ü–µ–ª—å 80%)

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
make test

# –° coverage
make test-coverage

# –¢–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã
pytest tests/unit/

# –¢–æ–ª—å–∫–æ integration —Ç–µ—Å—Ç—ã
pytest tests/integration/

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
pytest tests/unit/test_models.py::TestTournamentModel::test_create_tournament
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
from app.utils.logger import get_logger

logger = get_logger('my_module')

# –ü—Ä–æ—Å—Ç–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
logger.info('User logged in')
logger.error('Error occurred', exc_info=True)

# –° –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
logger.info('Tournament created', extra={
    'tournament_id': 123,
    'user_id': 456
})
```

### –ú–µ—Ç—Ä–∏–∫–∏

```python
from app.utils.metrics import (
    http_requests_total,
    track_cache_operation,
    track_celery_task
)

# –†—É—á–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞
http_requests_total.labels(
    method='GET',
    endpoint='/api/tournaments',
    status=200
).inc()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤
@track_cache_operation('L1', 'get')
def get_from_cache(key):
    return cache.get(key)

@track_celery_task('my_task')
def my_task():
    # Task code...
    pass
```

### Pre-commit hooks

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
pip install pre-commit
pre-commit install

# –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
pre-commit run --all-files

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ hooks
pre-commit autoupdate

# –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å hooks (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
git commit --no-verify
```

### Database migrations

```bash
# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "Add user avatar field"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic downgrade -1

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é
alembic history

# –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –ë–î
alembic current
```

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

**–î–æ**:
- –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
- –ù–µ—Ç –µ–¥–∏–Ω–æ–≥–æ —Å—Ç–∏–ª—è –∫–æ–¥–∞
- –ù–µ—Ç type checking
- –ù–µ—Ç security –ø—Ä–æ–≤–µ—Ä–æ–∫

**–ü–æ—Å–ª–µ**:
- Pre-commit hooks —Å 9 –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
- –ï–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å (black, isort)
- Type checking (mypy)
- Security scanning (bandit)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–æ**:
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
- –ù–µ—Ç coverage –æ—Ç—á–µ—Ç–æ–≤
- –ù–µ—Ç fixtures
- –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü–æ—Å–ª–µ**:
- 50+ —Ç–µ—Å—Ç–æ–≤ (unit + integration)
- Coverage –æ—Ç—á–µ—Ç—ã (HTML, XML)
- –ì–æ—Ç–æ–≤—ã–µ fixtures
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ CI
- Mocking –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–æ**:
- –ë–∞–∑–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ù–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –ù–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –°–ª–æ–∂–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å

**–ü–æ—Å–ª–µ**:
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ (JSON)
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
- –†–∞–∑–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã (all, errors)
- Request/Celery –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–î–æ**:
- –ë–∞–∑–æ–≤—ã–µ health checks
- –ù–µ—Ç –º–µ—Ç—Ä–∏–∫
- –ù–µ—Ç visibility

**–ü–æ—Å–ª–µ**:
- 20+ Prometheus –º–µ—Ç—Ä–∏–∫
- HTTP, Cache, DB, Celery –º–µ—Ç—Ä–∏–∫–∏
- Business –º–µ—Ç—Ä–∏–∫–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Grafana
- Real-time –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Database

**–î–æ**:
- –†—É—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã
- –ù–µ—Ç –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –°–ª–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ü–æ—Å–ª–µ**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (Alembic)
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã
- –õ–µ–≥–∫–∏–π –æ—Ç–∫–∞—Ç
- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üéì Best Practices

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ü–∏—à–∏—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞**:
   ```python
   def new_feature():
       # Implementation
       pass
   
   def test_new_feature():
       # Test
       pass
   ```

2. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ coverage > 50%**:
   ```bash
   pytest --cov=app --cov-fail-under=50
   ```

3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ fixtures**:
   ```python
   def test_with_data(sample_tournament, sample_user):
       # Test using fixtures
       pass
   ```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —É—Ä–æ–≤–Ω–∏**:
   ```python
   logger.debug('Detailed info')
   logger.info('General info')
   logger.warning('Warning')
   logger.error('Error', exc_info=True)
   logger.critical('Critical error')
   ```

2. **–î–æ–±–∞–≤–ª—è–π—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç**:
   ```python
   logger.info('Action performed', extra={
       'user_id': user.id,
       'action': 'create_tournament'
   })
   ```

3. **–õ–æ–≥–∏—Ä—É–π—Ç–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è**:
   ```python
   try:
       # Code
   except Exception as e:
       logger.error('Error occurred', exc_info=True)
   ```

### –ú–µ—Ç—Ä–∏–∫–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã**:
   - Counter –¥–ª—è —Å—á–µ—Ç—á–∏–∫–æ–≤
   - Gauge –¥–ª—è —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
   - Histogram –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π

2. **–î–æ–±–∞–≤–ª—è–π—Ç–µ labels**:
   ```python
   counter.labels(method='GET', status=200).inc()
   ```

3. **–ù–µ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª—è–π—Ç–µ labels**:
   - –ò–∑–±–µ–≥–∞–π—Ç–µ high-cardinality (user_id, request_id)
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –∏–º–µ–Ω–∞

### Pre-commit

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ hooks**:
   ```bash
   pre-commit install
   ```

2. **–ò—Å–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø—Ä–æ–±–ª–µ–º—ã**:
   ```bash
   # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   black app/
   isort app/
   ```

3. **–ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏**:
   ```bash
   # –ü–ª–æ—Ö–æ
   git commit --no-verify
   
   # –•–æ—Ä–æ—à–æ
   # –ò—Å–ø—Ä–∞–≤—å—Ç–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ commit
   ```

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (1-2 –Ω–µ–¥–µ–ª–∏)

1. **–£–≤–µ–ª–∏—á–∏—Ç—å test coverage –¥–æ 80%**:
   - [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è views
   - [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è utils
   - [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è tasks

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫**:
   - [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤ –∫–æ–¥
   - [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Grafana –¥–∞—à–±–æ—Ä–¥—ã
   - [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã

3. **–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - [ ] –î–æ–±–∞–≤–∏—Ç—å request_id
   - [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å ELK Stack
   - [ ] –î–æ–±–∞–≤–∏—Ç—å log aggregation

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (1-2 –º–µ—Å—è—Ü–∞)

1. **Load testing**:
   - [ ] Locust/JMeter —Ç–µ—Å—Ç—ã
   - [ ] Performance benchmarks
   - [ ] Stress testing

2. **Security testing**:
   - [ ] OWASP ZAP scanning
   - [ ] Penetration testing
   - [ ] Dependency scanning

3. **E2E testing**:
   - [ ] Selenium/Playwright —Ç–µ—Å—Ç—ã
   - [ ] User flow testing
   - [ ] Visual regression testing

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [TESTING.md](TESTING.md) - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ARCHITECTURE.md](ARCHITECTURE.md) - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [MONITORING.md](MONITORING.md) - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ö–æ–º–∞–Ω–¥—ã
```bash
make test              # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
make test-coverage     # Coverage –æ—Ç—á–µ—Ç
make lint              # –õ–∏–Ω—Ç–∏–Ω–≥
make format            # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```

### Troubleshooting

**–ü—Ä–æ–±–ª–µ–º–∞**: –¢–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç
```bash
pytest -v  # –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥
pytest --lf  # –¢–æ–ª—å–∫–æ failed —Ç–µ—Å—Ç—ã
pytest --pdb  # Debugger –ø—Ä–∏ –æ—à–∏–±–∫–µ
```

**–ü—Ä–æ–±–ª–µ–º–∞**: Pre-commit hooks –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
```bash
pre-commit uninstall
pre-commit install
pre-commit run --all-files
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è
```bash
alembic current  # –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è
alembic history  # –ò—Å—Ç–æ—Ä–∏—è
alembic upgrade head  # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ
```

---

**–í–µ—Ä—Å–∏—è**: 2.2  
**–î–∞—Ç–∞**: 2024  
**–ê–≤—Ç–æ—Ä**: –î—É–ø–ª–µ–π –ú–∞–∫—Å–∏–º –ò–≥–æ—Ä–µ–≤–∏—á  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ Production Ready
