/**
 * @param {number[]} prices
 * @return {number}
 * 
 * Решение задачи "Лучшее время для покупки и продажи акций III"
 * 
 * Условие задачи:
 * Дан массив цен на акции. Можно совершить не более двух транзакций.
 * Каждая транзакция состоит из покупки и последующей продажи.
 * Нельзя совершать несколько транзакций одновременно.
 * 
 * Основная идея:
 * Отслеживаем четыре состояния, представляющих максимальную прибыль
 * на разных этапах транзакций. Это позволяет одновременно учитывать
 * возможности для первой и второй транзакции.
 * 
 * Подход:
 * Динамическое программирование с четырьмя переменными состояния.
 */
var maxProfit = function(prices) {
    // Крайние случаи: если массив пуст или слишком короткий
    if (!prices || prices.length <= 1) {
        return 0;
    }
    
    // Состояния динамического программирования:
    let firstBuy = -Infinity;      // Максимальная прибыль после первой покупки
    let firstSell = 0;             // Максимальная прибыль после первой продажи
    let secondBuy = -Infinity;     // Максимальная прибыль после второй покупки
    let secondSell = 0;            // Максимальная прибыль после второй продажи
    
    // Проходим по всем дням
    for (let i = 0; i < prices.length; i++) {
        const currentPrice = prices[i];
        
        // Важно: обновляем в обратном порядке, чтобы использовать
        // значения из предыдущей итерации для текущих расчетов
        
        // 1. Обновляем вторую продажу (используя текущую цену и вторую покупку)
        secondSell = Math.max(secondSell, secondBuy + currentPrice);
        
        // 2. Обновляем вторую покупку (используя текущую цену и первую продажу)
        secondBuy = Math.max(secondBuy, firstSell - currentPrice);
        
        // 3. Обновляем первую продажу (используя текущую цену и первую покупку)
        firstSell = Math.max(firstSell, firstBuy + currentPrice);
        
        // 4. Обновляем первую покупку (используя текущую цену)
        firstBuy = Math.max(firstBuy, -currentPrice);
    }
    
    // Возвращаем максимальную прибыль
    // secondSell будет содержать максимальную прибыль для 0, 1 или 2 транзакций
    return secondSell;
};