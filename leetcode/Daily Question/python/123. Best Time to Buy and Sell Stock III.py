class Solution(object):
    def maxProfit(self, prices):
        """
        :type prices: List[int]
        :rtype: int
        
        Вычисляет максимальную прибыль от совершения не более двух транзакций
        (покупка + продажа) на бирже.
        
        Алгоритм:
        ---------
        Используется подход конечного автомата с четырьмя состояниями:
        - buy1: максимальная прибыль после первой покупки (отрицательное значение)
        - sell1: максимальная прибыль после первой продажи
        - buy2: максимальная прибыль после второй покупки
        - sell2: максимальная прибыль после второй продажи
        
        Сложность:
        ----------
        Время: O(n), где n - количество дней
        Память: O(1)
        
        Примеры:
        --------
        >>> solution = Solution()
        >>> solution.maxProfit([3,3,5,0,0,3,1,4])
        6
        >>> solution.maxProfit([1,2,3,4,5])
        4
        >>> solution.maxProfit([7,6,4,3,1])
        0
        
        Объяснение для примера [3,3,5,0,0,3,1,4]:
        --------------------------------------
        День 0 (цена 3): buy1 = -3, sell1 = 0, buy2 = -3, sell2 = 0
        День 1 (цена 3): buy1 = -3, sell1 = 0, buy2 = -3, sell2 = 0
        День 2 (цена 5): buy1 = -3, sell1 = 2, buy2 = -3, sell2 = 2
        День 3 (цена 0): buy1 = 0, sell1 = 2, buy2 = 2, sell2 = 2
        День 4 (цена 0): buy1 = 0, sell1 = 2, buy2 = 2, sell2 = 2
        День 5 (цена 3): buy1 = 0, sell1 = 3, buy2 = 2, sell2 = 5
        День 6 (цена 1): buy1 = 0, sell1 = 3, buy2 = 2, sell2 = 5
        День 7 (цена 4): buy1 = 0, sell1 = 4, buy2 = 2, sell2 = 6
        
        Ответ: 6 (покупаем в день 3 по 0, продаем в день 5 по 3 → прибыль 3;
                   покупаем в день 6 по 1, продаем в день 7 по 4 → прибыль 3;
                   общая прибыль: 3 + 3 = 6)
        """
        if not prices:
            return 0
        
        # Инициализация состояний
        buy1 = float('-inf')   # Первая покупка еще не совершена
        sell1 = 0              # Первая продажа еще не совершена
        buy2 = float('-inf')   # Вторая покупка еще не совершена
        sell2 = 0              # Вторая продажа еще не совершена
        
        for price in prices:
            # Обновляем состояния в порядке от первой ко второй транзакции
            # 1. Первая покупка: либо сохраняем текущую, либо покупаем по новой цене
            buy1 = max(buy1, -price)
            
            # 2. Первая продажа: либо сохраняем текущую, либо продаем по новой цене
            sell1 = max(sell1, buy1 + price)
            
            # 3. Вторая покупка: либо сохраняем текущую, либо покупаем на прибыль от первой продажи
            buy2 = max(buy2, sell1 - price)
            
            # 4. Вторая продажа: либо сохраняем текущую, либо продаем по новой цене
            sell2 = max(sell2, buy2 + price)
        
        return sell2