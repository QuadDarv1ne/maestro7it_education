# üèóÔ∏è –ü–æ–ª–Ω—ã–π –º–∞–Ω—É–∞–ª –ø–æ Frappe Framework: –û—Ç –æ—Å–Ω–æ–≤ –¥–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –ø—Ä–∞–∫—Ç–∏–∫

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ –≤ Frappe Framework](#–≤–≤–µ–¥–µ–Ω–∏–µ-–≤-frappe-framework)
2. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
3. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Frappe](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-frappe)
4. [–î–æ–∫—É–º–µ–Ω—Ç—ã –∏ DocTypes](#–¥–æ–∫—É–º–µ–Ω—Ç—ã-–∏-doctypes)
5. [Frontend —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#frontend-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
6. [Backend —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#backend-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
7. [API –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#api-–∏-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
8. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
9. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
10. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
11. [–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏](#–ª—É—á—à–∏–µ-–ø—Ä–∞–∫—Ç–∏–∫–∏)

## –í–≤–µ–¥–µ–Ω–∏–µ –≤ Frappe Framework

**Frappe Framework** ‚Äî —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π full-stack —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ Python –∏ JavaScript. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ ERP-—Å–∏—Å—Ç–µ–º, —Ç–∞–∫–∏—Ö –∫–∞–∫ ERPNext.

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Frappe:

‚úÖ **Full-stack**: Python (backend) + JavaScript (frontend)
‚úÖ **No-code/Low-code**: –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
‚úÖ **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: Tenant isolation
‚úÖ **–ú–æ—â–Ω–∞—è ORM**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–π
‚úÖ **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –∞—É–¥–∏—Ç, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
‚úÖ **WebSocket –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
‚úÖ **–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–∞–ª–∏–∑–∞—Ü–∏—è**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —è–∑—ã–∫–æ–≤

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Frappe?

**–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- ERP-—Å–∏—Å—Ç–µ–º
- CRM-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –ë—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º
- –°–∏—Å—Ç–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞–º–∏
- –ë–∏–∑–Ω–µ—Å-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- SAAS-—Ä–µ—à–µ–Ω–∏–π

**–ù–µ –≤—Å–µ–≥–¥–∞ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –ü—Ä–æ—Å—Ç—ã—Ö –ª–µ–Ω–¥–∏–Ω–≥–æ–≤
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∞–π—Ç–æ–≤
- –í—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –±–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- –ü—Ä–æ–µ–∫—Ç–æ–≤ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞–º–∏

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ Bench:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Bench (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Frappe –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏)
pip install frappe-bench

# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ Frappe –∏–Ω—Å—Ç–∞–Ω—Å–∞
bench init ~/frappe-bench --frappe-branch version-14

# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd ~/frappe-bench

# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–∞–π—Ç–∞
bench new-site mysite.local

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
bench get-app erpnext
bench --site mysite.local install-app erpnext

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
bench start
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ Docker:

```yaml
# docker-compose.yml
version: '3.7'

services:
  mariadb:
    image: mariadb:10.3
    environment:
      MYSQL_ROOT_PASSWORD: 123
      MYSQL_USER: frappe
      MYSQL_PASSWORD: 123
      MYSQL_DATABASE: frappe
    volumes:
      - mariadb-data:/var/lib/mysql

  redis-cache:
    image: redis:latest

  redis-queue:
    image: redis:latest

  redis-socketio:
    image: redis:latest

  frappe:
    image: frappe/bench:latest
    command: >
      sh -c "bench new-site site1.local --mariadb-root-password 123 --admin-password admin
      && bench --site site1.local install-app erpnext
      && bench start"
    depends_on:
      - mariadb
      - redis-cache
      - redis-queue
      - redis-socketio
    ports:
      - "8000:8000"
    volumes:
      - ./sites:/home/frappe/frappe-bench/sites

volumes:
  mariadb-data:
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (Ubuntu/Debian)
sudo apt-get update
sudo apt-get install -y python3-dev python3-setuptools python3-pip
sudo apt-get install -y mariadb-client mariadb-server
sudo apt-get install -y redis-server
sudo apt-get install -y nodejs npm
sudo apt-get install -y yarn

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip3 install frappe-bench

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install -g yarn
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Frappe

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

```
my_app/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ hooks.py                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ modules.txt             # –ù–∞–∑–≤–∞–Ω–∏—è –º–æ–¥—É–ª–µ–π
‚îú‚îÄ‚îÄ patches.txt            # –ú–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ templates/             # HTML —à–∞–±–ª–æ–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ pages/            # Page —à–∞–±–ª–æ–Ω—ã
‚îÇ   ‚îî‚îÄ‚îÄ includes/         # Reusable –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ www/                  # Public —Å—Ç—Ä–∞–Ω–∏—Ü—ã
‚îú‚îÄ‚îÄ public/               # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îî‚îÄ‚îÄ images/
‚îú‚îÄ‚îÄ config/               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ desktop.py       # Desk icons
‚îú‚îÄ‚îÄ docs/                # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ fixtures/            # –§–∏–∫—Å—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ translations/        # –ü–µ—Ä–µ–≤–æ–¥—ã
‚îî‚îÄ‚îÄ my_app/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ api.py           # API –º–µ—Ç–æ–¥—ã
    ‚îú‚îÄ‚îÄ hooks.py        # Hooks –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    ‚îú‚îÄ‚îÄ modules/        # –ú–æ–¥—É–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    ‚îÇ   ‚îú‚îÄ‚îÄ doc_types/  # DocType –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    ‚îÇ   ‚îú‚îÄ‚îÄ pages/      # Page –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    ‚îÇ   ‚îî‚îÄ‚îÄ reports/    # Report –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    ‚îî‚îÄ‚îÄ utils/          # –£—Ç–∏–ª–∏—Ç—ã
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

#### 1. DocType (Document Type):
```python
# my_app/my_app/doc_types/todo/todo.json
{
  "doctype": "DocType",
  "name": "ToDo",
  "module": "My App",
  "custom": 0,
  "fields": [
    {
      "fieldname": "description",
      "fieldtype": "Text Editor",
      "label": "Description",
      "reqd": 1
    },
    {
      "fieldname": "priority",
      "fieldtype": "Select",
      "label": "Priority",
      "options": "Low\nMedium\nHigh",
      "default": "Medium"
    },
    {
      "fieldname": "due_date",
      "fieldtype": "Date",
      "label": "Due Date"
    },
    {
      "fieldname": "status",
      "fieldtype": "Select",
      "label": "Status",
      "options": "Open\nCompleted",
      "default": "Open"
    }
  ],
  "permissions": [
    {
      "role": "System Manager",
      "permlevel": 0,
      "read": 1,
      "write": 1,
      "create": 1,
      "delete": 1,
      "submit": 0,
      "cancel": 0,
      "amend": 0
    }
  ]
}
```

#### 2. Hooks:
```python
# hooks.py
app_name = "my_app"
app_title = "My App"
app_publisher = "My Publisher"
app_version = "0.0.1"

# –°–∞–π—Ç
website_context = {
    "favicon": "/assets/my_app/images/favicon.ico",
    "splash_image": "/assets/my_app/images/splash.png"
}

# –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
scheduler_events = {
    "daily": [
        "my_app.tasks.daily_backup"
    ],
    "hourly": [
        "my_app.tasks.hourly_sync"
    ]
}

# API —Ç–æ—á–∫–∏
override_whitelisted_methods = {
    "frappe.desk.form.save.handler": "my_app.api.custom_save"
}

# DocType —Å–æ–±—ã—Ç–∏—è
doc_events = {
    "ToDo": {
        "after_insert": "my_app.handlers.todo_after_insert",
        "validate": "my_app.handlers.todo_validate"
    }
}
```

## –î–æ–∫—É–º–µ–Ω—Ç—ã –∏ DocTypes

### –°–æ–∑–¥–∞–Ω–∏–µ DocType –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ:

```python
# my_app/my_app/setup.py
import frappe

def create_custom_doctypes():
    """–°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö DocTypes"""
    
    # –°–æ–∑–¥–∞–Ω–∏–µ DocType —á–µ—Ä–µ–∑ –∫–æ–¥
    if not frappe.db.exists('DocType', 'Custom Customer'):
        doc = frappe.get_doc({
            'doctype': 'DocType',
            'name': 'Custom Customer',
            'module': 'My App',
            'custom': 0,
            'autoname': 'field:customer_name',
            'fields': [
                {
                    'fieldname': 'customer_name',
                    'fieldtype': 'Data',
                    'label': 'Customer Name',
                    'reqd': 1
                },
                {
                    'fieldname': 'email',
                    'fieldtype': 'Data',
                    'label': 'Email',
                    'options': 'Email'
                },
                {
                    'fieldname': 'phone',
                    'fieldtype': 'Data',
                    'label': 'Phone',
                    'options': 'Phone'
                },
                {
                    'fieldname': 'customer_group',
                    'fieldtype': 'Link',
                    'label': 'Customer Group',
                    'options': 'Customer Group'
                }
            ],
            'permissions': [
                {
                    'role': 'System Manager',
                    'read': 1,
                    'write': 1,
                    'create': 1,
                    'delete': 1
                }
            ]
        })
        doc.insert()
        frappe.db.commit()

def setup_data():
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"""
    
    # –°–æ–∑–¥–∞–Ω–∏–µ Customer Groups
    customer_groups = ['Individual', 'Corporate', 'Government']
    
    for group in customer_groups:
        if not frappe.db.exists('Customer Group', group):
            frappe.get_doc({
                'doctype': 'Customer Group',
                'customer_group_name': group
            }).insert()

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
def after_install():
    create_custom_doctypes()
    setup_data()
```

### –†–∞–±–æ—Ç–∞ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏:

```python
# my_app/my_app/api.py
import frappe
from frappe import _
from frappe.model.document import Document

@frappe.whitelist()
def create_todo(description, priority="Medium", due_date=None):
    """–°–æ–∑–¥–∞–Ω–∏–µ ToDo"""
    todo = frappe.new_doc("ToDo")
    todo.description = description
    todo.priority = priority
    if due_date:
        todo.due_date = due_date
    todo.insert()
    frappe.db.commit()
    return todo

@frappe.whitelist()
def get_todos(filters=None):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ ToDo"""
    todo_list = frappe.get_all(
        "ToDo",
        filters=filters or {},
        fields=["name", "description", "priority", "status", "due_date"],
        order_by="creation desc"
    )
    return todo_list

@frappe.whitelist()
def update_todo_status(todo_name, status):
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ ToDo"""
    todo = frappe.get_doc("ToDo", todo_name)
    todo.status = status
    todo.save()
    return todo

# –ö–∞—Å—Ç–æ–º–Ω—ã–π DocType –∫–ª–∞—Å—Å
class CustomCustomer(Document):
    def validate(self):
        """–í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏"""
        if self.email:
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ email
            existing = frappe.db.exists(
                "Custom Customer", 
                {"email": self.email, "name": ["!=", self.name]}
            )
            if existing:
                frappe.throw(_("Email already exists"))
    
    def before_save(self):
        """–ü–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º"""
        # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π
        if not self.customer_group:
            self.customer_group = "Individual"
    
    def after_insert(self):
        """–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è"""
        # –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏
        frappe.log("New customer created: {}".format(self.customer_name))

@frappe.whitelist()
def get_customer_summary(customer_name):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–æ–¥–∫–∏ –ø–æ –∫–ª–∏–µ–Ω—Ç—É"""
    customer = frappe.get_doc("Custom Customer", customer_name)
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
    orders = frappe.get_all(
        "Sales Order",
        filters={"customer": customer_name},
        fields=["name", "grand_total", "status", "transaction_date"]
    )
    
    total_orders = len(orders)
    total_amount = sum(order.grand_total for order in orders)
    
    return {
        "customer": customer.as_dict(),
        "summary": {
            "total_orders": total_orders,
            "total_amount": total_amount,
            "recent_orders": orders[:5]  # –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∑–∞–∫–∞–∑–æ–≤
        }
    }
```

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è DocTypes:

```javascript
// my_app/public/js/todo.js
frappe.ui.form.on('ToDo', {
    refresh: function(frm) {
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
        if (frm.doc.status === 'Open') {
            frm.add_custom_button(__('Mark Completed'), function() {
                frappe.call({
                    method: 'my_app.api.update_todo_status',
                    args: {
                        todo_name: frm.doc.name,
                        status: 'Completed'
                    },
                    callback: function(r) {
                        if (!r.exc) {
                            frm.reload_doc();
                        }
                    }
                });
            });
        }
        
        // –£—Å–ª–æ–≤–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ –ø–æ–ª–µ–π
        if (frm.doc.priority === 'Low') {
            frm.set_df_property('due_date', 'hidden', 1);
        } else {
            frm.set_df_property('due_date', 'hidden', 0);
        }
    },
    
    priority: function(frm) {
        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
        let color = {
            'Low': 'green',
            'Medium': 'orange',
            'High': 'red'
        }[frm.doc.priority] || 'gray';
        
        $(frm.fields_dict.description.wrapper).css('border-left', `3px solid ${color}`);
    },
    
    due_date: function(frm) {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã
        if (frm.doc.due_date && frm.doc.due_date < frappe.datetime.get_today()) {
            frappe.show_alert({
                message: __('Due date is in the past'),
                indicator: 'orange'
            });
        }
    }
});
```

## Frontend —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### Page —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:

```python
# my_app/www/custom_page.py
import frappe
from frappe import _

def get_context(context):
    """–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã"""
    context.no_cache = 1
    context.todos = frappe.get_all(
        "ToDo",
        filters={"status": "Open"},
        fields=["name", "description", "priority", "due_date"],
        order_by="creation desc"
    )
    
    context.customers = frappe.get_all(
        "Custom Customer",
        fields=["name", "customer_name", "email"],
        order_by="modified desc"
    )
    
    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ JS/CSS
    context.styles = ['/assets/my_app/css/custom.css']
    context.scripts = ['/assets/my_app/js/custom.js']
    
    return context
```

```html
<!-- my_app/templates/pages/custom_page.html -->
{% extends "templates/web.html" %}

{% block page_content %}
<div class="container">
    <h1>Custom Dashboard</h1>
    
    <div class="row">
        <div class="col-md-6">
            <h3>Open Tasks</h3>
            <div class="list-group">
                {% for todo in todos %}
                <div class="list-group-item">
                    <div class="d-flex justify-content-between">
                        <span class="priority-{{ todo.priority.lower() }}">
                            {{ todo.description }}
                        </span>
                        <small>{{ todo.due_date or "No deadline" }}</small>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="col-md-6">
            <h3>Recent Customers</h3>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                    </tr>
                </thead>
                <tbody>
                    {% for customer in customers %}
                    <tr>
                        <td>{{ customer.customer_name }}</td>
                        <td>{{ customer.email }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
```

### Desk Page (Admin Interface):

```javascript
// my_app/public/js/desk_pages/custom_dashboard.js
frappe.pages['custom-dashboard'].on_page_load = function(wrapper) {
    var page = frappe.ui.make_app_page({
        parent: wrapper,
        title: 'Custom Dashboard',
        single_column: true
    });
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    page.add_inner_button(__('Refresh'), function() {
        refresh_dashboard();
    });
    
    page.add_inner_button(__('Export Data'), function() {
        export_data();
    });
    
    // –†–µ–Ω–¥–µ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    render_dashboard(page);
};

function render_dashboard(page) {
    $(page.body).empty();
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫
    var cards_html = `
        <div class="dashboard-cards">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Open Tasks</h5>
                    <p class="card-text" id="open-tasks-count">0</p>
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Customers</h5>
                    <p class="card-text" id="customers-count">0</p>
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Revenue</h5>
                    <p class="card-text" id="revenue-amount">$0</p>
                </div>
            </div>
        </div>
    `;
    
    $(page.body).append(cards_html);
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    load_dashboard_data();
}

function load_dashboard_data() {
    frappe.call({
        method: 'my_app.api.get_dashboard_data',
        callback: function(r) {
            if (!r.exc) {
                $('#open-tasks-count').text(r.message.open_tasks);
                $('#customers-count').text(r.message.total_customers);
                $('#revenue-amount').text('$' + r.message.monthly_revenue);
            }
        }
    });
}

function refresh_dashboard() {
    load_dashboard_data();
    frappe.show_alert({
        message: 'Dashboard refreshed',
        indicator: 'green'
    });
}

function export_data() {
    frappe.call({
        method: 'my_app.api.export_data',
        args: {
            doctype: 'ToDo'
        },
        callback: function(r) {
            if (!r.exc) {
                frappe.show_alert({
                    message: 'Export completed',
                    indicator: 'green'
                });
            }
        }
    });
}
```

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ Formatters:

```javascript
// my_app/public/js/formatters.js
frappe.provide('my_app.formatters');

// –ö–∞—Å—Ç–æ–º–Ω—ã–π formatter –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
my_app.formatters.priority = function(value, doc, field, options) {
    if (!value) return '';
    
    var colors = {
        'High': 'red',
        'Medium': 'orange',
        'Low': 'green'
    };
    
    return `<span class="indicator-pill ${colors[value] || 'gray'}">${value}</span>`;
};

// –ö–∞—Å—Ç–æ–º–Ω—ã–π formatter –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞
my_app.formatters.status = function(value, doc, field, options) {
    if (!value) return '';
    
    var colors = {
        'Open': 'orange',
        'Completed': 'green',
        'Cancelled': 'red',
        'In Progress': 'blue'
    };
    
    return `<span class="indicator-pill ${colors[value] || 'gray'}">${value}</span>`;
};

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è formatter'–æ–≤
frappe.form.link_formatters['ToDo'] = function(value, doc) {
    if (doc && doc.priority) {
        return my_app.formatters.priority(doc.priority) + ' ' + value;
    }
    return value;
};
```

## Backend —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏ API:

```python
# my_app/my_app/api.py
import frappe
from frappe import _
import json
from frappe.utils.response import json_handler
from frappe.auth import HTTPRequest

@frappe.whitelist()
def get_sales_summary(start_date=None, end_date=None):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–æ–¥–∫–∏ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º"""
    from datetime import datetime, timedelta
    
    if not start_date:
        start_date = frappe.utils.add_days(frappe.utils.today(), -30)
    if not end_date:
        end_date = frappe.utils.today()
    
    # –ó–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    sales_data = frappe.db.sql("""
        SELECT 
            DATE(creation) as date,
            COUNT(*) as count,
            SUM(grand_total) as total
        FROM `tabSales Order`
        WHERE creation BETWEEN %(start_date)s AND %(end_date)s
        GROUP BY DATE(creation)
        ORDER BY DATE(creation)
    """, {
        'start_date': start_date,
        'end_date': end_date
    }, as_dict=True)
    
    # –ü–æ–¥—Å—á–µ—Ç –æ–±—â–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
    total_orders = sum(row.count for row in sales_data)
    total_revenue = sum(row.total for row in sales_data)
    
    return {
        'sales_data': sales_data,
        'summary': {
            'total_orders': total_orders,
            'total_revenue': total_revenue,
            'average_order_value': total_revenue / total_orders if total_orders > 0 else 0
        }
    }

@frappe.whitelist(allow_guest=True)
def submit_feedback(name, email, message, rating=5):
    """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞"""
    if not all([name, email, message]):
        frappe.throw(_("Name, Email and Message are required"))
    
    if not frappe.utils.validate_email_address(email):
        frappe.throw(_("Invalid email address"))
    
    feedback_doc = frappe.get_doc({
        'doctype': 'Feedback',
        'name': name,
        'email': email,
        'message': message,
        'rating': min(5, max(1, int(rating)))  # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ—Ç 1 –¥–æ 5
    })
    
    feedback_doc.insert(ignore_permissions=True)
    frappe.db.commit()
    
    return {
        'status': 'success',
        'message': _('Thank you for your feedback!')
    }

@frappe.whitelist()
def bulk_update_todos(todo_list, field, value):
    """–ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ToDo"""
    updated_count = 0
    
    for todo_name in todo_list:
        try:
            todo = frappe.get_doc("ToDo", todo_name)
            setattr(todo, field, value)
            todo.save()
            updated_count += 1
        except Exception as e:
            frappe.log_error(f"Error updating ToDo {todo_name}: {str(e)}")
    
    frappe.db.commit()
    return {
        'updated': updated_count,
        'failed': len(todo_list) - updated_count
    }

def send_daily_reminders():
    """–û—Ç–ø—Ä–∞–≤–∫–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π"""
    from datetime import datetime, timedelta
    
    tomorrow = frappe.utils.add_days(frappe.utils.today(), 1)
    
    todos_due_tomorrow = frappe.get_all(
        "ToDo",
        filters={
            "due_date": tomorrow,
            "status": "Open"
        },
        fields=["name", "description", "allocated_to"]
    )
    
    for todo in todos_due_tomorrow:
        if todo.allocated_to:
            frappe.sendmail(
                recipients=[todo.allocated_to],
                subject=_("Tomorrow's Task Reminder"),
                message=_("Task '{}' is due tomorrow: {}").format(
                    todo.name, todo.description
                ),
                delayed=False
            )

def cleanup_old_logs():
    """–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤"""
    from datetime import datetime, timedelta
    
    # –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
    cutoff_date = frappe.utils.add_days(frappe.utils.today(), -30)
    
    old_logs = frappe.get_all(
        "Custom Log",
        filters={"creation": ["<", cutoff_date]},
        pluck="name"
    )
    
    for log_name in old_logs:
        frappe.delete_doc("Custom Log", log_name, ignore_permissions=True)
    
    frappe.db.commit()
```

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ Reports:

```python
# my_app/my_app/reports/todo_summary/todo_summary.py
import frappe
from frappe import _

def execute(filters=None):
    columns = get_columns()
    data = get_data(filters)
    chart = get_chart(data)
    report_summary = get_report_summary(data)
    
    return columns, data, chart, None, report_summary

def get_columns():
    return [
        {
            "fieldname": "priority",
            "label": _("Priority"),
            "fieldtype": "Data",
            "width": 120
        },
        {
            "fieldname": "count",
            "label": _("Count"),
            "fieldtype": "Int",
            "width": 100
        },
        {
            "fieldname": "completed",
            "label": _("Completed"),
            "fieldtype": "Int",
            "width": 120
        },
        {
            "fieldname": "open",
            "label": _("Open"),
            "fieldtype": "Int",
            "width": 100
        }
    ]

def get_data(filters):
    conditions = []
    if filters.get("status"):
        conditions.append(f"status = '{filters.get('status')}'")
    
    condition_str = " AND ".join(conditions) if conditions else "1=1"
    
    data = frappe.db.sql(f"""
        SELECT 
            priority,
            COUNT(*) as count,
            SUM(CASE WHEN status = 'Completed' THEN 1 ELSE 0 END) as completed,
            SUM(CASE WHEN status = 'Open' THEN 1 ELSE 0 END) as open
        FROM `tabToDo`
        WHERE {condition_str}
        GROUP BY priority
    """, as_dict=True)
    
    return data

def get_chart(data):
    if not data:
        return None
    
    priorities = [row.priority for row in data]
    counts = [row.count for row in data]
    
    return {
        "data": {
            "labels": priorities,
            "datasets": [
                {
                    "name": "Tasks",
                    "values": counts
                }
            ]
        },
        "type": "bar"
    }

def get_report_summary(data):
    if not data:
        return []
    
    total_tasks = sum(row.count for row in data)
    completed_tasks = sum(row.completed for row in data)
    open_tasks = sum(row.open for row in data)
    
    return [
        {
            "value": total_tasks,
            "indicator": "Blue",
            "label": _("Total Tasks"),
            "datatype": "Int"
        },
        {
            "value": completed_tasks,
            "indicator": "Green",
            "label": _("Completed"),
            "datatype": "Int"
        },
        {
            "value": open_tasks,
            "indicator": "Red",
            "label": _("Open"),
            "datatype": "Int"
        }
    ]
```

## API –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### REST API:

```python
# my_app/my_app/api_integration.py
import frappe
import requests
import json
from frappe import _
from frappe.utils.password import get_decrypted_password

class ExternalAPIClient:
    def __init__(self, base_url, api_key=None):
        self.base_url = base_url.rstrip('/')
        self.api_key = api_key or get_decrypted_password(
            'System Settings', 'System Settings', 'external_api_key'
        )
        self.session = requests.Session()
        
        if self.api_key:
            self.session.headers.update({
                'Authorization': f'Bearer {self.api_key}',
                'Content-Type': 'application/json'
            })
    
    def get(self, endpoint, params=None):
        """GET –∑–∞–ø—Ä–æ—Å"""
        url = f"{self.base_url}/{endpoint.lstrip('/')}"
        response = self.session.get(url, params=params)
        return self._handle_response(response)
    
    def post(self, endpoint, data=None):
        """POST –∑–∞–ø—Ä–æ—Å"""
        url = f"{self.base_url}/{endpoint.lstrip('/')}"
        response = self.session.post(url, json=data)
        return self._handle_response(response)
    
    def put(self, endpoint, data=None):
        """PUT –∑–∞–ø—Ä–æ—Å"""
        url = f"{self.base_url}/{endpoint.lstrip('/')}"
        response = self.session.put(url, json=data)
        return self._handle_response(response)
    
    def delete(self, endpoint):
        """DELETE –∑–∞–ø—Ä–æ—Å"""
        url = f"{self.base_url}/{endpoint.lstrip('/')}"
        response = self.session.delete(url)
        return self._handle_response(response)
    
    def _handle_response(self, response):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞"""
        if response.status_code in [200, 201]:
            try:
                return response.json()
            except json.JSONDecodeError:
                return {'message': response.text}
        else:
            frappe.log_error(f"API Error: {response.status_code} - {response.text}")
            frappe.throw(_(f"External API Error: {response.status_code}"))

@frappe.whitelist()
def sync_customers_with_external_system():
    """–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–æ–π"""
    client = ExternalAPIClient('https://api.external-system.com')
    
    try:
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã
        external_customers = client.get('/customers')
        
        synced_count = 0
        error_count = 0
        
        for ext_customer in external_customers:
            try:
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
                if frappe.db.exists('Custom Customer', ext_customer.get('external_id')):
                    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
                    customer = frappe.get_doc('Custom Customer', ext_customer.get('external_id'))
                else:
                    # –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ
                    customer = frappe.new_doc('Custom Customer')
                    customer.name = ext_customer.get('external_id')
                
                # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
                customer.customer_name = ext_customer.get('name')
                customer.email = ext_customer.get('email')
                customer.phone = ext_customer.get('phone')
                customer.external_sync = 1  # –ü–æ–º–µ—Ç–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
                
                customer.save()
                synced_count += 1
                
            except Exception as e:
                frappe.log_error(f"Sync error for customer {ext_customer.get('id')}: {str(e)}")
                error_count += 1
        
        frappe.db.commit()
        
        return {
            'status': 'success',
            'synced': synced_count,
            'errors': error_count,
            'message': f'Sync completed: {synced_count} synced, {error_count} errors'
        }
        
    except Exception as e:
        frappe.log_error(f"Sync failed: {str(e)}")
        frappe.throw(_(f"Sync failed: {str(e)}"))

@frappe.whitelist()
def webhook_handler():
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–µ–±—Ö—É–∫–æ–≤"""
    import json
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤–µ–±—Ö—É–∫–∞
    data = frappe.request.get_json()
    event_type = frappe.request.headers.get('X-Event-Type')
    
    if event_type == 'customer.created':
        handle_customer_created(data)
    elif event_type == 'order.updated':
        handle_order_updated(data)
    elif event_type == 'payment.completed':
        handle_payment_completed(data)
    
    return {'status': 'received'}

def handle_customer_created(data):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞"""
    customer_data = data.get('customer', {})
    
    if not frappe.db.exists('Custom Customer', customer_data.get('id')):
        customer = frappe.new_doc('Custom Customer')
        customer.name = customer_data.get('id')
        customer.customer_name = customer_data.get('name')
        customer.email = customer_data.get('email')
        customer.phone = customer_data.get('phone')
        customer.insert()

def handle_order_updated(data):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞"""
    order_data = data.get('order', {})
    # –õ–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞...

def handle_payment_completed(data):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞"""
    payment_data = data.get('payment', {})
    # –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞...
```

### WebSocket –∏ Real-time:

```javascript
// my_app/public/js/realtime.js
frappe.provide('my_app.realtime');

my_app.realtime.SocketManager = class {
    constructor() {
        this.socket = null;
        this.connected = false;
        this.listeners = {};
        this.initialize();
    }
    
    initialize() {
        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Frappe Socket.IO
        if (typeof io !== 'undefined') {
            this.connect();
        }
    }
    
    connect() {
        this.socket = io(frappe.socketio_port, {
            transports: ['websocket']
        });
        
        this.socket.on('connect', () => {
            this.connected = true;
            this.emit('user_connected', {
                user: frappe.session.user,
                sid: frappe.get_cookie('sid')
            });
        });
        
        this.socket.on('disconnect', () => {
            this.connected = false;
        });
        
        // –°–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
        this.socket.on('todo_update', (data) => {
            this.handle_todo_update(data);
        });
        
        this.socket.on('notification', (data) => {
            this.handle_notification(data);
        });
    }
    
    handle_todo_update(data) {
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ToDo –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        if (data.action === 'created' && data.assigned_to === frappe.session.user) {
            frappe.show_alert({
                message: `New task assigned: ${data.description}`,
                indicator: 'info'
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        if (cur_frm && cur_frm.doc.doctype === 'ToDo') {
            cur_frm.refresh();
        }
    }
    
    handle_notification(data) {
        // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        frappe.show_alert({
            message: data.message,
            indicator: data.indicator || 'blue'
        });
    }
    
    emit(event, data) {
        if (this.socket && this.connected) {
            this.socket.emit(event, data);
        }
    }
    
    on(event, callback) {
        if (this.socket) {
            this.socket.on(event, callback);
        }
    }
    
    off(event) {
        if (this.socket) {
            this.socket.off(event);
        }
    }
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
$(document).ready(function() {
    my_app.realtime.socket_manager = new my_app.realtime.SocketManager();
});

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ñ–æ—Ä–º–µ
frappe.ui.form.on('ToDo', {
    setup: function(frm) {
        // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        my_app.realtime.socket_manager.on('todo_assigned', function(data) {
            if (data.todo_name === frm.doc.name && data.assigned_to !== frappe.session.user) {
                frm.refresh();
                frappe.show_alert('Task reassigned');
            }
        });
    }
});
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:

```python
# my_app/my_app/security.py
import frappe
from frappe import _
from frappe.permissions import has_permission, get_doc_permissions

def validate_todo_access(doc, method):
    """–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ ToDo"""
    if doc.allocated_to and doc.allocated_to != frappe.session.user:
        # –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º
        if not 'System Manager' in frappe.get_roles() and not 'ToDo Manager' in frappe.get_roles():
            frappe.throw(_("You don't have permission to access this ToDo"))

def get_todo_filters(user):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–ª—è ToDo –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏"""
    filters = {}
    
    # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏
    if not 'System Manager' in frappe.get_roles() and not 'ToDo Manager' in frappe.get_roles():
        filters['allocated_to'] = user
    
    return filters

@frappe.whitelist()
def get_secure_todos():
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á —Å —É—á–µ—Ç–æ–º –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞"""
    user = frappe.session.user
    filters = get_todo_filters(user)
    
    todos = frappe.get_all(
        "ToDo",
        filters=filters,
        fields=["name", "description", "priority", "status", "allocated_to"],
        order_by="creation desc"
    )
    
    return todos

def before_insert_todo(doc, method):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º ToDo"""
    # –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞—á–∏
    if not has_permission('ToDo', 'create'):
        frappe.throw(_("You don't have permission to create ToDo items"))
    
    # –ï—Å–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω –¥—Ä—É–≥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞
    if doc.allocated_to and doc.allocated_to != frappe.session.user:
        if not has_permission('ToDo', 'write'):
            frappe.throw(_("You don't have permission to assign tasks to others"))

def before_save_todo(doc, method):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º ToDo"""
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    if doc.allocated_to != frappe.session.user and not 'System Manager' in frappe.get_roles():
        # –ú–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –≤—Å–µ –∑–∞–¥–∞—á–∏
        if not frappe.has_permission('ToDo', 'write'):
            frappe.throw(_("You can only edit your own tasks"))
```

### –ó–∞—â–∏—Ç–∞ –æ—Ç XSS –∏ CSRF:

```python
# my_app/my_app/utils/security.py
import frappe
import html
import bleach
from frappe.utils import sanitize_html

def sanitize_user_input(text):
    """–°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞"""
    if not text:
        return text
    
    # –û—á–∏—Å—Ç–∫–∞ HTML
    clean_text = sanitize_html(text)
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º bleach
    allowed_tags = ['p', 'br', 'strong', 'em', 'u', 'ol', 'ul', 'li', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6']
    allowed_attributes = {
        'a': ['href', 'title'],
        '*': ['class']
    }
    
    clean_text = bleach.clean(clean_text, tags=allowed_tags, attributes=allowed_attributes)
    
    return clean_text

@frappe.whitelist()
def save_safe_todo(description, priority="Medium"):
    """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ ToDo"""
    # –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤–≤–æ–¥–∞
    clean_description = sanitize_user_input(description)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã
    if len(clean_description) > 10000:
        frappe.throw(_("Description too long"))
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
    todo = frappe.new_doc("ToDo")
    todo.description = clean_description
    todo.priority = priority
    todo.insert()
    
    return todo

def validate_api_request():
    """–í–∞–ª–∏–¥–∞—Ü–∏—è API –∑–∞–ø—Ä–æ—Å–∞"""
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ CSRF —Ç–æ–∫–µ–Ω–∞
    if frappe.request and frappe.request.method in ['POST', 'PUT', 'DELETE']:
        csrf_token = frappe.get_request_header('X-Frappe-CSRF-Token')
        if not csrf_token or csrf_token != frappe.sessions.get_csrf_token():
            frappe.throw(_("CSRF token mismatch"), frappe.PermissionError)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ referer –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    referer = frappe.get_request_header('Referer')
    if referer and not referer.startswith(frappe.utils.get_url()):
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
        pass

# Hooks –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
doc_events = {
    "ToDo": {
        "validate": "my_app.security.validate_todo_access",
        "before_insert": "my_app.security.before_insert_todo",
        "before_save": "my_app.security.before_save_todo"
    }
}
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit Tests:

```python
# my_app/my_app/test_todo.py
import unittest
import frappe
from frappe.tests.utils import FrappeTestCase
from my_app.api import create_todo, get_todos, update_todo_status

class TestToDo(FrappeTestCase):
    def setUp(self):
        """Setup test data"""
        # –û—á–∏—Å—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        frappe.db.sql("DELETE FROM `tabToDo` WHERE description LIKE 'Test%'")
        frappe.db.commit()
    
    def tearDown(self):
        """Cleanup after tests"""
        frappe.db.sql("DELETE FROM `tabToDo` WHERE description LIKE 'Test%'")
        frappe.db.commit()
    
    def test_create_todo(self):
        """Test creating a new todo"""
        todo = create_todo("Test task", "High")
        
        self.assertIsNotNone(todo)
        self.assertEqual(todo.description, "Test task")
        self.assertEqual(todo.priority, "High")
        self.assertEqual(todo.status, "Open")
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ
        db_todo = frappe.get_doc("ToDo", todo.name)
        self.assertEqual(db_todo.description, "Test task")
    
    def test_get_todos(self):
        """Test getting todos"""
        # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        create_todo("Test task 1", "Low")
        create_todo("Test task 2", "High")
        
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–¥–∞—á
        todos = get_todos()
        self.assertGreaterEqual(len(todos), 2)
        
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á —Å —Ñ–∏–ª—å—Ç—Ä–æ–º
        high_priority_todos = get_todos({"priority": "High"})
        self.assertGreaterEqual(len(high_priority_todos), 1)
        
        for todo in high_priority_todos:
            self.assertEqual(todo.priority, "High")
    
    def test_update_todo_status(self):
        """Test updating todo status"""
        todo = create_todo("Test task for status update", "Medium")
        
        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        updated_todo = update_todo_status(todo.name, "Completed")
        
        self.assertEqual(updated_todo.status, "Completed")
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        db_todo = frappe.get_doc("ToDo", todo.name)
        self.assertEqual(db_todo.status, "Completed")
    
    def test_invalid_todo_creation(self):
        """Test invalid todo creation"""
        with self.assertRaises(Exception):
            # –¢–µ—Å—Ç–∏—Ä—É–µ–º –±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ)
            frappe.get_doc({
                "doctype": "ToDo",
                "priority": "High"
            }).insert()

class TestSecurity(FrappeTestCase):
    def test_todo_validation(self):
        """Test todo validation"""
        from my_app.security import validate_todo_access
        
        # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        if not frappe.db.exists("User", "test@example.com"):
            test_user = frappe.get_doc({
                "doctype": "User",
                "email": "test@example.com",
                "first_name": "Test",
                "send_welcome_email": 0
            }).insert()
        
        # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        todo = frappe.new_doc("ToDo")
        todo.description = "Test validation"
        todo.allocated_to = "test@example.com"
        
        # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–π—Ç–∏ —É—Å–ø–µ—à–Ω–æ
        # (–≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö –Ω—É–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å —Å–µ—Å—Å–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
        pass

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
def test_api_endpoints():
    """Test API endpoints manually"""
    import requests
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Å—Å–∏–∏
    session = requests.Session()
    site_url = "http://localhost:8000"
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ CSRF —Ç–æ–∫–µ–Ω–∞
    response = session.get(f"{site_url}/api/method/frappe.auth.get_logged_user")
    # ... –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API
```

### Frontend Tests:

```javascript
// my_app/public/js/test_todo.js
QUnit.module('ToDo Tests', {
    beforeEach: function() {
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–∏–∫—Å—Ç—É—Ä
        this.server = sinon.fakeServer.create();
        this.server.autoRespond = true;
    },
    
    afterEach: function() {
        // –û—á–∏—Å—Ç–∫–∞
        this.server.restore();
    }
});

QUnit.test('Create ToDo', function(assert) {
    var done = assert.async();
    
    // Mock API response
    this.server.respondWith('POST', '/api/method/my_app.api.create_todo', [
        200,
        { 'Content-Type': 'application/json' },
        JSON.stringify({
            message: {
                name: 'TODO-00001',
                description: 'Test task',
                priority: 'Medium',
                status: 'Open'
            }
        })
    ]);
    
    // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    frappe.call({
        method: 'my_app.api.create_todo',
        args: {
            description: 'Test task',
            priority: 'Medium'
        },
        callback: function(r) {
            assert.ok(r.message, 'Response received');
            assert.equal(r.message.description, 'Test task', 'Description matches');
            assert.equal(r.message.priority, 'Medium', 'Priority matches');
            done();
        }
    });
});

QUnit.test('Get Todos', function(assert) {
    var done = assert.async();
    
    // Mock data
    var mockTodos = [
        { name: 'TODO-00001', description: 'Task 1', priority: 'High' },
        { name: 'TODO-00002', description: 'Task 2', priority: 'Low' }
    ];
    
    this.server.respondWith('GET', '/api/method/my_app.api.get_todos', [
        200,
        { 'Content-Type': 'application/json' },
        JSON.stringify({ message: mockTodos })
    ]);
    
    frappe.call({
        method: 'my_app.api.get_todos',
        callback: function(r) {
            assert.ok(r.message, 'Response received');
            assert.equal(r.message.length, 2, 'Correct number of todos');
            assert.equal(r.message[0].description, 'Task 1', 'First task correct');
            done();
        }
    });
});

QUnit.test('Update Todo Status', function(assert) {
    var done = assert.async();
    
    this.server.respondWith('POST', '/api/method/my_app.api.update_todo_status', [
        200,
        { 'Content-Type': 'application/json' },
        JSON.stringify({
            message: {
                name: 'TODO-00001',
                status: 'Completed'
            }
        })
    ]);
    
    frappe.call({
        method: 'my_app.api.update_todo_status',
        args: {
            todo_name: 'TODO-00001',
            status: 'Completed'
        },
        callback: function(r) {
            assert.ok(r.message, 'Response received');
            assert.equal(r.message.status, 'Completed', 'Status updated');
            done();
        }
    });
});
```

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Production Setup:

```bash
# production.sh - –°–∫—Ä–∏–ø—Ç –¥–ª—è production —É—Å—Ç–∞–Ω–æ–≤–∫–∏
#!/bin/bash

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
sudo apt-get update
sudo apt-get install -y python3-dev python3-setuptools python3-pip
sudo apt-get install -y mariadb-server redis-server nginx supervisor

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js
curl -sL https://deb.nodesource.com/setup_16.x | sudo -E bash -
sudo apt-get install -y nodejs

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Bench
pip3 install frappe-bench

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è frappe
sudo adduser --system --group frappe
sudo mkdir -p /opt/frappe
sudo chown frappe:frappe /opt/frappe

# –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å–∞
sudo -u frappe -H bash -c "
    cd /opt/frappe &&
    bench init frappe-bench --frappe-branch version-14
"

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∞–π—Ç–∞
sudo -u frappe -H bash -c "
    cd /opt/frappe/frappe-bench &&
    bench new-site mysite.com --mariadb-root-password production_password
"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
sudo -u frappe -H bash -c "
    cd /opt/frappe/frappe-bench &&
    bench get-app my_app /path/to/my_app &&
    bench --site mysite.com install-app my_app
"

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ supervisor
sudo tee /etc/supervisor/conf.d/frappe-workers.conf > /dev/null << EOF
[group:frappe]
programs:frappe-web,frappe-long,frappe-short,frappe-default

[program:frappe-web]
command=/opt/frappe/frappe-bench/env/bin/python -m frappe.utils.bench_helper start
directory=/opt/frappe/frappe-bench/sites
user=frappe
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/opt/frappe/frappe-bench/logs/web.log

[program:frappe-default]
command=/opt/frappe/frappe-bench/env/bin/python -m frappe.utils.background_jobs --queue default
directory=/opt/frappe/frappe-bench/sites
user=frappe
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/opt/frappe/frappe-bench/logs/default_worker.log

[program:frappe-short]
command=/opt/frappe/frappe-bench/env/bin/python -m frappe.utils.background_jobs --queue short
directory=/opt/frappe/frappe-bench/sites
user=frappe
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/opt/frappe/frappe-bench/logs/short_worker.log

[program:frappe-long]
command=/opt/frappe/frappe-bench/env/bin/python -m frappe.utils.background_jobs --queue long
directory=/opt/frappe/frappe-bench/sites
user=frappe
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/opt/frappe/frappe-bench/logs/long_worker.log
EOF

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ nginx
sudo tee /etc/nginx/sites-available/mysite.com > /dev/null << EOF
upstream frappe {
    server 127.0.0.1:8000;
}

server {
    listen 80;
    server_name mysite.com;
    client_max_body_size 100M;

    # static files
    location /assets {
        alias /opt/frappe/frappe-bench/sites/assets;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    location /files {
        alias /opt/frappe/frappe-bench/sites/;
        expires 1y;
        add_header Cache-Control "public, immutable";
        try_files \$uri =404;
    }

    location / {
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header Host \$host;
        proxy_set_header X-Use-X-Accel-Redirect True;
        proxy_redirect off;
        proxy_pass http://frappe;
    }
}
EOF

sudo ln -s /etc/nginx/sites-available/mysite.com /etc/nginx/sites-enabled/mysite.com
sudo nginx -t
sudo systemctl reload nginx

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl restart frappe:*
```

### Docker Production:

```dockerfile
# Dockerfile.production
FROM python:3.10-slim

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
RUN apt-get update && apt-get install -y \
    gcc \
    g++ \
    git \
    mariadb-client \
    && rm -rf /var/lib/apt/lists/*

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js
RUN curl -sL https://deb.nodesource.com/setup_16.x | bash - \
    && apt-get install -y nodejs

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
RUN useradd -m -s /bin/bash frappe

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Bench
RUN pip install frappe-bench

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
COPY --chown=frappe:frappe . /home/frappe/frappe-bench/apps/my_app

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è frappe
USER frappe
WORKDIR /home/frappe/frappe-bench

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
RUN bench get-app my_app /home/frappe/frappe-bench/apps/my_app

# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∞–π—Ç–∞
RUN bench new-site site1.local --mariadb-root-password 123 --admin-password admin

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —Å–∞–π—Ç
RUN bench --site site1.local install-app my_app

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
RUN bench setup production frappe

EXPOSE 8000

CMD ["bench", "start"]
```

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

```python
# my_app/hooks.py - –•–æ—Ä–æ—à–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è hooks
app_name = "my_app"
app_title = "My App"
app_publisher = "My Publisher"
app_version = "0.0.1"

# –°–∞–π—Ç
website_context = {
    "favicon": "/assets/my_app/images/favicon.ico",
    "splash_image": "/assets/my_app/images/splash.png"
}

# –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
scheduler_events = {
    "daily": [
        "my_app.tasks.daily_cleanup"
    ],
    "hourly": [
        "my_app.tasks.hourly_sync"
    ],
    "all": [
        "my_app.tasks.every_minute_check"
    ]
}

# API –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
override_whitelisted_methods = {
    "frappe.desk.form.save.handler": "my_app.api.custom_save"
}

# DocType —Å–æ–±—ã—Ç–∏—è
doc_events = {
    "*": {
        "on_update": "my_app.event_handlers.log_changes",
        "after_insert": "my_app.event_handlers.track_creation"
    },
    "ToDo": {
        "on_submit": "my_app.todo.handlers.on_submit",
        "on_cancel": "my_app.todo.handlers.on_cancel",
        "before_save": "my_app.todo.handlers.before_save"
    }
}

# –†–∞–∑—Ä–µ—à–µ–Ω–∏—è
has_permission = {
    "ToDo": "my_app.permissions.todo_has_permission",
    "Custom Customer": "my_app.permissions.customer_has_permission"
}

# –ü–æ–ª—è –¥–ª—è –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –ª–æ–≥–∞—Ö
doc_events_ignore = {
    "*": ["modified", "modified_by", "owner"]
}
```

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

```python
# my_app/utils/performance.py
import frappe
import time
from functools import wraps
from frappe.utils import cint

def cache_results(ttl=300):
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"""
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            # –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞ –∫—ç—à–∞
            cache_key = f"{func.__name__}:{str(args)}:{str(kwargs)}"
            cached_result = frappe.cache().get_value(cache_key)
            
            if cached_result is not None:
                return cached_result
            
            # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
            result = func(*args, **kwargs)
            
            # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à
            frappe.cache().set_value(cache_key, result, expires_in_sec=ttl)
            
            return result
        return wrapper
    return decorator

@cache_results(ttl=600)  # 10 –º–∏–Ω—É—Ç
@frappe.whitelist()
def get_expensive_report_data(filters=None):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º"""
    # –ó–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    data = frappe.db.sql("""
        SELECT 
            customer,
            SUM(amount) as total_amount,
            COUNT(*) as order_count
        FROM `tabSales Order`
        WHERE docstatus = 1
        GROUP BY customer
        ORDER BY total_amount DESC
    """, as_dict=True)
    
    return data

def optimize_queries():
    """–ü—Ä–∏–º–µ—Ä –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤"""
    
    # –ü–õ–û–•–û: –ú–Ω–æ–≥–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    # customers = frappe.get_all('Customer')
    # for customer in customers:
    #     details = frappe.get_doc('Customer', customer.name)  # –û—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å!
    
    # –•–û–†–û–®–û: –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å —Å –ø–æ–ª—è–º–∏
    customers = frappe.get_all(
        'Customer',
        fields=['name', 'customer_name', 'email', 'territory'],
        limit_page_length=1000
    )
    
    return customers

@frappe.whitelist()
def batch_process_large_dataset():
    """–ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö"""
    batch_size = 500
    processed = 0
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
    todo_names = frappe.get_all(
        'ToDo',
        filters={'status': 'Open'},
        pluck='name',
        limit=10000  # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö –Ω–∞–±–æ—Ä–æ–≤
    )
    
    for i in range(0, len(todo_names), batch_size):
        batch = todo_names[i:i + batch_size]
        
        # –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
        for todo_name in batch:
            try:
                todo = frappe.get_doc('ToDo', todo_name)
                todo.status = 'In Progress'
                todo.save()
                processed += 1
            except Exception as e:
                frappe.log_error(f"Batch processing error: {str(e)}")
        
        # Commit –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –±–∞—Ç—á–∞
        frappe.db.commit()
        
        # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ
        frappe.publish_progress(
            percent=i/len(todo_names)*100,
            title=_('Processing...'),
            description=f'Processed {processed} of {len(todo_names)}'
        )
    
    return {'processed': processed, 'total': len(todo_names)}

# –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
def setup_indexes():
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"""
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª–µ–π
    indexes_config = [
        ('ToDo', 'status'),
        ('ToDo', 'priority'),
        ('ToDo', 'allocated_to'),
        ('ToDo', ['status', 'priority']),  # –ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π –∏–Ω–¥–µ–∫—Å
        ('Custom Customer', 'customer_group'),
        ('Sales Order', 'customer'),
        ('Sales Order', 'transaction_date'),
        ('Sales Order', ['customer', 'docstatus'])
    ]
    
    for doctype, fieldnames in indexes_config:
        if isinstance(fieldnames, str):
            fieldnames = [fieldnames]
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞
        try:
            index_name = f"idx_{doctype.lower()}_{'_'.join(fieldnames)}".replace(' ', '_')
            frappe.db.sql(f"""
                CREATE INDEX IF NOT EXISTS `{index_name}` 
                ON `tab{doctype}` ({','.join(f'`{f}`' for f in fieldnames)})
            """)
        except Exception as e:
            frappe.log_error(f"Index creation error: {str(e)}")
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

```python
# my_app/utils/error_handling.py
import frappe
import traceback
import logging
from frappe import _
from frappe.utils import now

class ErrorHandler:
    @staticmethod
    def handle_error(error, context=""):
        """–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫"""
        error_details = {
            'error': str(error),
            'traceback': traceback.format_exc(),
            'context': context,
            'timestamp': now(),
            'user': frappe.session.user,
            'request': getattr(frappe.local, 'request', {}).get('path') if hasattr(frappe.local, 'request') else None
        }
        
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
        try:
            error_log = frappe.get_doc({
                'doctype': 'Error Log',
                'method': context,
                'error': error_details['traceback']
            })
            error_log.insert(ignore_permissions=True)
        except Exception as log_error:
            # –ï—Å–ª–∏ –Ω–µ –º–æ–∂–µ–º –∑–∞–ø–∏—Å–∞—Ç—å –≤ –±–∞–∑—É, –ª–æ–≥–∏—Ä—É–µ–º –≤ —Ñ–∞–π–ª
            frappe.log_error(f"Could not create error log: {str(log_error)}")
        
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        if frappe.conf.developer_mode:
            # –í —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–Ω—É—é –æ—à–∏–±–∫—É
            frappe.throw(error_details['traceback'])
        else:
            # –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ - –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            frappe.throw(_("An error occurred. Please contact administrator."))

def safe_execute(func, *args, **kwargs):
    """–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫"""
    try:
        return func(*args, **kwargs)
    except Exception as e:
        ErrorHandler.handle_error(e, f"{func.__module__}.{func.__name__}")
        return None

@frappe.whitelist()
def robust_api_method(param1, param2=None):
    """–ü—Ä–∏–º–µ—Ä –Ω–∞–¥–µ–∂–Ω–æ–≥–æ API –º–µ—Ç–æ–¥–∞"""
    try:
        # –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        if not param1:
            frappe.throw(_("Parameter param1 is required"))
        
        # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
        result = process_data(param1, param2)
        
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        frappe.log(
            f"API method executed successfully with params: {param1}, {param2}",
            "INFO"
        )
        
        return result
        
    except frappe.ValidationError:
        # –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        raise
    except Exception as e:
        # –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ
        ErrorHandler.handle_error(e, "robust_api_method")
        return None

def process_data(param1, param2=None):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π"""
    # –í–∞–ª–∏–¥–∞—Ü–∏—è
    if not isinstance(param1, str):
        raise ValueError("param1 must be string")
    
    if param2 and not isinstance(param2, dict):
        raise ValueError("param2 must be dictionary if provided")
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞
    processed_data = {
        'input': param1,
        'processed': param1.upper(),
        'length': len(param1),
        'metadata': param2 or {}
    }
    
    return processed_data

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
def log_performance(func):
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"""
    @wraps(func)
    def wrapper(*args, **kwargs):
        start_time = time.time()
        
        try:
            result = func(*args, **kwargs)
            execution_time = time.time() - start_time
            
            # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π
            if execution_time > 1.0:  # –ë–æ–ª—å—à–µ 1 —Å–µ–∫—É–Ω–¥—ã
                frappe.log(
                    f"SLOW EXECUTION: {func.__name__} took {execution_time:.2f}s",
                    "WARNING"
                )
            
            return result
            
        except Exception as e:
            execution_time = time.time() - start_time
            frappe.log(
                f"ERROR in {func.__name__} after {execution_time:.2f}s: {str(e)}",
                "ERROR"
            )
            raise
    
    return wrapper
```

> –≠—Ç–æ—Ç –º–∞–Ω—É–∞–ª –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã `Frappe Framework`

> –î–ª—è –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –∏ –∏–∑—É—á–∞—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é.

