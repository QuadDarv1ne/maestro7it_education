# ะกัััะบัััะฐ ะฟัะพะตะบัะฐ Sausage Store

## ๐ ะัะณะฐะฝะธะทะฐัะธั ัะฐะนะปะพะฒ CI/CD

```
sausage-store/
โโโ .gitlab/
โ   โโโ ci/
โ       โโโ frontend.yml           # Pipeline ะดะปั frontend
โ       โโโ backend.yml            # Pipeline ะดะปั backend
โ
โโโ .gitlab-ci.yml                 # ะะปะฐะฒะฝัะน ัะฐะนะป (ะฒะบะปััะฐะตั ะฒัะต ะพััะฐะปัะฝัะต)
โ
โโโ frontend/
โ   โโโ src/
โ   โโโ dist/
โ   โโโ package.json
โ   โโโ ...
โ
โโโ backend/
โ   โโโ src/
โ   โโโ target/
โ   โโโ pom.xml
โ   โโโ settings.xml               # ะะฐัััะพะนะบะธ Maven ะดะปั Nexus
โ   โโโ ...
โ
โโโ README.md
```

## ๐ ะะฝััััะบัะธั ะฟะพ ัะฐะทะฒะตัััะฒะฐะฝะธั

### ะจะฐะณ 1: ะกะพะทะดะฐะนัะต ััััะบัััั ะฟะฐะฟะพะบ

```bash
# ะ ะบะพัะฝะต ะฟัะพะตะบัะฐ ัะพะทะดะฐะนัะต ะฟะฐะฟะบะธ
mkdir -p .gitlab/ci
```

### ะจะฐะณ 2: ะะฐะทะผะตััะธัะต ัะฐะนะปั

1. **`.gitlab/ci/frontend.yml`** - pipeline ะดะปั frontend
2. **`.gitlab/ci/backend.yml`** - pipeline ะดะปั backend
3. **`.gitlab-ci.yml`** - ะณะปะฐะฒะฝัะน ัะฐะนะป ะฒ ะบะพัะฝะต ะฟัะพะตะบัะฐ
4. **`backend/settings.xml`** - ะฝะฐัััะพะนะบะธ Maven ะดะปั Nexus

### ะจะฐะณ 3: ะะฐัััะพะนัะต GitLab CI/CD ะฟะตัะตะผะตะฝะฝัะต

ะะตัะตะนะดะธัะต ะฒ **Settings โ CI/CD โ Variables** ะธ ะดะพะฑะฐะฒััะต:

#### ๐ ะะฑัะทะฐัะตะปัะฝัะต ะฟะตัะตะผะตะฝะฝัะต:

| ะะตัะตะผะตะฝะฝะฐั | ะะฝะฐัะตะฝะธะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|-----------|---------|-----|----------|
| `TELEGRAM_BOT_TOKEN` | `ะฒะฐั_ัะพะบะตะฝ` | Protected, Masked | ะขะพะบะตะฝ Telegram ะฑะพัะฐ |
| `TELEGRAM_CHAT_ID` | `ะฒะฐั_chat_id` | Protected | ID ัะฐัะฐ ะดะปั ัะฒะตะดะพะผะปะตะฝะธะน |
| `NEXUS_REPO_USER` | ะฒะฐั ะปะพะณะธะฝ | Protected | ะะพะณะธะฝ ะฒ Nexus |
| `NEXUS_REPO_PASS` | ะฒะฐั ะฟะฐัะพะปั | Protected, Masked | ะะฐัะพะปั ะฒ Nexus |
| `NEXUS_REPO_URL` | `https://nexus.example.com` | - | URL ะฒะฐัะตะณะพ Nexus |
| `NEXUS_REPO_FRONTEND_NAME` | `sausage-store-frontend` | - | ะะผั ัะตะฟะพะทะธัะพัะธั frontend |
| `NEXUS_REPO_BACKEND_NAME` | `sausage-store-backend` | - | ะะผั ัะตะฟะพะทะธัะพัะธั backend |

#### ๐ SonarQube ะฟะตัะตะผะตะฝะฝัะต (Frontend):

| ะะตัะตะผะตะฝะฝะฐั | ะะฟะธัะฐะฝะธะต |
|-----------|----------|
| `SONAR_PROJECT_KEY_FRONT` | ะะปัั ะฟัะพะตะบัะฐ frontend |
| `SONAR_PROJECT_NAME_FRONT` | ะะผั ะฟัะพะตะบัะฐ frontend |
| `SONARQUBE_URL` | URL SonarQube ัะตัะฒะตัะฐ |
| `SONAR_LOGIN_FRONT` | ะขะพะบะตะฝ ะดะปั frontend |

#### ๐ SonarQube ะฟะตัะตะผะตะฝะฝัะต (Backend):

| ะะตัะตะผะตะฝะฝะฐั | ะะฟะธัะฐะฝะธะต |
|-----------|----------|
| `SONAR_PROJECT_KEY_BACK` | ะะปัั ะฟัะพะตะบัะฐ backend |
| `SONAR_PROJECT_NAME_BACK` | ะะผั ะฟัะพะตะบัะฐ backend |
| `SONAR_LOGIN_BACK` | ะขะพะบะตะฝ ะดะปั backend |

### ะจะฐะณ 4: ะัะพะฒะตัััะต ะฝะฐัััะพะนะบะธ

```bash
# ะะฐะบะพะผะผะธัััะต ะธะทะผะตะฝะตะฝะธั
git add .gitlab/ .gitlab-ci.yml backend/settings.xml
git commit -m "feat: ัะปัััะตะฝะฝัะน CI/CD pipeline ะดะปั frontend ะธ backend"
git push
```

## โจ ะงัะพ ัะปัััะตะฝะพ

### ๐ฏ Frontend Pipeline

#### ะะตะทะพะฟะฐัะฝะพััั
- โ ะขะพะบะตะฝั ะฒัะฝะตัะตะฝั ะฒ ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
- โ ะงัะฒััะฒะธัะตะปัะฝัะต ะดะฐะฝะฝัะต ะทะฐัะธัะตะฝั (masked, protected)

#### ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั
- โ ะััะธัะพะฒะฐะฝะธะต `node_modules`
- โ ะัะฟะพะปัะทะพะฒะฐะฝะธะต `npm ci` ะฒะผะตััะพ `npm install`
- โ ะะตะณะบะพะฒะตัะฝัะต Docker ะพะฑัะฐะทั (alpine)

#### ะะฐะดะตะถะฝะพััั
- โ ะัะพะฒะตัะบะฐ HTTP ะบะพะดะพะฒ ะฟัะธ ะทะฐะณััะทะบะต
- โ `allow_failure` ะดะปั ะฝะตะบัะธัะธัะฝัั ะดะถะพะฑ
- โ ะะฒัะพะผะฐัะธัะตัะบะฐั ะพัะธััะบะฐ ะฐััะตัะฐะบัะพะฒ (1 ะฝะตะดะตะปั)

#### ะฃะดะพะฑััะฒะพ
- โ ะัะฐัะธะฒัะต ัะฒะตะดะพะผะปะตะฝะธั ะฒ Telegram ั ัะผะพะดะทะธ
- โ ะะฐะฟััะบ ัะพะปัะบะพ ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ frontend
- โ ะะพะดัะปัะฝะฐั ััััะบัััะฐ

### โ๏ธ Backend Pipeline

#### ะะตะทะพะฟะฐัะฝะพััั
- โ ะขะพะบะตะฝั ะฒ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั
- โ ะะตะทะพะฟะฐัะฝะฐั ะฐััะตะฝัะธัะธะบะฐัะธั ะฒ Nexus ัะตัะตะท settings.xml

#### ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั
- โ ะััะธัะพะฒะฐะฝะธะต Maven ัะตะฟะพะทะธัะพัะธั (.m2)
- โ ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะพัะธัะธะฐะปัะฝะพะณะพ Maven ะพะฑัะฐะทะฐ
- โ ะะฟัะธะผะธะทะฐัะธั ัะฑะพัะบะธ ั `DskipTests`

#### ะะฐะดะตะถะฝะพััั
- โ SAST ะฐะฝะฐะปะธะท ัะตัะตะท Semgrep
- โ Quality Gate ะฒ SonarQube
- โ ะัะพะฒะตัะบะฐ ััะฟะตัะฝะพััะธ ะดะตะฟะปะพั
- โ ะกะพััะฐะฝะตะฝะธะต ะฐััะตัะฐะบัะพะฒ ะฟัะธ ะพัะธะฑะบะต

#### ะฃะดะพะฑััะฒะพ
- โ ะัะฐัะธะฒัะต ัะฒะตะดะพะผะปะตะฝะธั ั ะธะฝัะพัะผะฐัะธะตะน ะพ JAR ัะฐะนะปะต
- โ ะะฐะฟััะบ ัะพะปัะบะพ ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ backend
- โ ะะพะดัะพะฑะฝัะต ะปะพะณะธ ั ัะผะพะดะทะธ

## ๐ง ะกัััะบัััะฐ Backend Pipeline

```
โโโโโโโโโโโโโโโ
โ   BUILD     โ โ ะกะฑะพัะบะฐ JAR ั Maven
โโโโโโโโฌโโโโโโโ
       โ
       โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโ
       โ              โ              โ
โโโโโโโโผโโโโโโโ โโโโโโผโโโโโโ โโโโโโโโผโโโโโโโ
โ  Semgrep    โ โ SonarQubeโ โ   Release   โ
โ   SAST      โ โ   SAST   โ โ   to Nexus  โ
โโโโโโโโฌโโโโโโโ โโโโโโฌโโโโโโ โโโโโโโโฌโโโโโโโ
       โ              โ              โ
       โโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโ
                      โ
               โโโโโโโโผโโโโโโโ
               โ   Telegram  โ
               โ   Notify    โ
               โโโโโโโโโโโโโโโ
```

## ๐ ะัะพะฑะตะฝะฝะพััะธ Backend Pipeline

### Build Stage
- ะกะฑะพัะบะฐ ั Maven
- ะกะพััะฐะฝะตะฝะธะต ะธะฝัะพัะผะฐัะธะธ ะพ JAR ัะฐะนะปะต
- ะััะธัะพะฒะฐะฝะธะต ะทะฐะฒะธัะธะผะพััะตะน

### Test Stage
1. **Semgrep SAST**
   - ะะฝะฐะปะธะท ะฑะตะทะพะฟะฐัะฝะพััะธ ะบะพะดะฐ
   - ะัะพะฒะตัะบะฐ ะฟะพ OWASP Top 10
   - ะะตะฝะตัะฐัะธั JSON ะพััะตัะฐ

2. **SonarQube**
   - ะะฝะฐะปะธะท ะบะฐัะตััะฒะฐ ะบะพะดะฐ
   - Quality Gate ะฟัะพะฒะตัะบะฐ
   - ะะตััะธะบะธ ะฟะพะบัััะธั ัะตััะฐะผะธ

### Release Stage
- ะะฐะณััะทะบะฐ ะฒ Nexus
- ะขะพะปัะบะพ ะดะปั ะฒะตัะพะบ main/master/dev
- ะัะฟะพะปัะทะพะฒะฐะฝะธะต settings.xml ะดะปั ะฐััะตะฝัะธัะธะบะฐัะธะธ

### Notify Stage
- ะฃะฒะตะดะพะผะปะตะฝะธั ะฒ Telegram
- ะะฝัะพัะผะฐัะธั ะพ JAR ัะฐะนะปะต
- ะกััะปะบะธ ะฝะฐ ะฐััะตัะฐะบัั

## ๐๏ธ ะะฐัััะพะนะบะฐ Maven settings.xml

ะคะฐะนะป `backend/settings.xml` ะธัะฟะพะปัะทัะตั ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั:

```xml
<username>${env.NEXUS_REPO_USER}</username>
<password>${env.NEXUS_REPO_PASS}</password>
<url>${env.NEXUS_REPO_URL}/repository/maven-public/</url>
```

ะญัะพ ะพะฑะตัะฟะตัะธะฒะฐะตั ะฑะตะทะพะฟะฐัะฝะพััั - credentials ะฝะต ััะฐะฝัััั ะฒ ะบะพะดะต.

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะฝะฐัััะพะนะบะธ

### ะะฐัััะพะนะบะฐ GitLab Runner

ะฃะฑะตะดะธัะตัั, ััะพ ั ะฒะฐั ะตััั runner ั ัะตะณะพะผ `docker`:

```yaml
tags:
  - docker
```

### ะะฐัััะพะนะบะฐ SonarQube ะดะปั Backend

ะะพะฑะฐะฒััะต ะฒ `backend/pom.xml`:

```xml
<properties>
    <sonar.projectKey>${env.SONAR_PROJECT_KEY_BACK}</sonar.projectKey>
    <sonar.projectName>${env.SONAR_PROJECT_NAME_BACK}</sonar.projectName>
    <sonar.host.url>${env.SONARQUBE_URL}</sonar.host.url>
    <sonar.login>${env.SONAR_LOGIN_BACK}</sonar.login>
</properties>
```

### ะะฐัััะพะนะบะฐ Nexus Repository

ะ `backend/pom.xml` ะดะพะฑะฐะฒััะต:

```xml
<distributionManagement>
    <repository>
        <id>nexus</id>
        <url>${env.NEXUS_REPO_URL}/repository/${env.NEXUS_REPO_BACKEND_NAME}/</url>
    </repository>
</distributionManagement>
```

## ๐ ะะพะฝะธัะพัะธะฝะณ Pipeline

### ะัะพะฒะตัะบะฐ ััะฐัััะฐ
```bash
# ะัะพัะผะพัั ะฟะพัะปะตะดะฝะธั pipeline
git log --oneline -10

# ะัะพะฒะตัะบะฐ ัะตะบััะตะณะพ ััะฐัััะฐ
# ะ GitLab: CI/CD โ Pipelines
```

### ะะพะณะธ
ะัะต ะดะถะพะฑั ะฒัะฒะพะดัั ะฟะพะดัะพะฑะฝัะต ะปะพะณะธ ั ัะผะพะดะทะธ ะดะปั ะปัััะตะน ัะธัะฐะตะผะพััะธ:
- ๐จ ะกะฑะพัะบะฐ
- ๐ ะะฝะฐะปะธะท
- ๐ฆ ะะพะดะณะพัะพะฒะบะฐ
- โฌ๏ธ ะะฐะณััะทะบะฐ
- โ ะฃัะฟะตั
- โ ะัะธะฑะบะฐ

## ๐ ะฃัััะฐะฝะตะฝะธะต ะฟัะพะฑะปะตะผ

### Frontend

#### "No runner available"
ะฃะฑะตะดะธัะตัั, ััะพ ั ะฒะฐั ะฝะฐัััะพะตะฝ GitLab Runner ั ัะตะณะพะผ `docker`

#### "Permission denied" ะฟัะธ ะทะฐะณััะทะบะต ะฒ Nexus
ะัะพะฒะตัััะต ะฟัะฐะฒะธะปัะฝะพััั `NEXUS_REPO_USER` ะธ `NEXUS_REPO_PASS`

#### ะฃะฒะตะดะพะผะปะตะฝะธั ะฝะต ะฟัะธัะพะดัั ะฒ Telegram
ะัะพะฒะตัััะต:
- ะัะฐะฒะธะปัะฝะพััั `TELEGRAM_BOT_TOKEN`
- ะัะฐะฒะธะปัะฝะพััั `TELEGRAM_CHAT_ID`
- ะะพั ะดะพะฑะฐะฒะปะตะฝ ะฒ ัะฐั

### Backend

#### "Failed to execute goal on project"
ะัะพะฒะตัััะต:
- ะัะฐะฒะธะปัะฝะพััั `settings.xml`
- ะะพัััะฟะฝะพััั Nexus ัะตะฟะพะทะธัะพัะธั
- ะะพััะตะบัะฝะพััั ะฟะตัะตะผะตะฝะฝัั `NEXUS_REPO_*`

#### "SonarQube Quality Gate failed"
- ะญัะพ ะฝะพัะผะฐะปัะฝะพ ะดะปั ะฝะพะฒะพะณะพ ะฟัะพะตะบัะฐ
- ะะถะพะฑะฐ ะฝะต ะฑะปะพะบะธััะตั pipeline (`allow_failure: true`)
- ะัะฟัะฐะฒััะต ะฟัะพะฑะปะตะผั ะฒ ะบะพะดะต ัะพะณะปะฐัะฝะพ ะพััะตัั SonarQube

#### "Semgrep found issues"
- ะัะพะฒะตัััะต ะพััะตั ะฒ ะฐััะตัะฐะบัะฐั
- ะะถะพะฑะฐ ะฝะต ะฑะปะพะบะธััะตั pipeline (`allow_failure: true`)
- ะัะฟัะฐะฒััะต ะบัะธัะธัะตัะบะธะต ััะทะฒะธะผะพััะธ

#### Maven ะฝะต ะผะพะถะตั ัะบะฐัะฐัั ะทะฐะฒะธัะธะผะพััะธ
```bash
# ะัะพะฒะตัััะต ะฝะฐัััะพะนะบะธ ะทะตัะบะฐะปะฐ ะฒ settings.xml
# ะฃะฑะตะดะธัะตัั ััะพ NEXUS_REPO_URL ะดะพัััะฟะตะฝ
curl ${NEXUS_REPO_URL}/repository/maven-public/
```

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝะฐั ะธะฝัะพัะผะฐัะธั

### ะะพะบัะผะตะฝัะฐัะธั
- [GitLab CI/CD](https://docs.gitlab.com/ee/ci/)
- [Maven Settings](https://maven.apache.org/settings.html)
- [SonarQube Scanner](https://docs.sonarqube.org/latest/analysis/scan/sonarscanner-for-maven/)
- [Semgrep Rules](https://semgrep.dev/docs/)

### ะะพะปะตะทะฝัะต ะบะพะผะฐะฝะดั

```bash
# ะะพะบะฐะปัะฝะฐั ะฟัะพะฒะตัะบะฐ frontend
cd frontend
npm install
npm run build

# ะะพะบะฐะปัะฝะฐั ะฟัะพะฒะตัะบะฐ backend
cd backend
mvn clean package
mvn verify

# ะัะพะฒะตัะบะฐ settings.xml
mvn help:effective-settings
```

## ๐ก ะกะพะฒะตัั

- ะัะฟะพะปัะทัะนัะต `git push -o ci.skip` ััะพะฑั ะฟัะพะฟัััะธัั pipeline
- ะัะพะฒะตััะนัะต ะปะพะณะธ ะบะฐะถะดะพะน ะดะถะพะฑั ะดะปั ะพัะปะฐะดะบะธ
- ะะฐัััะพะนัะต ัะฒะตะดะพะผะปะตะฝะธั ะพ failed pipeline ะฝะฐ email
- ะะตะณัะปััะฝะพ ะฟัะพะฒะตััะนัะต ะพััะตัั SonarQube ะธ Semgrep
- ะัะธัะฐะนัะต ััะฐััะต ะฐััะตัะฐะบัั ะฒ Nexus
