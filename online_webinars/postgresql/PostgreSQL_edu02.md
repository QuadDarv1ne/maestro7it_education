# Primary –∏ Foreign Keys –≤ PostgreSQL. –î–∏–∞–≥—Ä–∞–º–º—ã. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π

## –í–≤–µ–¥–µ–Ω–∏–µ

`PostgreSQL` ‚Äì –º–æ—â–Ω–∞—è –æ–±—ä–µ–∫—Ç–Ω–æ-—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö —Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º. –í —ç—Ç–æ–º –º–∞—Ç–µ—Ä–∏–∞–ª–µ –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ç—Ä–∏ –≤–∞–∂–Ω—ã–µ —Ç–µ–º—ã:

1. **Primary –∏ Foreign Keys** ‚Äì –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
2. **–î–∏–∞–≥—Ä–∞–º–º—ã** ‚Äì –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–†–∞—Å—à–∏—Ä–µ–Ω–∏—è** ‚Äì –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –°–£–ë–î

> **–¶–µ–ª—å –º–∞—Ç–µ—Ä–∏–∞–ª–∞**: –ù–∞—É—á–∏—Ç—å—Å—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–¥–µ–∂–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ–º –Ω–æ—Ä–º —Ñ–æ—Ä–º, –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ PostgreSQL.

## 1. Primary Key –∏ Foreign Key –≤ PostgreSQL

### 1.1. –ß—Ç–æ —Ç–∞–∫–æ–µ Primary Key?

`–ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á (Primary Key)` ‚Äì —ç—Ç–æ —Å—Ç–æ–ª–±–µ—Ü (–∏–ª–∏ –Ω–∞–±–æ—Ä —Å—Ç–æ–ª–±—Ü–æ–≤), –∫–æ—Ç–æ—Ä—ã–π **—É–Ω–∏–∫–∞–ª—å–Ω–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∫–∞–∂–¥—É—é –∑–∞–ø–∏—Å—å** –≤ —Ç–∞–±–ª–∏—Ü–µ. –û–Ω —è–≤–ª—è–µ—Ç—Å—è —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö.

#### –°–≤–æ–π—Å—Ç–≤–∞ Primary Key:

‚úÖ **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å** ‚Äì –∫–∞–∂–¥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º (–¥—É–±–ª–∏–∫–∞—Ç—ã –∑–∞–ø—Ä–µ—â–µ–Ω—ã)
‚úÖ **NOT NULL** ‚Äì –Ω–µ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å NULL-–∑–Ω–∞—á–µ–Ω–∏—è
‚úÖ **–ò–Ω–¥–µ–∫—Å** ‚Äì –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞
‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** ‚Äì –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –¥–æ–ª–∂–Ω—ã –∏–∑–º–µ–Ω—è—Ç—å—Å—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏

#### –¢–∏–ø—ã –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π:

1. **–°—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–π –∫–ª—é—á** ‚Äì –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (SERIAL, UUID)
2. **–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–ª—é—á** ‚Äì —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ (email, –ò–ù–ù, –Ω–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞)

### 1.2. –°–æ–∑–¥–∞–Ω–∏–µ Primary Key

#### –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã:

```sql
-- –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–Ω—ã–π —Å—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–π –∫–ª—é—á
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);

-- UUID –∫–∞–∫ –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á (—Ç—Ä–µ–±—É–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è uuid-ossp)
CREATE TABLE products (
    product_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(100) NOT NULL,
    price DECIMAL(10,2) NOT NULL
);
```

#### –°–æ—Å—Ç–∞–≤–Ω–æ–π –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á:

```sql
-- –°–≤—è–∑—É—é—â–∞—è —Ç–∞–±–ª–∏—Ü–∞ "–º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º"
CREATE TABLE order_items (
    order_id INT,
    product_id INT,
    quantity INT NOT NULL CHECK (quantity > 0),
    price DECIMAL(10,2) NOT NULL,
    PRIMARY KEY (order_id, product_id),
    FOREIGN KEY (order_id) REFERENCES orders(order_id),
    FOREIGN KEY (product_id) REFERENCES products(product_id)
);
```

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã
SELECT user_id, COUNT(*) 
FROM users 
GROUP BY user_id 
HAVING COUNT(*) > 1;

-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
ALTER TABLE users ADD PRIMARY KEY (user_id);
```

#### –£–¥–∞–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞:

```sql
-- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–º–µ–Ω–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
SELECT constraint_name 
FROM information_schema.table_constraints 
WHERE table_name = 'users' AND constraint_type = 'PRIMARY KEY';

-- –£–¥–∞–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
ALTER TABLE users DROP CONSTRAINT users_pkey;
```

> **–í–∞–∂–Ω–æ**: –£–¥–∞–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ –º–æ–∂–µ—Ç –Ω–∞—Ä—É—à–∏—Ç—å —Å—Å—ã–ª–æ—á–Ω—É—é —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å!

### 1.3. –ß—Ç–æ —Ç–∞–∫–æ–µ Foreign Key?

`–í–Ω–µ—à–Ω–∏–π –∫–ª—é—á (Foreign Key)` ‚Äì —ç—Ç–æ **–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å—Å—ã–ª–æ—á–Ω–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏**, –∫–æ—Ç–æ—Ä–æ–µ —Å–≤—è–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö. –û–Ω –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ:

- –ó–Ω–∞—á–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞ –ª–∏–±–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Ç–∞–±–ª–∏—Ü–µ
- –õ–∏–±–æ —Ä–∞–≤–Ω–æ `NULL` *(–µ—Å–ª–∏ —Å—Ç–æ–ª–±–µ—Ü –¥–æ–ø—É—Å–∫–∞–µ—Ç NULL)*

#### –¢–∏–ø—ã —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏:

- **–û–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É** (1:1) ‚Äì —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á
- **–û–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º** (1:N) ‚Äì –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –≤ "–º–Ω–æ–≥–∏—Ö"
- **–ú–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º** (N:M) ‚Äì —Å–≤—è–∑—É—é—â–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å —Å–æ—Å—Ç–∞–≤–Ω—ã–º –∫–ª—é—á–æ–º

### 1.4. –°–æ–∑–¥–∞–Ω–∏–µ Foreign Key

#### –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã:

```sql
-- –ü—Ä–æ—Å—Ç–∞—è —Å—Å—ã–ª–∫–∞
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    user_id INT REFERENCES users(user_id),
    order_date DATE NOT NULL DEFAULT CURRENT_DATE,
    total_amount DECIMAL(12,2) NOT NULL
);

-- –° —è–≤–Ω—ã–º –∏–º–µ–Ω–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    user_id INT,
    order_date DATE NOT NULL,
    status VARCHAR(20) DEFAULT 'pending',
    CONSTRAINT fk_orders_user 
        FOREIGN KEY (user_id) REFERENCES users(user_id)
);
```

#### –° –¥–µ–π—Å—Ç–≤–∏—è–º–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:

```sql
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    user_id INT,
    order_date DATE NOT NULL,
    CONSTRAINT fk_user 
        FOREIGN KEY (user_id) 
        REFERENCES users(user_id) 
        ON DELETE CASCADE      -- –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑—ã –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        ON UPDATE CASCADE      -- –û–±–Ω–æ–≤–∏—Ç—å user_id –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤ users
);

-- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–µ–π—Å—Ç–≤–∏–π
CREATE TABLE user_profiles (
    profile_id SERIAL PRIMARY KEY,
    user_id INT UNIQUE,        -- 1:1 —Å–≤—è–∑—å
    bio TEXT,
    CONSTRAINT fk_profile_user 
        FOREIGN KEY (user_id) 
        REFERENCES users(user_id) 
        ON DELETE SET NULL     -- –û–±–Ω—É–ª–∏—Ç—å —Å—Å—ã–ª–∫—É –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
);
```

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º
SELECT user_id 
FROM orders 
WHERE user_id NOT IN (SELECT user_id FROM users);

-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞
ALTER TABLE orders 
ADD CONSTRAINT fk_user 
FOREIGN KEY (user_id) REFERENCES users(user_id);
```

#### –£–¥–∞–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞:

```sql
-- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π —Ç–∞–±–ª–∏—Ü—ã
SELECT constraint_name, constraint_type 
FROM information_schema.table_constraints 
WHERE table_name = 'orders';

-- –£–¥–∞–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞
ALTER TABLE orders DROP CONSTRAINT fk_user;
```
### 1.5. –î–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ (ON DELETE / ON UPDATE)

–ü—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å **–ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ —Å—Å—ã–ª–æ—á–Ω–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏**:

| –î–µ–π—Å—Ç–≤–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|----------|----------|-------------------|
| **NO ACTION** | –ó–∞–ø—Ä–µ—â–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) | –ö–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–Ω—ã |
| **RESTRICT** | –¢–æ –∂–µ, —á—Ç–æ NO ACTION, –Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è | –î–ª—è —Å—Ç—Ä–æ–≥–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ |
| **CASCADE** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ | –î–ª—è –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è |
| **SET NULL** | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –≤ NULL | –ö–æ–≥–¥–∞ —Å–≤—è–∑—å –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ |
| **SET DEFAULT** | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –†–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |

#### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```sql
-- CASCADE: –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª—è–µ—Ç –≤—Å–µ –µ–≥–æ –∑–∞–∫–∞–∑—ã
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    user_id INT NOT NULL,
    CONSTRAINT fk_user 
        FOREIGN KEY (user_id) REFERENCES users(user_id) 
        ON DELETE CASCADE
);

-- SET NULL: –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä—ã –æ—Å—Ç–∞—é—Ç—Å—è, –Ω–æ —Ç–µ—Ä—è—é—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    category_id INT,
    name VARCHAR(100),
    CONSTRAINT fk_category 
        FOREIGN KEY (category_id) REFERENCES categories(category_id) 
        ON DELETE SET NULL
);

-- RESTRICT: –ó–∞–ø—Ä–µ—Ç —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ —É –Ω–µ–≥–æ –µ—Å—Ç—å –∑–∞–∫–∞–∑—ã
CREATE TABLE user_accounts (
    account_id SERIAL PRIMARY KEY,
    user_id INT UNIQUE NOT NULL,
    balance DECIMAL(12,2),
    CONSTRAINT fk_user_account 
        FOREIGN KEY (user_id) REFERENCES users(user_id) 
        ON DELETE RESTRICT
);
```

> **–°–æ–≤–µ—Ç**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CASCADE –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ ‚Äì –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–µ–¥–Ω–∞–º–µ—Ä–µ–Ω–Ω–æ–π –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö

### 1.6. –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

#### üîç **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**

- –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –º–æ–∂–µ—Ç —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ **–ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á** –∏–ª–∏ **—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á** (UNIQUE) –¥—Ä—É–≥–æ–π —Ç–∞–±–ª–∏—Ü—ã
- –î–ª—è —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π **–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Ç–∏–ø—ã —Å—Ç–æ–ª–±—Ü–æ–≤** –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å
- –ù–∞ —Å—Ç–æ–ª–±—Ü—ã –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏–Ω–¥–µ–∫—Å** ‚Äì —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –≤—Ä—É—á–Ω—É—é –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–≤ –∫–æ–Ω—Ü–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

#### **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é**

```sql
-- 1. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π
CREATE INDEX idx_orders_user_id ON orders(user_id);

-- 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
ALTER TABLE orders 
ADD CONSTRAINT fk_orders_user_id 
FOREIGN KEY (user_id) REFERENCES users(user_id);

-- 3. –î–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫ (–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
BEGIN;
SET CONSTRAINTS ALL DEFERRED;
-- –ú–∞—Å—Å–æ–≤–∞—è –≤—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
INSERT INTO orders (user_id, order_date) VALUES (1, '2024-01-01');
COMMIT;

-- 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–æ—á–Ω–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
SELECT 
    o.order_id,
    o.user_id,
    CASE 
        WHEN u.user_id IS NULL THEN '–ù–∞—Ä—É—à–µ–Ω–∏–µ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏'
        ELSE 'OK'
    END as status
FROM orders o
LEFT JOIN users u ON o.user_id = u.user_id
WHERE u.user_id IS NULL;
```

#### ‚ö†Ô∏è **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**

- –í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ **–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è** –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö —Ç–∏–ø–∞ `UNLOGGED`
- –ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ **—á–∞—Å—Ç–∏—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å**
- –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏ —Ç—Ä–µ–±—É—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `DEFERRABLE` –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

## 2. –î–∏–∞–≥—Ä–∞–º–º—ã –≤ PostgreSQL

`PostgreSQL` **–Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏–∞–≥—Ä–∞–º–º. –î–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **–≤–Ω–µ—à–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**, –∫–æ—Ç–æ—Ä—ã–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç ER-–¥–∏–∞–≥—Ä–∞–º–º—ã *(Entity-Relationship Diagram).*

### 2.1. –ß—Ç–æ —Ç–∞–∫–æ–µ ER-–¥–∏–∞–≥—Ä–∞–º–º–∞?

**ER-–¥–∏–∞–≥—Ä–∞–º–º–∞** ‚Äì –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –≤–∫–ª—é—á–∞—é—â–µ–µ:

- **–°—É—â–Ω–æ—Å—Ç–∏** (—Ç–∞–±–ª–∏—Ü—ã) ‚Äì –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏
- **–ê—Ç—Ä–∏–±—É—Ç—ã** (—Å—Ç–æ–ª–±—Ü—ã) ‚Äì –æ–≤–∞–ª—ã –∏–ª–∏ —Å–ø–∏—Å–∫–∏ –≤–Ω—É—Ç—Ä–∏ —Å—É—â–Ω–æ—Å—Ç–µ–π
- **–°–≤—è–∑–∏** (–æ—Ç–Ω–æ—à–µ–Ω–∏—è) ‚Äì –ª–∏–Ω–∏–∏ –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏
- **–ö–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å** ‚Äì —É–∫–∞–∑–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ —Å–≤—è–∑–µ–π (1:1, 1:N, N:M)

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ ER-–¥–∏–∞–≥—Ä–∞–º–º:

‚úÖ –í–∏–∑—É–∞–ª—å–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î
‚úÖ –£–ø—Ä–æ—â–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã –¥–ª—è –∫–æ–º–∞–Ω–¥—ã
‚úÖ –í—ã—è–≤–ª–µ–Ω–∏–µ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —Ñ–æ—Ä–º –∏ –∞–Ω–æ–º–∞–ª–∏–π
‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 2.2. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏–∞–≥—Ä–∞–º–º

#### üñ•Ô∏è **–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∫–ª–∏–µ–Ω—Ç—ã**

**pgAdmin 4** (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç)
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
1. –û—Ç–∫—Ä—ã—Ç—å pgAdmin –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
2. –í—ã–±—Ä–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö ‚Üí —Å—Ö–µ–º—É (public)
3. –ü–ö–ú –ø–æ —Å—Ö–µ–º–µ ‚Üí Generate ERD
4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —ç–∫—Å–ø–æ—Ä—Ç –≤ PNG/PDF/SVG
```

**DBeaver** (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π, –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π)
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
2. –ü–ö–ú –ø–æ —Å—Ö–µ–º–µ ‚Üí View Diagram
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∏–ª—è, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü
4. –≠–∫—Å–ø–æ—Ä—Ç –≤ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
```

**DataGrip** (JetBrains)
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
1. –í—ã–¥–µ–ª–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã –≤ –æ–±–æ–∑—Ä–µ–≤–∞—Ç–µ–ª–µ
2. –ü–ö–ú ‚Üí Diagrams ‚Üí Show Visualization
3. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```

#### ü§ñ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏ –∫–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞**

**SchemaCrawler** (–¥–ª—è CI/CD)
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
wget https://github.com/schemacrawler/SchemaCrawler/releases/download/v16.18.2/schemacrawler-16.18.2-distribution.zip

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã
schemacrawler \
  --server=postgresql \
  --database=shop_db \
  --user=postgres \
  --password=secret \
  --command=schema \
  --output-file=database_schema.png \
  --title="Shop Database Schema" \
  --portable-names
```

**dbdiagram.io** (–æ–Ω–ª–∞–π–Ω)
```sql
-- –¢–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ö–µ–º—ã
Table users {
  id int [primary key]
  username varchar(50) [not null]
  email varchar(100) [unique]
}

Table orders {
  id int [primary key]
  user_id int [ref: > users.id]
  order_date date
}
```

**Graphviz + SQL —Å–∫—Ä–∏–ø—Ç—ã**
```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è DOT —Ñ–∞–π–ª–∞ –∏–∑ information_schema
psql -d mydb -c "
SELECT 'digraph G {' 
UNION ALL
SELECT format('  "%s" -> "%s";', tc.table_name, ccu.table_name)
FROM information_schema.table_constraints tc
JOIN information_schema.constraint_column_usage ccu 
  ON ccu.constraint_name = tc.constraint_name
WHERE tc.constraint_type = 'FOREIGN KEY'
UNION ALL
SELECT '}'
" > schema.dot

# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
dot -Tpng schema.dot -o schema.png
```
### 2.3. –ü–æ—à–∞–≥–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –≤ pgAdmin

#### üìã **–®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞**

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ pgAdmin 4
2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –≤–∞—à–µ–º—É PostgreSQL —Å–µ—Ä–≤–µ—Ä—É
3. –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –¥–µ—Ä–µ–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤: `Servers` ‚Üí `[Server Name]` ‚Üí `Databases`

#### üìä **–®–∞–≥ 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã**

1. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `shop_db`)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª `Schemas`
3. –ü–ö–ú –ø–æ —Å—Ö–µ–º–µ `public` (–∏–ª–∏ –¥—Ä—É–≥–æ–π –Ω—É–∂–Ω–æ–π —Å—Ö–µ–º–µ)
4. –í—ã–±–µ—Ä–∏—Ç–µ `Generate ERD`

#### üé® **–®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è**

–í –æ—Ç–∫—Ä—ã–≤—à–µ–π—Å—è –≤–∫–ª–∞–¥–∫–µ –≤—ã –º–æ–∂–µ—Ç–µ:

- **–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã** –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è
- **–°–∫—Ä—ã–≤–∞—Ç—å/–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–æ–ª–±—Ü—ã** —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
- **–ò–∑–º–µ–Ω—è—Ç—å —Ü–≤–µ—Ç–æ–≤—É—é —Å—Ö–µ–º—É** –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
- **–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã** –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ —Ç–∏–ø—É
- **–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å/—Å–∫—Ä—ã–≤–∞—Ç—å —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö** —Å—Ç–æ–ª–±—Ü–æ–≤

#### üíæ **–®–∞–≥ 4: –≠–∫—Å–ø–æ—Ä—Ç –¥–∏–∞–≥—Ä–∞–º–º—ã**

1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–∏–∫–æ–Ω–∫–∞ –¥–∏—Å–∫–µ—Ç—ã) –≤ –ø–∞–Ω–µ–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞:
   - **PNG** ‚Äì –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤ –∏ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π
   - **PDF** ‚Äì –¥–ª—è –ø–µ—á–∞—Ç–∏
   - **SVG** ‚Äì –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –≥—Ä–∞—Ñ–∏–∫–∏
3. –£–∫–∞–∂–∏—Ç–µ –∏–º—è —Ñ–∞–π–ª–∞ –∏ –ø—É—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

> **–°–æ–≤–µ—Ç**: –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –≤ —Å–∏—Å—Ç–µ–º–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ö–µ–º—ã!

### 2.4. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥: –∑–∞–ø—Ä–æ—Å—ã –∫ information_schema

**–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è PostgreSQL:**

#### üìã **–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π**

```sql
-- –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–∞—Ö
SELECT 
    tc.table_schema,
    tc.table_name,
    kcu.column_name,
    ccu.table_schema AS foreign_table_schema,
    ccu.table_name AS foreign_table_name,
    ccu.column_name AS foreign_column_name,
    rc.update_rule,
    rc.delete_rule
FROM information_schema.table_constraints tc
JOIN information_schema.key_column_usage kcu
    ON tc.constraint_name = kcu.constraint_name
    AND tc.table_schema = kcu.table_schema
JOIN information_schema.constraint_column_usage ccu
    ON ccu.constraint_name = tc.constraint_name
JOIN information_schema.referential_constraints rc
    ON tc.constraint_name = rc.constraint_name
WHERE tc.constraint_type = 'FOREIGN KEY'
ORDER BY tc.table_schema, tc.table_name;
```

#### üìä **–ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü**

```sql
-- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü —Å —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
SELECT 
    table_name,
    column_name,
    data_type,
    is_nullable,
    column_default,
    character_maximum_length
FROM information_schema.columns 
WHERE table_schema = 'public'
ORDER BY table_name, ordinal_position;
```

#### üîç **–ü–æ–∏—Å–∫ —Ç–∞–±–ª–∏—Ü –±–µ–∑ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π**

```sql
-- –¢–∞–±–ª–∏—Ü—ã –±–µ–∑ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞)
SELECT t.table_name
FROM information_schema.tables t
LEFT JOIN information_schema.table_constraints tc
    ON t.table_name = tc.table_name 
    AND t.table_schema = tc.table_schema
    AND tc.constraint_type = 'PRIMARY KEY'
WHERE t.table_schema = 'public' 
    AND t.table_type = 'BASE TABLE'
    AND tc.constraint_name IS NULL;
```

#### üìà **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–≤—è–∑—è–º**

```sql
-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã
SELECT 
    tc.table_name,
    COUNT(*) as fk_count
FROM information_schema.table_constraints tc
WHERE tc.constraint_type = 'FOREIGN KEY'
    AND tc.table_schema = 'public'
GROUP BY tc.table_name
ORDER BY fk_count DESC;
```

> **–í–∞–∂–Ω–æ**: –≠—Ç–∏ –∑–∞–ø—Ä–æ—Å—ã –ø–æ–ª–µ–∑–Ω—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞, –Ω–æ –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã!

## 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π (Extensions)

**–†–∞—Å—à–∏—Ä–µ–Ω–∏—è PostgreSQL** ‚Äì —ç—Ç–æ **–º–æ–¥—É–ª–∏**, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞—Å—à–∏—Ä—è—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –°–£–ë–î.

**–û–Ω–∏ –¥–æ–±–∞–≤–ª—è—é—Ç:**

- –ù–æ–≤—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
- –§—É–Ω–∫—Ü–∏–∏ –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
- –û–ø–µ—Ä–∞—Ç–æ—Ä—ã
- –ú–µ—Ç–æ–¥—ã –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:

```textline
—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ/
‚îú‚îÄ‚îÄ sql/          # SQL —Å–∫—Ä–∏–ø—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤
‚îú‚îÄ‚îÄ control       # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
‚îî‚îÄ‚îÄ README        # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### 3.1. –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π

#### üìã **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è**

```sql
-- –ü–æ–¥—Ä–æ–±–Ω—ã–π —Å–ø–∏—Å–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
SELECT 
    extname AS extension_name,
    extversion AS version,
    extnamespace::regnamespace AS schema,
    extrelocatable AS relocatable,
    pg_describe_object('pg_extension'::regclass, oid, 0) AS description
FROM pg_extension
ORDER BY extname;
```

#### üì¶ **–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è**

```sql
-- –í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
SELECT 
    name,
    default_version,
    installed_version,
    comment
FROM pg_available_extensions
ORDER BY name;

-- –¢–æ–ª—å–∫–æ –Ω–µ—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
SELECT 
    name,
    default_version,
    comment
FROM pg_available_extensions
WHERE installed_version IS NULL
ORDER BY name;
```

#### üîç **–ü–æ–∏—Å–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏**

```sql
-- –†–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JSON
SELECT name, comment 
FROM pg_available_extensions 
WHERE comment ILIKE '%json%';

-- –†–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è –≥–µ–æ–¥–∞–Ω–Ω—ã—Ö
SELECT name, comment 
FROM pg_available_extensions 
WHERE comment ILIKE '%gis%' OR comment ILIKE '%geo%';
```

### 3.2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

#### üîê **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–∞–≤–∞–º**

- **–°—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** ‚Äì –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- **–ü—Ä–∞–≤–æ CREATE** –≤ —Å—Ö–µ–º–µ ‚Äì –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –û–°** ‚Äì –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π —Å –≤–Ω–µ—à–Ω–∏–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏ (PostGIS, TimescaleDB)

#### üìù **–°–∏–Ω—Ç–∞–∫—Å–∏—Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏**

```sql
CREATE EXTENSION [ IF NOT EXISTS ] 
    extension_name 
    [ SCHEMA schema_name ] 
    [ VERSION version ] 
    [ CASCADE ];
```

#### **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|----------|----------|---------|
| `IF NOT EXISTS` | –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É, –µ—Å–ª–∏ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ | `CREATE EXTENSION IF NOT EXISTS "uuid-ossp";` |
| `SCHEMA` | –°—Ö–µ–º–∞ –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è | `CREATE EXTENSION pgcrypto SCHEMA extensions;` |
| `VERSION` | –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è | `CREATE EXTENSION postgis VERSION '3.3.0';` |
| `CASCADE` | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | `CREATE EXTENSION postgis CASCADE;` |

#### üìö **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã**

```sql
-- 1. –ë–∞–∑–æ–≤—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (—á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";        -- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è UUID
CREATE EXTENSION IF NOT EXISTS pgcrypto;           -- –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è
CREATE EXTENSION IF NOT EXISTS pg_trgm;            -- –¢—Ä–∏–≥—Ä–∞–º–º—ã –¥–ª—è –ø–æ–∏—Å–∫–∞

-- 2. –†–∞—Å—à–∏—Ä–µ–Ω–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ö–µ–º–µ
CREATE SCHEMA IF NOT EXISTS extensions;
CREATE EXTENSION IF NOT EXISTS hstore SCHEMA extensions;
CREATE EXTENSION IF NOT EXISTS citext SCHEMA extensions;

-- 3. –ì–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (—Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –û–°)
-- Ubuntu: sudo apt-get install postgis
CREATE EXTENSION IF NOT EXISTS postgis;
CREATE EXTENSION IF NOT EXISTS postgis_topology;

-- 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
CREATE EXTENSION IF NOT EXISTS pg_stat_statements;
CREATE EXTENSION IF NOT EXISTS auto_explain;

-- 5. –†–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤
-- Ubuntu: sudo apt-get install timescaledb-postgresql-15
CREATE EXTENSION IF NOT EXISTS timescaledb CASCADE;
```

#### ‚ö†Ô∏è **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π**

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
SELECT extname FROM pg_extension WHERE extname = 'uuid-ossp';

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
SELECT * FROM pg_depend 
WHERE refobjid = (SELECT oid FROM pg_extension WHERE extname = 'postgis');
```

### 3.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏**

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
SELECT 
    n.nspname AS schema_name,
    p.proname AS function_name,
    pg_get_function_arguments(p.oid) AS arguments
FROM pg_proc p
JOIN pg_namespace n ON p.pronamespace = n.oid
WHERE n.nspname = 'public' 
    AND p.proname LIKE 'uuid_%'
ORDER BY p.proname;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
SELECT typname 
FROM pg_type 
WHERE typname IN ('uuid', 'hstore', 'geometry');
```

#### üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏**

```sql
-- UUID-OSPS: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
SELECT 
    uuid_generate_v1() AS uuid_v1,      -- –ù–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏ –∏ MAC
    uuid_generate_v4() AS uuid_v4,      -- –†–∞–Ω–¥–æ–º–Ω—ã–π
    uuid_nil() AS nil_uuid,             -- –ù—É–ª–µ–≤–æ–π UUID
    uuid_ns_dns() AS dns_namespace;     -- –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º–µ–Ω DNS

-- pgcrypto: –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
SELECT 
    gen_salt('bf') AS bcrypt_salt,
    crypt('mypassword', gen_salt('bf')) AS hashed_password,
    digest('hello world', 'sha256') AS sha256_hash,
    hmac('data', 'key', 'sha256') AS hmac_sha256;

-- pg_trgm: –ü–æ–∏—Å–∫ –ø–æ —Ç—Ä–∏–≥—Ä–∞–º–º–∞–º
SELECT 
    word_similarity('hello', 'hallo') AS similarity_score,
    show_trgm('hello') AS trigrams;

-- hstore: –•—Ä–∞–Ω–∏–ª–∏—â–µ –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ
SELECT 
    'a=>1, b=>2'::hstore AS hstore_data,
    ('a=>1, b=>2'::hstore)->'a' AS value_a;

-- citext: –†–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π —Ç–µ–∫—Å—Ç
SELECT 
    'Hello'::citext = 'HELLO'::citext AS case_insensitive;
```

#### üìä **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å UUID –ø–µ—Ä–≤–∏—á–Ω—ã–º –∫–ª—é—á–æ–º
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);

-- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
INSERT INTO users (username, password_hash) 
VALUES ('john_doe', crypt('user_password', gen_salt('bf')));

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
SELECT username 
FROM users 
WHERE username = 'john_doe' 
    AND password_hash = crypt('user_password', password_hash);
```

### 3.4. –£–¥–∞–ª–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

#### ‚ö†Ô∏è **–í–∞–∂–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è**

- –£–¥–∞–ª–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è **—É–¥–∞–ª—è–µ—Ç –≤—Å–µ –µ–≥–æ –æ–±—ä–µ–∫—Ç—ã** (—Ñ—É–Ω–∫—Ü–∏–∏, —Ç–∏–ø—ã, –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã)
- –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç **–∑–∞–≤–∏—Å–∏–º—ã–µ –æ–±—ä–µ–∫—Ç—ã**, –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è `CASCADE`
- **–ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö** –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç–æ–ª–±—Ü–æ–≤ —Ç–∏–ø–∞ `hstore`)

#### üìã **–°–∏–Ω—Ç–∞–∫—Å–∏—Å —É–¥–∞–ª–µ–Ω–∏—è**

```sql
DROP EXTENSION [ IF EXISTS ] extension_name [ CASCADE ];
```

#### üõ†Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ**

```sql
-- 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
SELECT 
    c.relname AS table_name,
    a.attname AS column_name,
    t.typname AS type_name
FROM pg_class c
JOIN pg_attribute a ON c.oid = a.attrelid
JOIN pg_type t ON a.atttypid = t.oid
WHERE t.typname IN ('hstore', 'geometry', 'uuid')
    AND c.relkind = 'r'
    AND a.attnum > 0;

-- 2. –£–¥–∞–ª–µ–Ω–∏–µ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
DROP EXTENSION IF EXISTS "uuid-ossp";

-- 3. –£–¥–∞–ª–µ–Ω–∏–µ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
DROP EXTENSION IF EXISTS postgis CASCADE;

-- 4. –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ö–µ–º—ã
DROP EXTENSION IF EXISTS hstore;
DROP SCHEMA IF EXISTS extensions;
```

#### üîÑ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏**

```sql
-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
ALTER EXTENSION postgis UPDATE TO '3.4.0';

-- –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–µ—Ä—Å–∏–π
SELECT * FROM pg_available_extension_versions 
WHERE name = 'postgis';
```

### 3.5. –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è PostgreSQL

#### üîê **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è**

| –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
|------------|------------|---------------------|
| **pgcrypto** | –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ | `crypt('password', gen_salt('bf'))` |
| **sslinfo** | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ SSL-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è—Ö | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ |
| **passwordcheck** | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª–µ–π | `shared_preload_libraries` |

#### üÜî **–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö**

| –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|------------|------------|-------------|
| **uuid-ossp** | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è UUID | v1, v4, NIL UUID |
| **hstore** | –•—Ä–∞–Ω–∏–ª–∏—â–µ –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ | JSON-–ø–æ–¥–æ–±–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ |
| **citext** | –†–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π —Ç–µ–∫—Å—Ç | `WHERE email = 'USER@DOMAIN.COM'` |
| **ltree** | –î—Ä–µ–≤–æ–≤–∏–¥–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã | –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ |

#### üîç **–ü–æ–∏—Å–∫ –∏ —Ç–µ–∫—Å—Ç–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞**

| –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ |
|------------|------------|------------|
| **pg_trgm** | –¢—Ä–∏–≥—Ä–∞–º–º—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ | –ù–µ—á–µ—Ç–∫–∏–π –ø–æ–∏—Å–∫, –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ |
| **fuzzystrmatch** | –ù–µ—á–µ—Ç–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ | `levenshtein('kitten', 'sitting')` |
| **pg_similarity** | –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Å—Ö–æ–∂–µ—Å—Ç–∏ | –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ |

#### üåç **–ì–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**

| –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è |
|------------|------------|------------|
| **postgis** | –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –û–° |
| **postgis_topology** | –¢–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç PostGIS |
| **postgis_raster** | –†–∞—Å—Ç—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å |

#### üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

| –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|------------|------------|---------------|
| **pg_stat_statements** | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ | `shared_preload_libraries` |
| **auto_explain** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π EXPLAIN | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è |
| **pg_buffercache** | –ë—É—Ñ–µ—Ä–Ω—ã–π –∫—ç—à | –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ |
| **pgstattuple** | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞–±–ª–∏—Ü | `VACUUM` –∞–Ω–∞–ª–∏–∑ |

#### ‚è±Ô∏è **–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã –∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**

| –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|------------|------------|-------------|
| **timescaledb** | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ | –ê–≤—Ç–æ–ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **bloom** | –§–∏–ª—å—Ç—Ä—ã –ë–ª—É–º–∞ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã |
| **tablefunc** | –¢–∞–±–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ | `crosstab`, `normal_rand` |

#### üß™ **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

| –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ |
|------------|------------|------------------------|
| **pgtap** | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | Unit-—Ç–µ—Å—Ç—ã –¥–ª—è SQL |
| **plpgsql_check** | –ü—Ä–æ–≤–µ—Ä–∫–∞ PL/pgSQL | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ |
| **decoderbufs** | –õ–æ–≥–∏—á–µ—Å–∫–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è | Change Data Capture |

### 3.6. –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è –∏ –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

#### üìÅ **–û–±–ª–∞—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏**

- –†–∞—Å—à–∏—Ä–µ–Ω–∏—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è **–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö**
- –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±–∞–∑–∞—Ö ‚Äì **—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ –∫–∞–∂–¥—É—é**
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ **–æ–±—â—É—é —Å—Ö–µ–º—É** (`shared_preload_libraries`)

#### üñ•Ô∏è **–°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è**

```bash
# Ubuntu/Debian
sudo apt-get install postgresql-15-postgis-3
sudo apt-get install timescaledb-postgresql-15

# CentOS/RHEL
sudo yum install postgis33_15
sudo yum install timescaledb-postgresql-15

# macOS (Homebrew)
brew install postgis
docker pull timescale/timescaledb:latest-pg15
```

#### üîÑ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ PostgreSQL
SELECT version();

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
SELECT extname, extversion FROM pg_extension;

-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
ALTER EXTENSION postgis UPDATE;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
SELECT * FROM pg_extension_update_paths('postgis');
```

#### ‚öôÔ∏è **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞**

```conf
# postgresql.conf
shared_preload_libraries = 'pg_stat_statements, auto_explain'
pg_stat_statements.track = all
auto_explain.log_min_duration = 1000
```

#### üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**

- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ **—Ç–æ–ª—å–∫–æ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ** —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ **–ø–æ–¥–ø–∏—Å–∏** –∏ **–∏—Å—Ç–æ—á–Ω–∏–∫–∏** —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- –†–µ–≥—É–ª—è—Ä–Ω–æ **–æ–±–Ω–æ–≤–ª—è–π—Ç–µ** —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ **–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** –∏ **–∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã**

#### üìà **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è **—É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç** –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ
- **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π

#### üìö **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞**

- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://www.postgresql.org/docs/
- –†–∞—Å—à–∏—Ä–µ–Ω–∏—è: https://www.postgresql.org/download/
- –°–æ–æ–±—â–µ—Å—Ç–≤–æ: https://stackoverflow.com/questions/tagged/postgresql

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í —ç—Ç–æ–º –º–∞—Ç–µ—Ä–∏–∞–ª–µ –º—ã –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞–∑–æ–±—Ä–∞–ª–∏ —Ç—Ä–∏ –∫–ª—é—á–µ–≤—ã—Ö –∞—Å–ø–µ–∫—Ç–∞ —Ä–∞–±–æ—Ç—ã —Å PostgreSQL:

### **–ß—Ç–æ –≤—ã —É–∑–Ω–∞–ª–∏**

1. **Primary –∏ Foreign Keys**
   - –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
   - –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
   - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

2. **–î–∏–∞–≥—Ä–∞–º–º—ã –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**
   - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è ER-–¥–∏–∞–≥—Ä–∞–º–º
   - SQL-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î
   - –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∏–∞–≥—Ä–∞–º–º

3. **–†–∞—Å—à–∏—Ä–µ–Ω–∏—è PostgreSQL**
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏
   - –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏ –∏—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ
   - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å**

–≠—Ç–∏ –∑–Ω–∞–Ω–∏—è –ø–æ–∑–≤–æ–ª—è—Ç –≤–∞–º:

- –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å **–Ω–∞–¥–µ–∂–Ω—ã–µ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–µ** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å** —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î –¥–ª—è –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª** PostgreSQL
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å** –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤
- –û–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å **–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** –¥–∞–Ω–Ω—ã—Ö

### üìö **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏**

1. **–ü—Ä–∞–∫—Ç–∏–∫–∞**: –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å –ø–µ—Ä–≤–∏—á–Ω—ã–º–∏ –∏ –≤–Ω–µ—à–Ω–∏–º–∏ –∫–ª—é—á–∞–º–∏
2. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**: –ü–æ—Å—Ç—Ä–æ–π—Ç–µ ER-–¥–∏–∞–≥—Ä–∞–º–º—É —Å–≤–æ–µ–π –ë–î
3. **–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã**: –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
5. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –∏ —É–ª—É—á—à–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

> **–ü–æ–º–Ω–∏—Ç–µ**: –•–æ—Ä–æ—à–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚Äì –æ—Å–Ω–æ–≤–∞ –ª—é–±–æ–≥–æ –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

*–ú–∞—Ç–µ—Ä–∏–∞–ª –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –¥–ª—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö. –í—Å–µ –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.*