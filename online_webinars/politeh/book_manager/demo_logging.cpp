// Демонстрационная программа для тестирования новой функции логирования действий
// Также тестирует интеграцию с уже существующими функциями

#include "library.h"
#include "book.h"
#include <iostream>

int main() {
    Library lib;
    
    // Включаем логирование
    std::cout << "=== ВКЛЮЧЕНИЕ ЛОГИРОВАНИЯ ДЕЙСТВИЙ ===\n";
    lib.enableActionLogging("test_actions.log");
    
    // Создаем тестовые книги
    Book book1 = {"Война и мир", "Лев Толстой", 1869, Genre::ROMAN, "Эпическая повесть", "978-5-17-081998-7"};
    Book book2 = {"Преступление и наказание", "Фёдор Достоевский", 1866, Genre::ROMAN, "Психологический роман", "978-5-17-079754-0"};
    Book book3 = {"Мастер и Маргарита", "Михаил Булгаков", 1967, Genre::FANTASTIKA, "Фантастический роман", "978-5-17-081999-4"};
    
    std::cout << "\n=== ДЕМОНСТРАЦИЯ ЛОГИРОВАНИЯ ДЕЙСТВИЙ ===\n";
    
    // Добавляем книги - каждое действие будет залогировано
    std::cout << "\n1. Добавляем книги в библиотеку:\n";
    lib.addBook(book1);
    lib.addBook(book2);
    lib.addBook(book3);
    
    // Проверяем историю действий
    std::cout << "\n2. Просматриваем историю действий:\n";
    lib.printActionHistory();
    
    // Обновляем книгу
    std::cout << "\n3. Обновляем информацию о книге:\n";
    Book updatedBook = {"Война и мир", "Лев Николаевич Толстой", 1869, Genre::ROMAN, "Эпическая повесть", "978-5-17-081998-7"};
    lib.updateBook("Война и мир", updatedBook);
    
    // Удаляем книгу
    std::cout << "\n4. Удаляем книгу:\n";
    lib.removeBook("Преступление и наказание");
    
    // Проверяем историю снова
    std::cout << "\n5. Проверяем полную историю действий:\n";
    lib.printActionHistory();
    
    // Тестируем сортировку
    std::cout << "\n6. Сортировка по автору:\n";
    lib.sortByAuthor(true);
    
    // Проверяем финальную историю
    std::cout << "\n7. Финальная история действий:\n";
    lib.printActionHistory();
    
    // Изменяем размер истории
    std::cout << "\n8. Устанавливаем максимальный размер истории = 3:\n";
    lib.setMaxHistorySize(3);
    
    // Проверяем историю с ограниченным размером
    std::cout << "\n9. История после ограничения размера:\n";
    lib.printActionHistory();
    
    // Добавляем несколько книг, чтобы проверить ограничение
    std::cout << "\n10. Добавляем еще несколько книг для проверки ограничения:\n";
    Book book4 = {"Анна Каренина", "Лев Толстой", 1877, Genre::ROMAN, "Роман о любви и обществе", "978-5-17-082000-6"};
    Book book5 = {"Собачье сердце", "Михаил Булгаков", 1968, Genre::ROMAN, "Сатирический роман", "978-5-17-082001-3"};
    
    lib.addBook(book4);
    lib.addBook(book5);
    
    std::cout << "\n11. Финальная история (должны остаться только последние 3 действия):\n";
    lib.printActionHistory();
    
    std::cout << "\n=== ЗАВЕРШЕНИЕ ТЕСТА ===\n";
    std::cout << "Проверьте файл 'test_actions.log' для просмотра подробного лога всех действий.\n";
    
    return 0;
}