<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PacmanLearn - –û–±—É—á–∞—é—â–∞—è –∏–≥—Ä–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #121212;
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }
        
        body.light-theme {
            background: #f5f5f5;
            color: #333;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
        }
        
        h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #888;
            font-size: 1.1rem;
            max-width: 600px;
            line-height: 1.5;
        }
        
        .game-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: 100%;
            max-width: 800px;
        }
        
        .status-panel {
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        body.light-theme .status-panel {
            background: rgba(255, 255, 255, 0.9);
        }
        
        .score-info {
            display: flex;
            gap: 15px;
            font-size: 1.2rem;
        }
        
        .score-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .score-item .value {
            font-weight: bold;
            color: #FFD700;
        }
        
        body.light-theme .score-item .value {
            color: #D35400;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        button {
            background: linear-gradient(to bottom, #3a3a3a, #222);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        body.light-theme button {
            background: linear-gradient(to bottom, #e0e0e0, #cccccc);
            color: #333;
        }
        
        button:hover {
            background: linear-gradient(to bottom, #4a4a4a, #333);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        body.light-theme button:hover {
            background: linear-gradient(to bottom, #d0d0d0, #b0b0b0);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .mode-toggle {
            background: linear-gradient(to bottom, #444, #2c2c2c);
        }
        
        body.light-theme .mode-toggle {
            background: linear-gradient(to bottom, #a0a0a0, #888888);
        }
        
        .game-area {
            display: flex;
            gap: 20px;
            width: 100%;
        }
        
        #game-canvas {
            background: #000;
            border: 2px solid #333;
            border-radius: 5px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
        }
        
        body.light-theme #game-canvas {
            background: #f0f0f0;
            border-color: #ccc;
        }
        
        .mini-map-container {
            width: 100px;
            height: 100px;
        }
        
        #mini-map {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #444;
            border-radius: 5px;
        }
        
        body.light-theme #mini-map {
            background: rgba(255, 255, 255, 0.7);
            border-color: #ccc;
        }
        
        .debug-panel {
            width: 100%;
            background: rgba(30, 30, 30, 0.8);
            border-radius: 10px;
            padding: 15px;
            font-family: monospace;
            font-size: 0.9rem;
            display: none;
        }
        
        body.light-theme .debug-panel {
            background: rgba(240, 240, 240, 0.9);
        }
        
        .debug-panel h3 {
            margin-bottom: 10px;
            color: #FFD700;
        }
        
        body.light-theme .debug-panel h3 {
            color: #D35400;
        }
        
        .debug-content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .debug-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 8px;
            border-radius: 5px;
        }
        
        body.light-theme .debug-item {
            background: rgba(200, 200, 200, 0.5);
        }
        
        .debug-item strong {
            color: #FFA500;
        }
        
        body.light-theme .debug-item strong {
            color: #E67E22;
        }
        
        .learning-mode {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px;
            border-radius: 5px;
            max-width: 300px;
            display: none;
            z-index: 10;
        }
        
        body.light-theme .learning-mode {
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }
        
        .learning-mode h3 {
            color: #FFD700;
            margin-bottom: 5px;
        }
        
        body.light-theme .learning-mode h3 {
            color: #D35400;
        }
        
        .learning-mode p {
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .particle {
            position: absolute;
            pointer-events: none;
            z-index: 5;
        }
        
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            padding: 20px 30px;
            border-radius: 10px;
            text-align: center;
            display: none;
            max-width: 80%;
            z-index: 20;
        }
        
        body.light-theme .game-over {
            background: rgba(255, 255, 255, 0.95);
        }
        
        .game-over h2 {
            color: #FF6B6B;
            margin-bottom: 15px;
            font-size: 2rem;
        }
        
        body.light-theme .game-over h2 {
            color: #E74C3C;
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            animation: confetti-fall 5s ease-in-out forwards;
        }
        
        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        .level-complete {
            color: #4CAF50;
            font-size: 1.5rem;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 25px;
            border-radius: 10px;
            display: none;
            z-index: 15;
            animation: fadeOut 2s forwards;
        }
        
        body.light-theme .level-complete {
            background: rgba(255, 255, 255, 0.9);
            color: #27AE60;
        }
        
        @keyframes fadeOut {
            0% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        .sound-visualization {
            position: absolute;
            bottom: 10px;
            left: 10px;
            display: flex;
            gap: 2px;
            height: 20px;
        }
        
        .sound-bar {
            width: 3px;
            background: #4CAF50;
            border-radius: 1px;
        }
        
        .music-indicator {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #555;
        }
        
        .music-indicator.active {
            background-color: #4CAF50;
            box-shadow: 0 0 5px #4CAF50;
        }
        
        /* –ü–∞–Ω–µ–ª—å —É—á–µ–±–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
        .lesson-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 100;
            display: none;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
            overflow: auto;
        }
        
        body.light-theme .lesson-panel {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
        }
        
        .lesson-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .lesson-title {
            font-size: 1.8rem;
            color: #FFD700;
        }
        
        body.light-theme .lesson-title {
            color: #D35400;
        }
        
        .lesson-close {
            background: #c0392b;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-weight: bold;
            cursor: pointer;
        }
        
        .lesson-content {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .lesson-step {
            margin-bottom: 30px;
            padding: 15px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        body.light-theme .lesson-step {
            background: rgba(200, 200, 200, 0.2);
        }
        
        .lesson-step h4 {
            margin-bottom: 10px;
            color: #3498db;
        }
        
        body.light-theme .lesson-step h4 {
            color: #2980b9;
        }
        
        .code-block {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
            margin: 10px 0;
            overflow-x: auto;
            white-space: pre;
        }
        
        body.light-theme .code-block {
            background: rgba(240, 240, 240, 0.7);
        }
        
        .lesson-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .lesson-nav-btn {
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
        }
        
        .lesson-nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* –†–µ–¥–∞–∫—Ç–æ—Ä —É—Ä–æ–≤–Ω–µ–π */
        .level-editor {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a1a;
            z-index: 100;
            display: none;
            flex-direction: column;
        }
        
        body.light-theme .level-editor {
            background: #f0f0f0;
        }
        
        .editor-toolbar {
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        body.light-theme .editor-toolbar {
            background: rgba(240, 240, 240, 0.9);
        }
        
        .tool-button {
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .tool-button.active {
            background: #3498db;
            color: white;
        }
        
        body.light-theme .tool-button.active {
            background: #2980b9;
        }
        
        .editor-canvas-container {
            display: flex;
            justify-content: center;
            padding: 20px;
            flex: 1;
        }
        
        #editor-canvas {
            background: #000;
            border: 2px solid #333;
            border-radius: 5px;
        }
        
        body.light-theme #editor-canvas {
            background: #f0f0f0;
            border-color: #ccc;
        }
        
        /* –ü–∞–Ω–µ–ª—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π */
        .achievements-panel {
            position: fixed;
            top: 0;
            right: -320px;
            width: 300px;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 90;
            transition: right 0.3s;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
        }
        
        body.light-theme .achievements-panel {
            background: rgba(255, 255, 255, 0.95);
        }
        
        .achievements-panel.open {
            right: 0;
        }
        
        .achievements-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .achievements-title {
            font-size: 1.5rem;
            color: #FFD700;
        }
        
        body.light-theme .achievements-title {
            color: #D35400;
        }
        
        .achievements-close {
            background: #c0392b;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-weight: bold;
            cursor: pointer;
        }
        
        .achievement-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        body.light-theme .achievement-item {
            background: rgba(200, 200, 200, 0.3);
        }
        
        .achievement-title {
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .achievement-earned {
            color: #27ae60;
        }
        
        .achievement-locked {
            color: #7f8c8d;
        }
        
        .achievement-description {
            font-size: 0.9rem;
            color: #bdc3c7;
        }
        
        body.light-theme .achievement-description {
            color: #7f8c8d;
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #27ae60;
            color: white;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 100;
            transform: translateY(100px);
            transition: transform 0.3s;
        }
        
        .notification.show {
            transform: translateY(0);
        }
        
        .notification.error {
            background: #c0392b;
        }
        
        /* –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        .virtual-button {
            position: fixed;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 215, 0, 0.3);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            z-index: 100;
            touch-action: manipulation;
            user-select: none;
        }
        
        /* –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–Ω–∞–Ω–∏–π */
        .test-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            padding: 25px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            z-index: 100;
        }
        
        body.light-theme .test-panel {
            background: rgba(255, 255, 255, 0.95);
        }
        
        .test-question {
            font-size: 1.2rem;
            margin: 15px 0;
            line-height: 1.4;
        }
        
        .test-options {
            display: grid;
            gap: 10px;
            margin-top: 20px;
        }
        
        .test-option {
            padding: 12px;
            border-radius: 5px;
            text-align: left;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        body.light-theme .test-option {
            background: rgba(240, 240, 240, 0.7);
            border-color: #ddd;
        }
        
        .test-option:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        body.light-theme .test-option:hover {
            background: rgba(230, 230, 230, 0.7);
        }
        
        .feedback {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        
        .feedback.success {
            background: rgba(46, 204, 113, 0.2);
            color: #27ae60;
        }
        
        .feedback.error {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }
        
        .test-results {
            text-align: center;
        }
        
        .test-score {
            font-size: 2rem;
            margin: 20px 0;
            color: #3498db;
        }
        
        /* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ */
        .path-visualization {
            position: absolute;
            pointer-events: none;
            z-index: 4;
        }
    </style>
</head>
<body>
    <header>
        <h1>PacmanLearn</h1>
        <p class="subtitle">–û–±—É—á–∞—é—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π –∏–≥—Ä—ã —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –º—É–∑—ã–∫–æ–π –∏ –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏</p>
    </header>
    
    <div class="game-container">
        <div class="status-panel">
            <div class="score-info">
                <div class="score-item">
                    <span>–°—á—ë—Ç:</span>
                    <span id="score" class="value">0</span>
                </div>
                <div class="score-item">
                    <span>–†–µ–∫–æ—Ä–¥:</span>
                    <span id="high-score" class="value">0</span>
                </div>
                <div class="score-item">
                    <span>–£—Ä–æ–≤–µ–Ω—å:</span>
                    <span id="level" class="value">1</span>
                </div>
            </div>
            <div class="status-indicator">
                <span id="game-status" class="value">–ò–≥—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞</span>
            </div>
        </div>
        
        <div class="controls">
            <button id="start-btn"><span>‚ñ∂Ô∏è</span> –°—Ç–∞—Ä—Ç/–ü–∞—É–∑–∞</button>
            <button id="reset-btn"><span>üîÑ</span> –ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å</button>
            <button id="clear-record-btn"><span>üí•</span> –°–±—Ä–æ—Å —Ä–µ–∫–æ—Ä–¥–∞</button>
            <button id="mode-toggle" class="mode-toggle"><span>üéì</span> –†–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è: –í—ã–∫–ª</button>
            <button id="sound-toggle"><span>üîä</span> –ó–≤—É–∫: –í–∫–ª</button>
            <button id="theme-toggle"><span>üåô</span> –¢–µ–º–Ω–∞—è —Ç–µ–º–∞</button>
            <button id="achievements-btn"><span>üèÜ</span> –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
        </div>
        
        <div class="game-area">
            <canvas id="game-canvas" width="440" height="520"></canvas>
            <div class="mini-map-container">
                <canvas id="mini-map" width="100" height="100"></canvas>
            </div>
        </div>
        
        <div class="sound-visualization" id="sound-visualizer">
            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ –±–∞—Ä—ã -->
        </div>
        <div class="music-indicator" id="music-indicator"></div>
        
        <div class="learning-mode" id="learning-mode">
            <h3>–ü–æ—è—Å–Ω–µ–Ω–∏–µ –∫ –∫–æ–¥—É</h3>
            <p id="learning-content">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç –∏–≥—Ä—ã, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —á–∞—Å—Ç–∏ –∫–æ–¥–∞</p>
        </div>
        
        <div class="debug-panel" id="debug-panel">
            <h3>–†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏</h3>
            <div class="debug-content">
                <div class="debug-item">
                    <strong>–ü–æ–∑–∏—Ü–∏—è –ü–∞–∫–º–∞–Ω–∞:</strong> <span id="debug-pos">10, 15</span>
                </div>
                <div class="debug-item">
                    <strong>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</strong> <span id="debug-dir">right</span>
                </div>
                <div class="debug-item">
                    <strong>–°–∫–æ—Ä–æ—Å—Ç—å:</strong> <span id="debug-speed">200 –º—Å</span>
                </div>
                <div class="debug-item">
                    <strong>–°—É–ø–µ—Ä-–µ–¥–∞:</strong> <span id="debug-power">–ù–µ –∞–∫—Ç–∏–≤–Ω–∞</span>
                </div>
            </div>
        </div>
        
        <div class="game-over" id="game-over">
            <h2>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
            <p>–í–∞—à —Å—á—ë—Ç: <span id="final-score" class="value">0</span></p>
            <button id="restart-btn" style="margin-top: 15px;">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
        </div>
        
        <div class="level-complete" id="level-complete">
            –£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–π–¥–µ–Ω!
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å —É—á–µ–±–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ -->
    <div class="lesson-panel" id="lesson-panel">
        <div class="lesson-header">
            <h2 class="lesson-title" id="lesson-title">–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–∫–∞</h2>
            <button class="lesson-close" id="lesson-close">√ó</button>
        </div>
        <div class="lesson-content" id="lesson-content">
            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —É—Ä–æ–∫–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∑–¥–µ—Å—å -->
        </div>
        <div class="lesson-controls">
            <button class="lesson-nav-btn" id="lesson-prev">–ù–∞–∑–∞–¥</button>
            <button class="lesson-nav-btn" id="lesson-next">–î–∞–ª–µ–µ</button>
        </div>
    </div>

    <!-- –†–µ–¥–∞–∫—Ç–æ—Ä —É—Ä–æ–≤–Ω–µ–π -->
    <div class="level-editor" id="level-editor">
        <div class="editor-toolbar">
            <button class="tool-button active" data-tool="wall">–°—Ç–µ–Ω–∞</button>
            <button class="tool-button" data-tool="path">–ü—É—Ç—å</button>
            <button class="tool-button" data-tool="food">–ï–¥–∞</button>
            <button class="tool-button" data-tool="super-food">–°—É–ø–µ—Ä-–µ–¥–∞</button>
            <button class="tool-button" data-tool="pacman">–ü–∞–∫–º–∞–Ω</button>
            <button class="tool-button" data-tool="ghost">–ü—Ä–∏–≤–∏–¥–µ–Ω–∏–µ</button>
            <div style="flex-grow: 1;"></div>
            <button id="save-level" class="tool-button"><span>üíæ</span> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button id="cancel-edit" class="tool-button"><span>‚ùå</span> –û—Ç–º–µ–Ω–∞</button>
            <button id="load-level" class="tool-button"><span>üìÇ</span> –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            <input type="file" id="level-file-input" style="display: none;" accept=".json">
        </div>
        <div class="editor-canvas-container">
            <canvas id="editor-canvas" width="400" height="400"></canvas>
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π -->
    <div class="achievements-panel" id="achievements-panel">
        <div class="achievements-header">
            <h2 class="achievements-title">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
            <button class="achievements-close" id="achievements-close">√ó</button>
        </div>
        <div id="achievements-list">
            <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="notification" id="notification"></div>

    <!-- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–Ω–∞–Ω–∏–π -->
    <div class="test-panel" id="test-panel" style="display: none;">
        <h3 id="test-title">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞</h3>
        <p id="test-question-count"></p>
        <p class="test-question" id="test-question">–í–æ–ø—Ä–æ—Å</p>
        <div class="test-options" id="test-options">
            <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
        </div>
        <div class="feedback" id="test-feedback" style="display: none;"></div>
    </div>

    <script>
        /**
         * –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –∏–≥—Ä—ã PacmanLearn
         * @class PacmanGame
         * @description –û–±—É—á–∞—é—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π –∏–≥—Ä—ã —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
         *              –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –æ—Å–Ω–æ–≤ 2D-–≥–µ–π–º–¥–µ–≤–∞ –Ω–∞ JavaScript
         */
        class PacmanGame {
            /**
             * –°–æ–∑–¥–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä –∏–≥—Ä—ã –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
             * @constructor
             */
            constructor() {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                this.canvas = document.getElementById('game-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.cellSize = 22; // –†–∞–∑–º–µ—Ä —è—á–µ–π–∫–∏ –≤ –ø–∏–∫—Å–µ–ª—è—Ö
                this.gameSpeed = 200; // –ë–∞–∑–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∏–≥—Ä—ã (–º—Å)
                this.gameLoopId = null;
                this.isRunning = false;
                this.isLearningMode = false;
                this.isSoundEnabled = true;
                this.currentLevel = 1;
                this.lastTimestamp = 0;
                this.animationFrameId = null;
                this.soundVisualizer = document.getElementById('sound-visualizer');
                this.musicIndicator = document.getElementById('music-indicator');
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
                this.pacman = {
                    x: 10, 
                    y: 15, 
                    direction: 'right', 
                    nextDirection: null,
                    mouthAngle: 0,
                    mouthOpening: 0.1,
                    lastEatTime: 0,
                    eatInterval: 150 // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É –∑–≤—É–∫–∞–º–∏ –ø–æ–µ–¥–∞–Ω–∏—è
                };
                
                this.ghost = {
                    x: 10,
                    y: 8,
                    direction: 'left',
                    mode: 'wandering', // wandering, chasing, fleeing
                    speed: 0.8,
                    color: 'red',
                    fearTimer: null
                };
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                this.score = 0;
                this.highScore = parseInt(localStorage.getItem('pacmanHighScore') || '0', 10);
                this.powerMode = false;
                this.powerModeTimer = null;
                this.powerModeStart = 0;
                this.foodCount = 0;
                this.totalFood = 0; // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ
                this.particles = [];
                this.activeSounds = new Set();
                this.musicPlaying = false;
                this.musicTimeout = null;
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∏–Ω–∏-–∫–∞—Ä—Ç—ã
                this.miniMapCanvas = document.getElementById('mini-map');
                this.miniMapCtx = this.miniMapCanvas.getContext('2d');
                this.miniMapScale = 1;
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–≤—É–∫–∞
                this.setupSoundVisualizer();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
                this.isDarkTheme = true;
                this.currentLesson = null;
                this.currentLessonStep = 0;
                this.currentTest = null;
                this.currentQuestion = 0;
                this.testScore = 0;
                this.codeModified = false;
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                this.loadProgress();
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
                this.setupEventListeners();
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ —É—Ä–æ–≤–Ω–µ–π
                this.levels = this.loadLevels();
                this.currentMap = this.cloneMap(this.levels[0]);
                this.countTotalFood();
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
                this.updateUI();
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–≤—É–∫–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
                this.audioContext = null;
                this.sounds = this.loadSounds();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É—á–µ–±–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
                this.lessons = this.loadLessons();
                this.achievements = this.loadAchievements();
                this.tests = this.loadTests();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
                this.initUIComponents();
                
                // –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
                this.startGameLoop();
            }
            
            /**
             * –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –∑–≤—É–∫–∞
             */
            setupSoundVisualizer() {
                // –°–æ–∑–¥–∞–µ–º 8 –±–∞—Ä–æ–≤ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
                for (let i = 0; i < 8; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'sound-bar';
                    bar.style.height = '5px';
                    this.soundVisualizer.appendChild(bar);
                }
            }
            
            /**
             * –û–±–Ω–æ–≤–ª—è–µ—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –∑–≤—É–∫–∞
             */
            updateSoundVisualization() {
                const bars = this.soundVisualizer.querySelectorAll('.sound-bar');
                const activeCount = this.activeSounds.size;
                
                bars.forEach((bar, index) => {
                    const height = index < activeCount ? `${Math.min(20, 5 + activeCount * 2)}px` : '5px';
                    bar.style.height = height;
                    bar.style.backgroundColor = activeCount > 0 ? '#4CAF50' : '#555';
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –º—É–∑—ã–∫–∏
                this.musicIndicator.classList.toggle('active', this.musicPlaying);
            }
            
            /**
             * –°–æ–∑–¥–∞–µ—Ç –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç, –µ—Å–ª–∏ –æ–Ω –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω
             */
            setupAudioContext() {
                if (!this.audioContext) {
                    try {
                        window.AudioContext = window.AudioContext || window.webkitAudioContext;
                        this.audioContext = new AudioContext();
                    } catch (e) {
                        console.error('Web Audio API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ', e);
                    }
                }
            }
            
            /**
             * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∑–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –∏–≥—Ä—ã
             * @returns {Object} –û–±—ä–µ–∫—Ç —Å –∞—É–¥–∏–æ-—Ä–µ—Å—É—Ä—Å–∞–º–∏
             */
            loadSounds() {
                this.setupAudioContext();
                
                return {
                    // –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–æ–≤–∞—è –º—É–∑—ã–∫–∞ Pacman
                    music: {
                        play: (game) => {
                            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –º—É–∑—ã–∫—É, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–∞–ª–æ–∂–µ–Ω–∏—è
                            game.sounds.music.stop(game);
                            
                            if (!game.isSoundEnabled || !game.audioContext) return;
                            
                            game.musicPlaying = true;
                            game.updateSoundVisualization();
                            
                            // –°–æ–∑–¥–∞–µ–º –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –º–µ–ª–æ–¥–∏–∏ Pacman
                            const playNote = (frequency, duration, startTime) => {
                                const oscillator = game.audioContext.createOscillator();
                                const gainNode = game.audioContext.createGain();
                                
                                oscillator.connect(gainNode);
                                gainNode.connect(game.audioContext.destination);
                                
                                oscillator.type = 'square';
                                oscillator.frequency.value = frequency;
                                
                                gainNode.gain.setValueAtTime(0.1, startTime);
                                gainNode.gain.exponentialRampToValueAtTime(0.001, startTime + duration);
                                
                                oscillator.start(startTime);
                                oscillator.stop(startTime + duration);
                            };
                            
                            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –º–µ–ª–æ–¥–∏—é Pacman
                            const startTime = game.audioContext.currentTime;
                            const sequence = [
                                { freq: 440, dur: 0.15 }, { freq: 349, dur: 0.15 }, { freq: 392, dur: 0.15 }, { freq: 440, dur: 0.15 },
                                { freq: 349, dur: 0.15 }, { freq: 392, dur: 0.15 }, { freq: 440, dur: 0.15 }, { freq: 349, dur: 0.45 },
                                { freq: 392, dur: 0.15 }, { freq: 440, dur: 0.15 }, { freq: 494, dur: 0.15 }, { freq: 440, dur: 0.15 },
                                { freq: 392, dur: 0.15 }, { freq: 349, dur: 0.15 }, { freq: 330, dur: 0.15 }, { freq: 349, dur: 0.45 }
                            ];
                            
                            const totalDuration = sequence.reduce((sum, note) => sum + note.dur, 0) * 1000 + 500;
                            
                            sequence.forEach((note, i) => {
                                playNote(note.freq, note.dur, startTime + i * 0.2);
                            });
                            
                            // –ü–ª–∞–Ω–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â–µ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–∞—É–∑—É
                            game.musicTimeout = setTimeout(() => {
                                game.musicTimeout = null;
                                if (game.isRunning && game.isSoundEnabled) {
                                    game.sounds.music.play(game);
                                } else {
                                    game.musicPlaying = false;
                                    game.updateSoundVisualization();
                                }
                            }, totalDuration);
                        },
                        stop: (game) => {
                            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–∞—É—Ç
                            if (game.musicTimeout) {
                                clearTimeout(game.musicTimeout);
                                game.musicTimeout = null;
                            }
                            
                            game.musicPlaying = false;
                            game.updateSoundVisualization();
                        }
                    },
                    
                    // –ó–≤—É–∫ —Å–±–æ—Ä–∞ –æ–±—ã—á–Ω–æ–π –µ–¥—ã
                    eat: {
                        play: (game) => {
                            if (!game.isSoundEnabled || !game.audioContext || 
                                (Date.now() - game.pacman.lastEatTime) < game.pacman.eatInterval) return;
                            
                            game.activeSounds.add('eat');
                            game.updateSoundVisualization();
                            
                            const startTime = game.audioContext.currentTime;
                            const oscillator = game.audioContext.createOscillator();
                            const gainNode = game.audioContext.createGain();
                            
                            oscillator.connect(gainNode);
                            gainNode.connect(game.audioContext.destination);
                            
                            oscillator.type = 'square';
                            oscillator.frequency.value = 440;
                            
                            gainNode.gain.setValueAtTime(0.05, startTime);
                            gainNode.gain.exponentialRampToValueAtTime(0.001, startTime + 0.1);
                            
                            oscillator.start(startTime);
                            oscillator.stop(startTime + 0.1);
                            
                            game.pacman.lastEatTime = Date.now();
                            
                            // –£–¥–∞–ª—è–µ–º –∑–≤—É–∫ –∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
                            setTimeout(() => {
                                game.activeSounds.delete('eat');
                                game.updateSoundVisualization();
                            }, 100);
                        }
                    },
                    
                    // –ó–≤—É–∫ —Å–±–æ—Ä–∞ —Å—É–ø–µ—Ä-–µ–¥—ã
                    power: {
                        play: (game) => {
                            if (!game.isSoundEnabled || !game.audioContext) return;
                            
                            game.activeSounds.add('power');
                            game.updateSoundVisualization();
                            
                            const startTime = game.audioContext.currentTime;
                            const oscillator = game.audioContext.createOscillator();
                            const gainNode = game.audioContext.createGain();
                            
                            oscillator.connect(gainNode);
                            gainNode.connect(game.audioContext.destination);
                            
                            oscillator.type = 'sine';
                            oscillator.frequency.value = 220;
                            
                            gainNode.gain.setValueAtTime(0.1, startTime);
                            gainNode.gain.exponentialRampToValueAtTime(0.001, startTime + 0.5);
                            
                            oscillator.start(startTime);
                            oscillator.stop(startTime + 0.5);
                            
                            // –£–¥–∞–ª—è–µ–º –∑–≤—É–∫ –∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
                            setTimeout(() => {
                                game.activeSounds.delete('power');
                                game.updateSoundVisualization();
                            }, 500);
                        }
                    },
                    
                    // –ó–≤—É–∫ —Å–º–µ—Ä—Ç–∏ –ü–∞–∫–º–∞–Ω–∞
                    death: {
                        play: (game) => {
                            if (!game.isSoundEnabled || !game.audioContext) return;
                            
                            game.activeSounds.add('death');
                            game.updateSoundVisualization();
                            
                            const startTime = game.audioContext.currentTime;
                            const oscillator = game.audioContext.createOscillator();
                            const gainNode = game.audioContext.createGain();
                            
                            oscillator.connect(gainNode);
                            gainNode.connect(game.audioContext.destination);
                            
                            oscillator.type = 'sawtooth';
                            oscillator.frequency.value = 300;
                            
                            gainNode.gain.setValueAtTime(0.1, startTime);
                            gainNode.gain.linearRampToValueAtTime(0, startTime + 1.5);
                            
                            oscillator.start(startTime);
                            oscillator.stop(startTime + 1.5);
                            
                            // –£–¥–∞–ª—è–µ–º –∑–≤—É–∫ –∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
                            setTimeout(() => {
                                game.activeSounds.delete('death');
                                game.updateSoundVisualization();
                            }, 1500);
                        }
                    }
                };
            }
            
            /**
             * –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç –∑–≤—É–∫–æ–≤–æ–π —ç—Ñ—Ñ–µ–∫—Ç, –µ—Å–ª–∏ –∑–≤—É–∫ –≤–∫–ª—é—á–µ–Ω
             * @param {string} soundName - –ù–∞–∑–≤–∞–Ω–∏–µ –∑–≤—É–∫–∞ –∏–∑ this.sounds
             */
            playSound(soundName) {
                if (this.isSoundEnabled && this.sounds[soundName]) {
                    this.sounds[soundName].play(this);
                }
            }
            
            /**
             * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —É—Ä–æ–≤–Ω–µ–π —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
             * @returns {Array} –ú–∞—Å—Å–∏–≤ –∫–∞—Ä—Ç —É—Ä–æ–≤–Ω–µ–π
             */
            loadLevels() {
                return [
                    // –£—Ä–æ–≤–µ–Ω—å 1: –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∞ Pacman
                    // –°–∏–º–º–µ—Ç—Ä–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å —á–µ—Ç–∫–∏–º–∏ –ø—Ä–æ—Ö–æ–¥–∞–º–∏
                    // –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏: 
                    // - –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞ –¥–ª—è —Ç–∞–∫—Ç–∏–∫–∏ —Å —Å—É–ø–µ—Ä-–µ–¥–æ–π
                    // - –£–≥–ª–æ–≤—ã–µ –∑–æ–Ω—ã –¥–ª—è —É–∫—Ä—ã—Ç–∏—è
                    // - –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–±—ã—á–Ω–æ–π –∏ —Å—É–ø–µ—Ä-–µ–¥—ã
                    [
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0],
                        [0,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0],
                        [0,2,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,2,0],
                        [0,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0],
                        [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
                        [0,1,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0],
                        [0,1,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0],
                        [0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,0],
                        [0,0,0,0,1,0,0,0,2,0,2,0,0,0,1,0,0,0,0,0],
                        [0,0,0,0,1,0,2,0,0,2,0,0,2,0,1,0,0,0,0,0],
                        [0,0,0,0,1,0,0,0,2,0,2,0,0,0,1,0,0,0,0,0],
                        [0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,0],
                        [0,1,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0],
                        [0,1,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0],
                        [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
                        [0,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0],
                        [0,3,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,3,1,0],
                        [0,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
                    ],
                    // –£—Ä–æ–≤–µ–Ω—å 2: –£—Å–ª–æ–∂–Ω–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
                    // –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
                    // - –ú–µ–Ω—å—à–µ –ø—Ä—è–º—ã—Ö –ø—Ä–æ—Ö–æ–¥–æ–≤
                    // - –£–∑–∫–∏–µ –∫–æ—Ä–∏–¥–æ—Ä—ã –¥–ª—è —Ç–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π
                    // - –ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –µ–¥—ã
                    [
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,1,1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,0],
                        [0,1,0,0,1,0,1,0,0,0,0,0,0,1,0,1,0,0,1,0],
                        [0,1,0,0,1,0,1,1,1,0,0,1,1,1,0,1,0,0,1,0],
                        [0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,0],
                        [0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0],
                        [0,1,0,0,1,0,1,1,1,1,1,1,1,1,0,1,0,0,1,0],
                        [0,1,0,0,1,0,1,0,0,0,0,0,0,1,0,1,0,0,1,0],
                        [0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,0],
                        [0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],
                        [0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],
                        [0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,0],
                        [0,1,0,0,1,0,1,0,0,0,0,0,0,1,0,1,0,0,1,0],
                        [0,1,0,0,1,0,1,1,1,1,1,1,1,1,0,1,0,0,1,0],
                        [0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0],
                        [0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,0],
                        [0,1,0,0,1,0,1,1,1,0,0,1,1,1,0,1,0,0,1,0],
                        [0,1,0,0,1,0,1,0,0,0,0,0,0,1,0,1,0,0,1,0],
                        [0,1,1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
                    ],
                    // –£—Ä–æ–≤–µ–Ω—å 3: –õ–∞–±–∏—Ä–∏–Ω—Ç —Å –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–∫–∞–º–∏
                    // –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
                    // - –°–µ—Ç–∫–∞ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–∫–æ–≤
                    // - –ß–µ—Ç—ã—Ä–µ –∑–æ–Ω—ã —Å —Å—É–ø–µ—Ä-–µ–¥–æ–π
                    // - –°–ª–æ–∂–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è —Ç–∞–∫—Ç–∏–∫–∏
                    [
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,0],
                        [0,1,0,0,1,0,0,1,0,1,1,0,1,0,0,0,0,0,1,0],
                        [0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0],
                        [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
                        [0,1,0,0,1,0,0,0,0,1,1,0,0,0,0,1,0,0,1,0],
                        [0,1,0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,1,0],
                        [0,1,1,1,1,0,1,1,0,0,0,0,1,1,0,1,1,1,1,0],
                        [0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],
                        [0,0,0,0,1,0,0,0,1,1,1,1,0,0,0,1,0,0,0,0],
                        [0,0,0,0,1,0,0,0,1,1,1,1,0,0,0,1,0,0,0,0],
                        [0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],
                        [0,1,1,1,1,0,1,1,0,0,0,0,1,1,0,1,1,1,1,0],
                        [0,1,0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,1,0],
                        [0,1,0,0,1,0,0,0,0,1,1,0,0,0,0,1,0,0,1,0],
                        [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
                        [0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0],
                        [0,1,0,0,1,0,0,1,0,1,1,0,1,0,0,0,0,0,1,0],
                        [0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
                    ],
                    // –£—Ä–æ–≤–µ–Ω—å 4: –í—ã—Å–æ–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å
                    // –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
                    // - –ú–∏–Ω–∏–º—É–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –¥–ª—è –º–∞–Ω–µ–≤—Ä–∞
                    // - –ú–Ω–æ–≥–æ —Ç—É–ø–∏–∫–æ–≤
                    // - –°–ª–æ–∂–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –∫ —Å—É–ø–µ—Ä-–µ–¥–µ
                    [
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,0],
                        [0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,1,0],
                        [0,1,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,1,0],
                        [0,1,1,1,0,0,0,0,0,1,1,0,0,0,0,1,1,1,1,0],
                        [0,0,1,0,0,1,1,1,0,1,1,0,1,1,1,0,1,0,0,0],
                        [0,1,1,1,1,1,0,1,0,1,1,0,1,0,1,1,1,1,1,0],
                        [0,1,0,0,0,1,0,1,0,0,0,0,1,0,1,0,0,0,1,0],
                        [0,1,1,1,0,1,0,1,1,1,1,1,1,0,1,1,1,1,1,0],
                        [0,0,0,1,0,1,0,0,0,2,2,0,0,0,1,0,1,0,0,0],
                        [0,0,0,1,0,1,0,0,2,3,3,2,0,0,1,0,1,0,0,0],
                        [0,0,0,1,0,1,0,0,0,2,2,0,0,0,1,0,1,0,0,0],
                        [0,1,1,1,0,1,0,1,1,1,1,1,1,0,1,1,1,1,1,0],
                        [0,1,0,0,0,1,0,1,0,0,0,0,1,0,1,0,0,0,1,0],
                        [0,1,1,1,1,1,0,1,0,1,1,0,1,0,1,1,1,1,1,0],
                        [0,0,1,0,0,1,1,1,0,1,1,0,1,1,1,0,1,0,0,0],
                        [0,1,1,1,0,0,0,0,0,1,1,0,0,0,0,1,1,1,1,0],
                        [0,1,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,1,0],
                        [0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,1,0],
                        [0,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,0]
                    ]
                ];
            }
            
            /**
             * –°–æ–∑–¥–∞–µ—Ç –≥–ª—É–±–æ–∫—É—é –∫–æ–ø–∏—é –∫–∞—Ä—Ç—ã —É—Ä–æ–≤–Ω—è
             * @param {Array} map - –ò—Å—Ö–æ–¥–Ω–∞—è –∫–∞—Ä—Ç–∞ —É—Ä–æ–≤–Ω—è
             * @returns {Array} –ö–æ–ø–∏—è –∫–∞—Ä—Ç—ã
             */
            cloneMap(map) {
                return map.map(row => [...row]);
            }
            
            /**
             * –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ
             */
            countTotalFood() {
                this.totalFood = 0;
                for (let y = 0; y < this.currentMap.length; y++) {
                    for (let x = 0; x < this.currentMap[y].length; x++) {
                        if (this.currentMap[y][x] === 2 || this.currentMap[y][x] === 3) {
                            this.totalFood++;
                        }
                    }
                }
                this.foodCount = this.totalFood;
            }
            
            /**
             * –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
             */
            setupEventListeners() {
                // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                document.getElementById('start-btn').addEventListener('click', () => this.toggleGame());
                document.getElementById('reset-btn').addEventListener('click', () => this.resetLevel());
                document.getElementById('clear-record-btn').addEventListener('click', () => this.clearHighScore());
                document.getElementById('mode-toggle').addEventListener('click', () => this.toggleLearningMode());
                document.getElementById('sound-toggle').addEventListener('click', () => this.toggleSound());
                document.getElementById('restart-btn').addEventListener('click', () => this.restartGame());
                document.getElementById('theme-toggle').addEventListener('click', () => this.toggleTheme());
                document.getElementById('achievements-btn').addEventListener('click', () => this.toggleAchievementsPanel());
                
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
                document.addEventListener('keydown', (e) => this.handleKey(e));
                
                // –û–±—É—á–µ–Ω–∏–µ: –∫–ª–∏–∫ –ø–æ —ç–ª–µ–º–µ–Ω—Ç–∞–º
                this.canvas.addEventListener('click', (e) => this.handleCanvasClick(e));
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
                window.addEventListener('resize', () => this.updateMiniMap());
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É—á–µ–±–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
                document.getElementById('lesson-close').addEventListener('click', () => this.closeLesson());
                document.getElementById('lesson-prev').addEventListener('click', () => this.previousLessonStep());
                document.getElementById('lesson-next').addEventListener('click', () => this.nextLessonStep());
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ —É—Ä–æ–≤–Ω–µ–π
                document.getElementById('cancel-edit').addEventListener('click', () => this.closeLevelEditor());
                document.getElementById('save-level').addEventListener('click', () => this.saveEditedLevel());
                document.getElementById('load-level').addEventListener('click', () => {
                    document.getElementById('level-file-input').click();
                });
                
                document.getElementById('level-file-input').addEventListener('change', (e) => {
                    this.loadLevelFromFile(e.target.files[0]);
                    e.target.value = ''; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≥–æ –∂–µ —Ñ–∞–π–ª–∞
                });
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
                document.getElementById('achievements-close').addEventListener('click', () => this.closeAchievementsPanel());
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                document.getElementById('test-panel').addEventListener('click', (e) => {
                    if (e.target.classList.contains('test-option')) {
                        this.checkAnswer(parseInt(e.target.dataset.index));
                    }
                });
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ–Ω—Å–æ—Ä–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
                this.setupTouchControls();
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Å–æ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
                this.setupDevConsole();
            }
            
            /**
             * –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å–µ–Ω—Å–æ—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
             */
            setupTouchControls() {
                const canvas = this.canvas;
                let touchStartX = 0;
                let touchStartY = 0;
                
                canvas.addEventListener('touchstart', (e) => {
                    touchStartX = e.touches[0].clientX;
                    touchStartY = e.touches[0].clientY;
                    e.preventDefault();
                }, { passive: false });
                
                canvas.addEventListener('touchend', (e) => {
                    if (!this.isRunning) return;
                    
                    const touchEndX = e.changedTouches[0].clientX;
                    const touchEndY = e.changedTouches[0].clientY;
                    
                    const dx = touchEndX - touchStartX;
                    const dy = touchEndY - touchStartY;
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ –Ω–∞–∏–±–æ–ª—å—à–µ–º—É —Å–º–µ—â–µ–Ω–∏—é
                    if (Math.abs(dx) > Math.abs(dy)) {
                        if (dx > 30) {
                            this.pacman.nextDirection = 'right';
                        } else if (dx < -30) {
                            this.pacman.nextDirection = 'left';
                        }
                    } else {
                        if (dy > 30) {
                            this.pacman.nextDirection = 'down';
                        } else if (dy < -30) {
                            this.pacman.nextDirection = 'up';
                        }
                    }
                    
                    e.preventDefault();
                }, { passive: false });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
                if (/Android|iPhone|iPad/i.test(navigator.userAgent)) {
                    this.addVirtualButtons();
                }
            }
            
            /**
             * –î–æ–±–∞–≤–ª—è–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
             */
            addVirtualButtons() {
                const buttonSize = 60;
                const controls = [
                    { id: 'btn-up', x: window.innerWidth/2, y: 20, label: '‚Üë' },
                    { id: 'btn-left', x: 20, y: window.innerHeight/2, label: '‚Üê' },
                    { id: 'btn-down', x: window.innerWidth/2, y: window.innerHeight - 20, label: '‚Üì' },
                    { id: 'btn-right', x: window.innerWidth - 20, y: window.innerHeight/2, label: '‚Üí' }
                ];
                
                controls.forEach(control => {
                    const btn = document.createElement('div');
                    btn.id = control.id;
                    btn.className = 'virtual-button';
                    btn.textContent = control.label;
                    btn.style.cssText = `
                        position: fixed;
                        width: ${buttonSize}px;
                        height: ${buttonSize}px;
                        border-radius: 50%;
                        background: rgba(255, 215, 0, 0.3);
                        color: white;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 24px;
                        font-weight: bold;
                        bottom: ${window.innerHeight - control.y}px;
                        left: ${control.x}px;
                        transform: translate(-50%, -50%);
                        z-index: 100;
                        touch-action: manipulation;
                    `;
                    
                    btn.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        switch(control.id) {
                            case 'btn-up': this.pacman.nextDirection = 'up'; break;
                            case 'btn-down': this.pacman.nextDirection = 'down'; break;
                            case 'btn-left': this.pacman.nextDirection = 'left'; break;
                            case 'btn-right': this.pacman.nextDirection = 'right'; break;
                        }
                    });
                    
                    document.body.appendChild(btn);
                });
            }
            
            /**
             * –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
             */
            setupDevConsole() {
                window.game = {
                    /**
                     * –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –∏–≥—Ä—ã
                     * @param {number} [amount=20] - –ù–∞ —Å–∫–æ–ª—å–∫–æ —É–º–µ–Ω—å—à–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É
                     */
                    increaseSpeed: (amount = 20) => {
                        this.gameSpeed = Math.max(50, this.gameSpeed - amount);
                        this.codeModified = true;
                        this.checkAchievements();
                        this.showNotification('–°–∫–æ—Ä–æ—Å—Ç—å –∏–≥—Ä—ã —É–≤–µ–ª–∏—á–µ–Ω–∞!');
                    },
                    
                    /**
                     * –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤–æ–µ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–µ
                     */
                    addGhost: () => {
                        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–µ
                        this.ghosts = this.ghosts || [this.ghost];
                        this.ghosts.push({
                            x: 10,
                            y: 8,
                            direction: 'left',
                            mode: 'wandering',
                            speed: 0.8,
                            color: this.ghosts.length % 2 === 0 ? 'pink' : 'purple'
                        });
                        
                        this.codeModified = true;
                        this.checkAchievements();
                        this.showNotification('–î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤–æ–µ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–µ!');
                    },
                    
                    /**
                     * –¢–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –ü–∞–∫–º–∞–Ω–∞ –≤ —É–∫–∞–∑–∞–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
                     * @param {number} x - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ X
                     * @param {number} y - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y
                     */
                    teleport: (x, y) => {
                        this.pacman.x = x;
                        this.pacman.y = y;
                        this.codeModified = true;
                        this.checkAchievements();
                        this.showNotification(`–ü–∞–∫–º–∞–Ω —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ (${x}, ${y})`);
                    },
                    
                    /**
                     * –í–∫–ª—é—á–∞–µ—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
                     */
                    enablePathVisualization: () => {
                        this.isVisualizingPath = true;
                        this.showNotification('–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –≤–∫–ª—é—á–µ–Ω–∞');
                    },
                    
                    /**
                     * –û—Ç–∫–ª—é—á–∞–µ—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
                     */
                    disablePathVisualization: () => {
                        this.isVisualizingPath = false;
                        this.showNotification('–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –≤—ã–∫–ª—é—á–µ–Ω–∞');
                    }
                };
            }
            
            /**
             * –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Ç–µ–º—É (—Ç–µ–º–Ω–∞—è/—Å–≤–µ—Ç–ª–∞—è)
             */
            toggleTheme() {
                this.isDarkTheme = !this.isDarkTheme;
                document.body.classList.toggle('dark-theme', this.isDarkTheme);
                document.body.classList.toggle('light-theme', !this.isDarkTheme);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä —Ç–µ–º—ã
                localStorage.setItem('pacmanTheme', this.isDarkTheme ? 'dark' : 'light');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                const themeButton = document.getElementById('theme-toggle');
                themeButton.innerHTML = `<span>${this.isDarkTheme ? 'üåô' : '‚òÄÔ∏è'}</span> ${this.isDarkTheme ? '–¢–µ–º–Ω–∞—è' : '–°–≤–µ—Ç–ª–∞—è'} —Ç–µ–º–∞`;
            }
            
            /**
             * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
             */
            initUIComponents() {
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É
                this.initTheme();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä —É—Ä–æ–≤–Ω–µ–π
                this.initLevelEditor();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–∏—Å—Ç–µ–º—É –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
                this.initAchievements();
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
                this.renderAchievements();
            }
            
            /**
             * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–º—É
             */
            initTheme() {
                const savedTheme = localStorage.getItem('pacmanTheme');
                this.isDarkTheme = savedTheme === 'dark' || 
                                  (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches);
                
                document.body.classList.add(this.isDarkTheme ? 'dark-theme' : 'light-theme');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —Ç–µ–º—ã
                const themeButton = document.getElementById('theme-toggle');
                themeButton.innerHTML = `<span>${this.isDarkTheme ? 'üåô' : '‚òÄÔ∏è'}</span> ${this.isDarkTheme ? '–¢–µ–º–Ω–∞—è' : '–°–≤–µ—Ç–ª–∞—è'} —Ç–µ–º–∞`;
            }
            
            /**
             * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä–µ–¥–∞–∫—Ç–æ—Ä —É—Ä–æ–≤–Ω–µ–π
             */
            initLevelEditor() {
                this.editorCanvas = document.getElementById('editor-canvas');
                this.editorCtx = this.editorCanvas.getContext('2d');
                this.currentTool = 'wall';
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
                this.editorCanvas.addEventListener('mousedown', (e) => this.handleEditorMouseDown(e));
                this.editorCanvas.addEventListener('mousemove', (e) => this.handleEditorMouseMove(e));
                this.editorCanvas.addEventListener('mouseup', () => this.isDrawing = false);
                this.editorCanvas.addEventListener('mouseleave', () => this.isDrawing = false);
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—ã–±–æ—Ä–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
                document.querySelectorAll('.tool-button').forEach(button => {
                    button.addEventListener('click', () => {
                        document.querySelectorAll('.tool-button').forEach(b => b.classList.remove('active'));
                        button.classList.add('active');
                        this.currentTool = button.dataset.tool;
                    });
                });
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
                this.editorMap = this.cloneMap(this.levels[0]);
                this.drawEditorMap();
            }
            
            /**
             * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏–µ –º—ã—à–∏ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ —É—Ä–æ–≤–Ω–µ–π
             * @param {MouseEvent} e - –°–æ–±—ã—Ç–∏–µ –º—ã—à–∏
             */
            handleEditorMouseDown(e) {
                this.isDrawing = true;
                this.updateEditorCell(e);
            }
            
            /**
             * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∏ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ —É—Ä–æ–≤–Ω–µ–π
             * @param {MouseEvent} e - –°–æ–±—ã—Ç–∏–µ –º—ã—à–∏
             */
            handleEditorMouseMove(e) {
                if (this.isDrawing) {
                    this.updateEditorCell(e);
                }
            }
            
            /**
             * –û–±–Ω–æ–≤–ª—è–µ—Ç —è—á–µ–π–∫—É –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ —É—Ä–æ–≤–Ω–µ–π
             * @param {MouseEvent} e - –°–æ–±—ã—Ç–∏–µ –º—ã—à–∏
             */
            updateEditorCell(e) {
                const rect = this.editorCanvas.getBoundingClientRect();
                const x = Math.floor((e.clientX - rect.left) / this.cellSize);
                const y = Math.floor((e.clientY - rect.top) / this.cellSize);
                
                if (x >= 0 && x < this.editorMap[0].length && y >= 0 && y < this.editorMap.length) {
                    switch(this.currentTool) {
                        case 'wall':
                            this.editorMap[y][x] = 0;
                            break;
                        case 'path':
                            this.editorMap[y][x] = 1;
                            break;
                        case 'food':
                            this.editorMap[y][x] = 2;
                            break;
                        case 'super-food':
                            this.editorMap[y][x] = 3;
                            break;
                        case 'pacman':
                            // –°–Ω–∞—á–∞–ª–∞ –æ—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –ü–∞–∫–º–∞–Ω–∞
                            for (let i = 0; i < this.editorMap.length; i++) {
                                for (let j = 0; j < this.editorMap[i].length; j++) {
                                    if (this.editorMap[i][j] === 4) {
                                        this.editorMap[i][j] = 1;
                                    }
                                }
                            }
                            this.editorMap[y][x] = 4;
                            break;
                        case 'ghost':
                            // –°–Ω–∞—á–∞–ª–∞ –æ—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è
                            for (let i = 0; i < this.editorMap.length; i++) {
                                for (let j = 0; j < this.editorMap[i].length; j++) {
                                    if (this.editorMap[i][j] === 5) {
                                        this.editorMap[i][j] = 1;
                                    }
                                }
                            }
                            this.editorMap[y][x] = 5;
                            break;
                    }
                    this.drawEditorMap();
                }
            }
            
            /**
             * –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—É –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ —É—Ä–æ–≤–Ω–µ–π
             */
            drawEditorMap() {
                const mapHeight = this.editorMap.length;
                const mapWidth = this.editorMap[0].length;
                
                // –û—á–∏—Å—Ç–∫–∞ —Ö–æ–ª—Å—Ç–∞
                this.editorCtx.fillStyle = 'black';
                this.editorCtx.fillRect(0, 0, this.editorCanvas.width, this.editorCanvas.height);
                
                for (let y = 0; y < mapHeight; y++) {
                    for (let x = 0; x < mapWidth; x++) {
                        const cell = this.editorMap[y][x];
                        
                        // –°—Ç–µ–Ω—ã
                        if (cell === 0) {
                            this.editorCtx.fillStyle = 'blue';
                            this.editorCtx.fillRect(
                                x * this.cellSize, 
                                y * this.cellSize, 
                                this.cellSize, 
                                this.cellSize
                            );
                        } 
                        // –ü—É—Ç—å
                        else if (cell === 1) {
                            this.editorCtx.fillStyle = 'black';
                            this.editorCtx.fillRect(
                                x * this.cellSize, 
                                y * this.cellSize, 
                                this.cellSize, 
                                this.cellSize
                            );
                        } 
                        // –û–±—ã—á–Ω–∞—è –µ–¥–∞
                        else if (cell === 2) {
                            this.editorCtx.fillStyle = 'white';
                            this.editorCtx.beginPath();
                            this.editorCtx.arc(
                                x * this.cellSize + this.cellSize/2,
                                y * this.cellSize + this.cellSize/2,
                                2, 0, Math.PI * 2
                            );
                            this.editorCtx.fill();
                        } 
                        // –°—É–ø–µ—Ä-–µ–¥–∞
                        else if (cell === 3) {
                            this.editorCtx.fillStyle = '#FFD700';
                            this.editorCtx.beginPath();
                            this.editorCtx.arc(
                                x * this.cellSize + this.cellSize/2,
                                y * this.cellSize + this.cellSize/2,
                                5, 0, Math.PI * 2
                            );
                            this.editorCtx.fill();
                        }
                        // –ü–∞–∫–º–∞–Ω
                        else if (cell === 4) {
                            this.editorCtx.fillStyle = 'yellow';
                            this.editorCtx.beginPath();
                            this.editorCtx.arc(
                                x * this.cellSize + this.cellSize/2,
                                y * this.cellSize + this.cellSize/2,
                                this.cellSize/2 - 2, 0, Math.PI * 1.8
                            );
                            this.editorCtx.lineTo(
                                x * this.cellSize + this.cellSize/2,
                                y * this.cellSize + this.cellSize/2
                            );
                            this.editorCtx.fill();
                        }
                        // –ü—Ä–∏–≤–∏–¥–µ–Ω–∏–µ
                        else if (cell === 5) {
                            this.editorCtx.fillStyle = 'red';
                            this.editorCtx.fillRect(
                                x * this.cellSize,
                                y * this.cellSize,
                                this.cellSize, this.cellSize
                            );
                        }
                    }
                }
            }
            
            /**
             * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
             */
            saveEditedLevel() {
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–∞—Ä—Ç—É —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –≤ —Ñ–æ—Ä–º–∞—Ç —É—Ä–æ–≤–Ω—è
                const levelMap = this.editorMap.map(row => {
                    return row.map(cell => {
                        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —è—á–µ–π–∫–∏ –≤ –æ–±—ã—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                        if (cell === 4) return 1; // –ü–∞–∫–º–∞–Ω
                        if (cell === 5) return 1; // –ü—Ä–∏–≤–∏–¥–µ–Ω–∏–µ
                        return cell;
                    });
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å –≤ –º–∞—Å—Å–∏–≤ —É—Ä–æ–≤–Ω–µ–π
                this.levels.push(levelMap);
                this.currentLevel = this.levels.length;
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä –∏ –Ω–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å
                this.closeLevelEditor();
                this.resetGameState();
                this.resumeGame();
                
                this.showNotification('–£—Ä–æ–≤–µ–Ω—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∏ –∑–∞–≥—Ä—É–∂–µ–Ω!');
            }
            
            /**
             * –ó–∞–≥—Ä—É–∂–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –∏–∑ —Ñ–∞–π–ª–∞
             * @param {File} file - –§–∞–π–ª —É—Ä–æ–≤–Ω—è
             */
            loadLevelFromFile(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const levelData = JSON.parse(e.target.result);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞
                        if (levelData.version === '1.0' && Array.isArray(levelData.map)) {
                            this.levels.push(levelData.map);
                            this.currentLevel = this.levels.length;
                            this.closeLevelEditor();
                            this.resetGameState();
                            this.resumeGame();
                            this.showNotification('–£—Ä–æ–≤–µ–Ω—å —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                        } else {
                            this.showNotification('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ —É—Ä–æ–≤–Ω—è', 'error');
                        }
                    } catch (error) {
                        this.showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ —É—Ä–æ–≤–Ω—è', 'error');
                    }
                };
                reader.readAsText(file);
            }
            
            /**
             * –ó–∞–∫—Ä—ã–≤–∞–µ—Ç —Ä–µ–¥–∞–∫—Ç–æ—Ä —É—Ä–æ–≤–Ω–µ–π
             */
            closeLevelEditor() {
                document.getElementById('level-editor').style.display = 'none';
            }
            
            /**
             * –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ä–µ–¥–∞–∫—Ç–æ—Ä —É—Ä–æ–≤–Ω–µ–π
             */
            openLevelEditor() {
                // –ö–æ–ø–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä
                this.editorMap = this.cloneMap(this.currentMap);
                this.drawEditorMap();
                
                document.getElementById('level-editor').style.display = 'flex';
            }
            
            /**
             * –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è
             */
            toggleLearningMode() {
                this.isLearningMode = !this.isLearningMode;
                const button = document.getElementById('mode-toggle');
                const learningPanel = document.getElementById('learning-mode');
                
                if (this.isLearningMode) {
                    button.innerHTML = '<span>üéì</span> –†–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è: –í–∫–ª';
                    learningPanel.style.display = 'block';
                    document.getElementById('debug-panel').style.display = 'block';
                } else {
                    button.innerHTML = '<span>üéì</span> –†–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è: –í—ã–∫–ª';
                    learningPanel.style.display = 'none';
                    document.getElementById('debug-panel').style.display = 'none';
                }
            }
            
            /**
             * –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –∑–≤—É–∫
             */
            toggleSound() {
                this.isSoundEnabled = !this.isSoundEnabled;
                const button = document.getElementById('sound-toggle');
                button.innerHTML = `<span>${this.isSoundEnabled ? 'üîä' : 'üîá'}</span> –ó–≤—É–∫: ${this.isSoundEnabled ? '–í–∫–ª' : '–í—ã–∫–ª'}`;
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –º—É–∑—ã–∫—É –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏
                if (!this.isSoundEnabled) {
                    this.sounds.music.stop(this);
                } 
                // –ó–∞–ø—É—Å–∫–∞–µ–º –º—É–∑—ã–∫—É –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏, –µ—Å–ª–∏ –∏–≥—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞
                else if (this.isRunning) {
                    this.sounds.music.play(this);
                }
            }
            
            /**
             * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏–µ –∫–ª–∞–≤–∏—à –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ü–∞–∫–º–∞–Ω–æ–º
             * @param {KeyboardEvent} e - –°–æ–±—ã—Ç–∏–µ –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à–∏
             */
            handleKey(e) {
                if (!this.isRunning) return;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
                switch(e.key) {
                    case 'ArrowUp':
                        this.pacman.nextDirection = 'up';
                        e.preventDefault();
                        break;
                    case 'ArrowDown':
                        this.pacman.nextDirection = 'down';
                        e.preventDefault();
                        break;
                    case 'ArrowLeft':
                        this.pacman.nextDirection = 'left';
                        e.preventDefault();
                        break;
                    case 'ArrowRight':
                        this.pacman.nextDirection = 'right';
                        e.preventDefault();
                        break;
                    case 'l':
                        if (e.ctrlKey) {
                            this.openLesson(1);
                            e.preventDefault();
                        }
                        break;
                }
            }
            
            /**
             * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–ª–∏–∫ –ø–æ –∏–≥—Ä–æ–≤–æ–º—É –ø–æ–ª—é –≤ —Ä–µ–∂–∏–º–µ –æ–±—É—á–µ–Ω–∏—è
             * @param {MouseEvent} e - –°–æ–±—ã—Ç–∏–µ –∫–ª–∏–∫–∞
             */
            handleCanvasClick(e) {
                if (!this.isLearningMode) return;
                
                const rect = this.canvas.getBoundingClientRect();
                const x = Math.floor((e.clientX - rect.left) / this.cellSize);
                const y = Math.floor((e.clientY - rect.top) / this.cellSize);
                
                let explanation = '';
                
                if (x === this.pacman.x && y === this.pacman.y) {
                    explanation = '–≠—Ç–æ –ü–∞–∫–º–∞–Ω! –£–ø—Ä–∞–≤–ª—è–µ—Ç –∏–≥—Ä–æ–∫. –î–≤–∏–∂–µ—Ç—Å—è –ø–æ –ª–∞–±–∏—Ä–∏–Ω—Ç—É, —Å–æ–±–∏—Ä–∞—è –µ–¥—É –∏ –∏–∑–±–µ–≥–∞—è –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–π.';
                } else if (x === this.ghost.x && y === this.ghost.y) {
                    explanation = '–≠—Ç–æ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–µ! –ò–º–µ–µ—Ç —Ç—Ä–∏ —Ä–µ–∂–∏–º–∞: –±–ª—É–∂–¥–∞–Ω–∏–µ, –ø—Ä–µ—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏ –±–µ–≥—Å—Ç–≤–æ (–ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å—É–ø–µ—Ä-–µ–¥—ã).';
                } else if (this.currentMap[y] && this.currentMap[y][x] === 2) {
                    explanation = '–û–±—ã—á–Ω–∞—è –µ–¥–∞. –î–∞–µ—Ç 10 –æ—á–∫–æ–≤ –ø—Ä–∏ —Å–±–æ—Ä–µ.';
                } else if (this.currentMap[y] && this.currentMap[y][x] === 3) {
                    explanation = '–°—É–ø–µ—Ä-–µ–¥–∞. –î–∞–µ—Ç 50 –æ—á–∫–æ–≤ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ä–µ–∂–∏–º –æ—Ö–æ—Ç—ã –Ω–∞ 10 —Å–µ–∫—É–Ω–¥.';
                } else if (this.currentMap[y] && this.currentMap[y][x] === 0) {
                    explanation = '–°—Ç–µ–Ω–∞. –ü–∞–∫–º–∞–Ω –∏ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–µ –Ω–µ –º–æ–≥—É—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —Å–∫–≤–æ–∑—å —Å—Ç–µ–Ω—ã.';
                }
                
                document.getElementById('learning-content').textContent = explanation || '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–≥—Ä–æ–≤–æ–π –æ–±—ä–µ–∫—Ç, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ';
            }
            
            /**
             * –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã (—Å—Ç–∞—Ä—Ç/–ø–∞—É–∑–∞)
             */
            toggleGame() {
                if (this.isRunning) {
                    this.pauseGame();
                } else {
                    this.resumeGame();
                }
            }
            
            /**
             * –ü—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏–≥—Ä—É
             */
            pauseGame() {
                this.isRunning = false;
                if (this.animationFrameId) {
                    cancelAnimationFrame(this.animationFrameId);
                    this.animationFrameId = null;
                }
                this.sounds.music.stop(this);
                document.getElementById('game-status').textContent = '–ü–∞—É–∑–∞';
                document.getElementById('start-btn').innerHTML = '<span>‚ñ∂Ô∏è</span> –°—Ç–∞—Ä—Ç/–ü–∞—É–∑–∞';
            }
            
            /**
             * –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–≥—Ä—É
             */
            resumeGame() {
                this.isRunning = true;
                document.getElementById('game-status').textContent = '–ò–≥—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞';
                document.getElementById('start-btn').innerHTML = '<span>‚è∏Ô∏è</span> –°—Ç–∞—Ä—Ç/–ü–∞—É–∑–∞';
                this.lastTimestamp = performance.now();
                this.startGameLoop();
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –º—É–∑—ã–∫—É, –µ—Å–ª–∏ –∑–≤—É–∫ –≤–∫–ª—é—á–µ–Ω
                if (this.isSoundEnabled) {
                    this.sounds.music.play(this);
                }
            }
            
            /**
             * –ó–∞–ø—É—Å–∫–∞–µ—Ç –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º requestAnimationFrame
             */
            startGameLoop() {
                if (!this.isRunning) return;
                
                const gameLoop = (timestamp) => {
                    // –í—ã—á–∏—Å–ª—è–µ–º deltaTime –¥–ª—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —á–∞—Å—Ç–æ—Ç—ã –∫–∞–¥—Ä–æ–≤
                    const deltaTime = timestamp - this.lastTimestamp;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–≥—Ä—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏
                    if (deltaTime >= this.gameSpeed) {
                        this.update();
                        this.lastTimestamp = timestamp;
                    }
                    
                    this.draw();
                    this.animateMouth();
                    this.updateParticles();
                    
                    this.animationFrameId = requestAnimationFrame(gameLoop);
                };
                
                this.animationFrameId = requestAnimationFrame(gameLoop);
            }
            
            /**
             * –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å
             */
            resetLevel() {
                this.pauseGame();
                this.resetGameState();
                this.updateUI();
                this.resumeGame();
            }
            
            /**
             * –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ä–µ–∫–æ—Ä–¥
             */
            clearHighScore() {
                this.highScore = 0;
                localStorage.setItem('pacmanHighScore', '0');
                this.updateUI();
            }
            
            /**
             * –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –∏–≥—Ä—É —Å–Ω–∞—á–∞–ª–∞
             */
            restartGame() {
                this.currentLevel = 1;
                this.resetLevel();
                document.getElementById('game-over').style.display = 'none';
            }
            
            /**
             * –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É
             */
            resetGameState() {
                this.pacman = { 
                    x: 10, 
                    y: 15, 
                    direction: 'right', 
                    nextDirection: null, 
                    mouthAngle: 0, 
                    mouthOpening: 0.1,
                    lastEatTime: 0,
                    eatInterval: 150
                };
                this.ghost = { 
                    x: 10, 
                    y: 8, 
                    direction: 'left', 
                    mode: 'wandering', 
                    speed: 0.8, 
                    color: 'red',
                    fearTimer: null
                };
                this.ghosts = null; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è
                this.score = 0;
                this.powerMode = false;
                this.gameSpeed = 200;
                this.currentMap = this.cloneMap(this.levels[this.currentLevel - 1]);
                this.countTotalFood();
            }
            
            /**
             * –û–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
             */
            updateUI() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('high-score').textContent = this.highScore;
                document.getElementById('level').textContent = this.currentLevel;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–∞ –≤ localStorage
                if (this.score > this.highScore) {
                    this.highScore = this.score;
                    localStorage.setItem('pacmanHighScore', this.highScore.toString());
                }
                document.getElementById('high-score').textContent = this.highScore;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –ø–∞–Ω–µ–ª–∏
                if (this.isLearningMode) {
                    document.getElementById('debug-pos').textContent = `${this.pacman.x}, ${this.pacman.y}`;
                    document.getElementById('debug-dir').textContent = this.pacman.direction;
                    document.getElementById('debug-speed').textContent = `${this.gameSpeed} –º—Å`;
                    document.getElementById('debug-power').textContent = this.powerMode ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–ù–µ –∞–∫—Ç–∏–≤–Ω–∞';
                }
            }
            
            /**
             * –ê–Ω–∏–º–∏—Ä—É–µ—Ç —Ä–æ—Ç –ü–∞–∫–º–∞–Ω–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∞ "–ø–æ–µ–¥–∞–Ω–∏—è"
             */
            animateMouth() {
                this.pacman.mouthAngle += this.pacman.mouthOpening;
                if (this.pacman.mouthAngle >= 0.4 || this.pacman.mouthAngle <= 0) {
                    this.pacman.mouthOpening = -this.pacman.mouthOpening;
                }
            }
            
            /**
             * –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
             */
            update() {
                this.movePacman();
                this.moveGhost();
                this.checkCollisions();
                this.checkLevelCompletion();
                this.checkAchievements();
            }
            
            /**
             * –î–≤–∏–≥–∞–µ—Ç –ü–∞–∫–º–∞–Ω–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º
             */
            movePacman() {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                if (this.pacman.nextDirection) {
                    const nextPos = this.getFuturePosition(this.pacman.x, this.pacman.y, this.pacman.nextDirection);
                    if (this.isValidMove(nextPos.x, nextPos.y)) {
                        this.pacman.direction = this.pacman.nextDirection;
                        this.pacman.nextDirection = null;
                    }
                }
                
                // –î–≤–∏–∂–µ–Ω–∏–µ –≤ —Ç–µ–∫—É—â–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
                const nextPos = this.getFuturePosition(this.pacman.x, this.pacman.y, this.pacman.direction);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ—Ä—Ç–∞–ª—ã (–≤—ã—Ö–æ–¥ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ä—Ç—ã)
                if (nextPos.x < 0 || nextPos.x >= this.currentMap[0].length) {
                    this.pacman.x = (nextPos.x + this.currentMap[0].length) % this.currentMap[0].length;
                    return;
                }
                
                if (this.isValidMove(nextPos.x, nextPos.y)) {
                    this.pacman.x = nextPos.x;
                    this.pacman.y = nextPos.y;
                }
            }
            
            /**
             * –î–≤–∏–≥–∞–µ—Ç –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –µ–≥–æ —Ç–µ–∫—É—â–∏–º —Ä–µ–∂–∏–º–æ–º
             */
            moveGhost() {
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è
                this.updateGhostMode();
                
                // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                const nextDirection = this.calculateGhostDirection();
                this.ghost.direction = nextDirection;
                
                // –î–≤–∏–∂–µ–Ω–∏–µ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è
                const nextPos = this.getFuturePosition(this.ghost.x, this.ghost.y, this.ghost.direction);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ—Ä—Ç–∞–ª—ã
                if (nextPos.x < 0 || nextPos.x >= this.currentMap[0].length) {
                    this.ghost.x = (nextPos.x + this.currentMap[0].length) % this.currentMap[0].length;
                    return;
                }
                
                if (this.isValidMove(nextPos.x, nextPos.y, 'ghost')) {
                    this.ghost.x = nextPos.x;
                    this.ghost.y = nextPos.y;
                }
                
                // –î–≤–∏–∂–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–π
                if (this.ghosts) {
                    this.ghosts.forEach(ghost => {
                        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è
                        this.updateGhostModeForGhost(ghost);
                        
                        // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                        const nextDirection = this.calculateGhostDirectionForGhost(ghost);
                        ghost.direction = nextDirection;
                        
                        // –î–≤–∏–∂–µ–Ω–∏–µ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è
                        const nextPos = this.getFuturePosition(ghost.x, ghost.y, ghost.direction);
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ—Ä—Ç–∞–ª—ã
                        if (nextPos.x < 0 || nextPos.x >= this.currentMap[0].length) {
                            ghost.x = (nextPos.x + this.currentMap[0].length) % this.currentMap[0].length;
                            return;
                        }
                        
                        if (this.isValidMove(nextPos.x, nextPos.y, 'ghost')) {
                            ghost.x = nextPos.x;
                            ghost.y = nextPos.y;
                        }
                    });
                }
            }
            
            /**
             * –û–±–Ω–æ–≤–ª—è–µ—Ç —Ä–µ–∂–∏–º –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
             */
            updateGhostMode() {
                const dx = this.pacman.x - this.ghost.x;
                const dy = this.pacman.y - this.ghost.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                // –†–µ–∂–∏–º —Å—É–ø–µ—Ä-–µ–¥—ã –∞–∫—Ç–∏–≤–µ–Ω
                if (this.powerMode) {
                    this.ghost.mode = 'fleeing';
                    this.ghost.color = 'blue';
                    
                    // –¢–∞–π–º–µ—Ä —Å—É–ø–µ—Ä-–µ–¥—ã
                    if (Date.now() - this.powerModeStart > 10000) {
                        this.powerMode = false;
                        this.ghost.color = 'red';
                        if (this.ghost.fearTimer) {
                            clearTimeout(this.ghost.fearTimer);
                            this.ghost.fearTimer = null;
                        }
                    }
                } 
                // –ë–ª–∏–∑–∫–æ –∫ –ü–∞–∫–º–∞–Ω—É
                else if (distance < 5) {
                    this.ghost.mode = 'chasing';
                    this.ghost.color = 'red';
                } 
                // –î–∞–ª–µ–∫–æ –æ—Ç –ü–∞–∫–º–∞–Ω–∞
                else {
                    this.ghost.mode = 'wandering';
                    this.ghost.color = 'pink';
                }
            }
            
            /**
             * –û–±–Ω–æ–≤–ª—è–µ—Ç —Ä–µ–∂–∏–º –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è
             * @param {Object} ghost - –û–±—ä–µ–∫—Ç –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è
             */
            updateGhostModeForGhost(ghost) {
                const dx = this.pacman.x - ghost.x;
                const dy = this.pacman.y - ghost.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                // –†–µ–∂–∏–º —Å—É–ø–µ—Ä-–µ–¥—ã –∞–∫—Ç–∏–≤–µ–Ω
                if (this.powerMode) {
                    ghost.mode = 'fleeing';
                    ghost.color = 'blue';
                } 
                // –ë–ª–∏–∑–∫–æ –∫ –ü–∞–∫–º–∞–Ω—É
                else if (distance < 5) {
                    ghost.mode = 'chasing';
                } 
                // –î–∞–ª–µ–∫–æ –æ—Ç –ü–∞–∫–º–∞–Ω–∞
                else {
                    ghost.mode = 'wandering';
                }
            }
            
            /**
             * –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è
             * @returns {string} –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è (up, down, left, right)
             */
            calculateGhostDirection() {
                // –í —Ä–µ–∂–∏–º–µ –±–µ–≥—Å—Ç–≤–∞ –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É
                const targetMode = this.ghost.mode === 'fleeing' ? 'chasing' : this.ghost.mode;
                
                if (targetMode === 'chasing') {
                    return this.findPathToTarget(this.pacman.x, this.pacman.y);
                } else if (targetMode === 'wandering') {
                    // –°–ª—É—á–∞–π–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
                    const directions = ['up', 'down', 'left', 'right'];
                    const validDirections = directions.filter(dir => {
                        const nextPos = this.getFuturePosition(this.ghost.x, this.ghost.y, dir);
                        return this.isValidMove(nextPos.x, nextPos.y, 'ghost') && 
                               dir !== this.getOppositeDirection(this.ghost.direction);
                    });
                    
                    return validDirections.length > 0 ? 
                        validDirections[Math.floor(Math.random() * validDirections.length)] : 
                        this.ghost.direction;
                }
                
                return this.ghost.direction;
            }
            
            /**
             * –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è
             * @param {Object} ghost - –û–±—ä–µ–∫—Ç –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è
             * @returns {string} –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è
             */
            calculateGhostDirectionForGhost(ghost) {
                // –í —Ä–µ–∂–∏–º–µ –±–µ–≥—Å—Ç–≤–∞ –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É
                const targetMode = ghost.mode === 'fleeing' ? 'chasing' : ghost.mode;
                
                if (targetMode === 'chasing') {
                    return this.findPathToTarget(this.pacman.x, this.pacman.y);
                } else if (targetMode === 'wandering') {
                    // –°–ª—É—á–∞–π–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
                    const directions = ['up', 'down', 'left', 'right'];
                    const validDirections = directions.filter(dir => {
                        const nextPos = this.getFuturePosition(ghost.x, ghost.y, dir);
                        return this.isValidMove(nextPos.x, nextPos.y, 'ghost') && 
                               dir !== this.getOppositeDirection(ghost.direction);
                    });
                    
                    return validDirections.length > 0 ? 
                        validDirections[Math.floor(Math.random() * validDirections.length)] : 
                        ghost.direction;
                }
                
                return ghost.direction;
            }
            
            /**
             * –ù–∞—Ö–æ–¥–∏—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∫ —Ü–µ–ª–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–æ—Å—Ç–æ–≥–æ —ç–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞
             * @param {number} targetX - –¶–µ–ª–µ–≤–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ X
             * @param {number} targetY - –¶–µ–ª–µ–≤–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y
             * @returns {string} –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è
             */
            findPathToTarget(targetX, targetY) {
                const directions = ['up', 'down', 'left', 'right'];
                let bestDirection = null;
                let minDistance = Infinity;
                
                for (const direction of directions) {
                    const nextPos = this.getFuturePosition(this.ghost.x, this.ghost.y, direction);
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ö–æ–¥–∞
                    if (!this.isValidMove(nextPos.x, nextPos.y, 'ghost') || 
                        direction === this.getOppositeDirection(this.ghost.direction)) {
                        continue;
                    }
                    
                    // –†–∞—Å—á–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –¥–æ —Ü–µ–ª–∏
                    const dx = targetX - nextPos.x;
                    const dy = targetY - nextPos.y;
                    const distance = dx * dx + dy * dy; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–≤–∞–¥—Ä–∞—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
                    
                    if (distance < minDistance) {
                        minDistance = distance;
                        bestDirection = direction;
                    }
                }
                
                // –ï—Å–ª–∏ –Ω–µ—Ç –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π, –æ—Å—Ç–∞–µ–º—Å—è –Ω–∞ –º–µ—Å—Ç–µ
                return bestDirection || this.ghost.direction;
            }
            
            /**
             * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
             * @param {string} direction - –¢–µ–∫—É—â–µ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
             * @returns {string} –ü—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
             */
            getOppositeDirection(direction) {
                switch(direction) {
                    case 'up': return 'down';
                    case 'down': return 'up';
                    case 'left': return 'right';
                    case 'right': return 'left';
                    default: return direction;
                }
            }
            
            /**
             * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è –ü–∞–∫–º–∞–Ω–∞ —Å –µ–¥–æ–π –∏ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–µ–º
             */
            checkCollisions() {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤—ã—Ö–æ–¥ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ä—Ç—ã
                if (!this.currentMap[this.pacman.y] || !this.currentMap[this.pacman.y][this.pacman.x]) {
                    return;
                }
                
                // –°–±–æ—Ä –µ–¥—ã
                const cell = this.currentMap[this.pacman.y][this.pacman.x];
                if (cell === 2 || cell === 3) {
                    if (cell === 2) {
                        this.collectFood(10);
                    } else if (cell === 3) {
                        this.activatePowerMode();
                    }
                }
                
                // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–µ–º
                if (this.pacman.x === this.ghost.x && this.pacman.y === this.ghost.y) {
                    if (this.powerMode) {
                        // –í —Ä–µ–∂–∏–º–µ —Å—É–ø–µ—Ä-–µ–¥—ã –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–µ —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è
                        this.playSound('eat');
                        this.resetGhost();
                        this.score += 200;
                        this.updateUI();
                    } else {
                        // –û–±—ã—á–Ω–æ–µ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ - –∫–æ–Ω–µ—Ü –∏–≥—Ä—ã
                        this.gameOver();
                    }
                }
                
                // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è–º–∏
                if (this.ghosts) {
                    for (let i = 0; i < this.ghosts.length; i++) {
                        const ghost = this.ghosts[i];
                        if (this.pacman.x === ghost.x && this.pacman.y === ghost.y) {
                            if (this.powerMode) {
                                // –í —Ä–µ–∂–∏–º–µ —Å—É–ø–µ—Ä-–µ–¥—ã –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–µ —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è
                                this.playSound('eat');
                                this.ghosts.splice(i, 1);
                                this.score += 200;
                                this.updateUI();
                            } else {
                                // –û–±—ã—á–Ω–æ–µ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ - –∫–æ–Ω–µ—Ü –∏–≥—Ä—ã
                                this.gameOver();
                                break;
                            }
                        }
                    }
                }
            }
            
            /**
             * –°–æ–±–∏—Ä–∞–µ—Ç –µ–¥—É –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—á—ë—Ç
             * @param {number} points - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∫–æ–≤ –∑–∞ —Å–±–æ—Ä
             */
            collectFood(points) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —è—á–µ–π–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –µ–¥—É
                if (this.currentMap[this.pacman.y] && 
                    (this.currentMap[this.pacman.y][this.pacman.x] === 2 || 
                     this.currentMap[this.pacman.y][this.pacman.x] === 3)) {
                    
                    this.currentMap[this.pacman.y][this.pacman.x] = 1;
                    this.score += points;
                    this.foodCount--;
                    this.playSound('eat');
                    this.createParticles(this.pacman.x, this.pacman.y);
                    this.updateUI();
                }
            }
            
            /**
             * –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ä–µ–∂–∏–º —Å—É–ø–µ—Ä-–µ–¥—ã
             */
            activatePowerMode() {
                this.collectFood(50);
                this.powerMode = true;
                this.powerModeStart = Date.now();
                this.ghost.color = 'blue';
                this.playSound('power');
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä —Å—Ç—Ä–∞—Ö–∞, –µ—Å–ª–∏ –æ–Ω —É–∂–µ –∑–∞–ø—É—â–µ–Ω
                if (this.ghost.fearTimer) {
                    clearTimeout(this.ghost.fearTimer);
                }
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞
                this.ghost.fearTimer = setTimeout(() => {
                    this.powerMode = false;
                    this.ghost.color = 'red';
                    this.ghost.fearTimer = null;
                }, 10000);
            }
            
            /**
             * –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è –ø–æ—Å–ª–µ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è
             */
            resetGhost() {
                this.ghost.x = 10;
                this.ghost.y = 8;
                this.ghost.direction = 'left';
                this.ghost.mode = 'wandering';
            }
            
            /**
             * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
             */
            checkLevelCompletion() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–±—Ä–∞–Ω–∞ –ª–∏ –≤—Å—è –µ–¥–∞
                if (this.foodCount <= 0) {
                    this.currentLevel++;
                    
                    // –ó–∞—Ü–∏–∫–ª–∏–≤–∞–µ–º —É—Ä–æ–≤–Ω–∏
                    if (this.currentLevel > this.levels.length) {
                        this.currentLevel = 1;
                    }
                    
                    // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–≥—Ä—ã
                    this.gameSpeed = Math.max(80, this.gameSpeed - 20);
                    
                    // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
                    this.resetGameState();
                    
                    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                    const levelComplete = document.getElementById('level-complete');
                    levelComplete.style.display = 'block';
                    setTimeout(() => {
                        levelComplete.style.display = 'none';
                    }, 2000);
                    
                    this.updateUI();
                }
            }
            
            /**
             * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–∫–æ–Ω—á–∞–Ω–∏–µ –∏–≥—Ä—ã
             */
            gameOver() {
                this.pauseGame();
                document.getElementById('game-status').textContent = '–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞';
                document.getElementById('final-score').textContent = this.score;
                document.getElementById('game-over').style.display = 'block';
                this.playSound('death');
                this.createConfetti();
            }
            
            /**
             * –°–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ñ–µ—Ç—Ç–∏-—ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è
             */
            createConfetti() {
                const colors = ['#FFD700', '#FFA500', '#FF4500', '#90EE90', '#87CEFA'];
                const confettiCount = 100;
                
                for (let i = 0; i < confettiCount; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.width = (Math.random() * 10 + 5) + 'px';
                    confetti.style.height = (Math.random() * 10 + 5) + 'px';
                    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                    document.body.appendChild(confetti);
                    
                    // –£–¥–∞–ª—è–µ–º –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
                    setTimeout(() => {
                        confetti.remove();
                    }, 5000);
                }
            }
            
            /**
             * –°–æ–∑–¥–∞–µ—Ç —á–∞—Å—Ç–∏—Ü—ã –ø—Ä–∏ —Å–±–æ—Ä–µ –µ–¥—ã
             * @param {number} x - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ X –≤ —è—á–µ–π–∫–∞—Ö
             * @param {number} y - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y –≤ —è—á–µ–π–∫–∞—Ö
             */
            createParticles(x, y) {
                const particleCount = this.powerMode ? 30 : 5;
                const colors = this.powerMode ? ['#00FFFF', '#00BFFF', '#1E90FF'] : ['#FFFFFF'];
                
                for (let i = 0; i < particleCount; i++) {
                    this.particles.push({
                        x: x * this.cellSize + this.cellSize/2,
                        y: y * this.cellSize + this.cellSize/2,
                        size: Math.random() * 3 + 2,
                        speedX: (Math.random() - 0.5) * 3,
                        speedY: (Math.random() - 0.5) * 3,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        alpha: 1,
                        decay: Math.random() * 0.05 + 0.01
                    });
                }
            }
            
            /**
             * –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–∞—Å—Ç–∏—Ü
             */
            updateParticles() {
                // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Å—Ç–∏—Ü
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    const particle = this.particles[i];
                    particle.x += particle.speedX;
                    particle.y += particle.speedY;
                    particle.alpha -= particle.decay;
                    
                    if (particle.alpha <= 0) {
                        this.particles.splice(i, 1);
                        continue;
                    }
                    
                    this.ctx.globalAlpha = particle.alpha;
                    this.ctx.fillStyle = particle.color;
                    this.ctx.beginPath();
                    this.ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    this.ctx.fill();
                }
                
                this.ctx.globalAlpha = 1;
            }
            
            /**
             * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å—Å—è –≤ —É–∫–∞–∑–∞–Ω–Ω—É—é —è—á–µ–π–∫—É
             * @param {number} x - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ X –≤ —è—á–µ–π–∫–∞—Ö
             * @param {number} y - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y –≤ —è—á–µ–π–∫–∞—Ö
             * @param {string} [entity='pacman'] - –¢–∏–ø —Å—É—â–Ω–æ—Å—Ç–∏ (pacman/ghost)
             * @returns {boolean} –î–æ–ø—É—Å—Ç–∏–º–æ –ª–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ
             */
            isValidMove(x, y, entity = 'pacman') {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü
                if (y < 0 || y >= this.currentMap.length || 
                    x < 0 || x >= this.currentMap[0].length) {
                    return false;
                }
                
                const cell = this.currentMap[y][x];
                
                // –°—Ç–µ–Ω—ã –±–ª–æ–∫–∏—Ä—É—é—Ç –¥–≤–∏–∂–µ–Ω–∏–µ
                if (cell === 0) {
                    return false;
                }
                
                // –ü—Ä–∏–≤–∏–¥–µ–Ω–∏–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Ç–æ—á–∫–∏
                if (entity === 'ghost' && (cell === 2 || cell === 3)) {
                    return true;
                }
                
                return true;
            }
            
            /**
             * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –ø–æ—Å–ª–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
             * @param {number} x - –¢–µ–∫—É—â–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ X
             * @param {number} y - –¢–µ–∫—É—â–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y
             * @param {string} direction - –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è
             * @returns {{x: number, y: number}} –ù–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è
             */
            getFuturePosition(x, y, direction) {
                const pos = { x, y };
                
                switch(direction) {
                    case 'up': pos.y--; break;
                    case 'down': pos.y++; break;
                    case 'left': pos.x--; break;
                    case 'right': pos.x++; break;
                }
                
                return pos;
            }
            
            /**
             * –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
             */
            draw() {
                // –û—á–∏—Å—Ç–∫–∞ —Ö–æ–ª—Å—Ç–∞
                this.ctx.fillStyle = 'black';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // –†–∏—Å—É–µ–º –∫–∞—Ä—Ç—É
                this.drawMap();
                
                // –†–∏—Å—É–µ–º –ü–∞–∫–º–∞–Ω–∞
                this.drawPacman();
                
                // –†–∏—Å—É–µ–º –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–µ
                this.drawGhost();
                
                // –†–∏—Å—É–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è
                if (this.ghosts) {
                    this.ghosts.forEach(ghost => {
                        this.drawGhostFor(ghost);
                    });
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –º–∏–Ω–∏-–∫–∞—Ä—Ç—É
                this.updateMiniMap();
            }
            
            /**
             * –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—É —É—Ä–æ–≤–Ω—è
             */
            drawMap() {
                const mapHeight = this.currentMap.length;
                const mapWidth = this.currentMap[0].length;
                
                for (let y = 0; y < mapHeight; y++) {
                    for (let x = 0; x < mapWidth; x++) {
                        const cell = this.currentMap[y][x];
                        
                        // –°—Ç–µ–Ω—ã
                        if (cell === 0) {
                            this.ctx.fillStyle = 'blue';
                            this.ctx.fillRect(
                                x * this.cellSize, 
                                y * this.cellSize, 
                                this.cellSize, 
                                this.cellSize
                            );
                        } 
                        // –û–±—ã—á–Ω–∞—è –µ–¥–∞
                        else if (cell === 2) {
                            this.ctx.fillStyle = 'white';
                            this.ctx.beginPath();
                            this.ctx.arc(
                                x * this.cellSize + this.cellSize/2,
                                y * this.cellSize + this.cellSize/2,
                                2, 0, Math.PI * 2
                            );
                            this.ctx.fill();
                        } 
                        // –°—É–ø–µ—Ä-–µ–¥–∞
                        else if (cell === 3) {
                            this.ctx.fillStyle = '#FFD700';
                            this.ctx.beginPath();
                            this.ctx.arc(
                                x * this.cellSize + this.cellSize/2,
                                y * this.cellSize + this.cellSize/2,
                                5, 0, Math.PI * 2
                            );
                            this.ctx.fill();
                        }
                    }
                }
            }
            
            /**
             * –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç –ü–∞–∫–º–∞–Ω–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π —Ä—Ç–∞
             */
            drawPacman() {
                const centerX = this.pacman.x * this.cellSize + this.cellSize/2;
                const centerY = this.pacman.y * this.cellSize + this.cellSize/2;
                const radius = this.cellSize/2 - 2;
                
                this.ctx.fillStyle = 'yellow';
                this.ctx.beginPath();
                
                // –ê–Ω–∏–º–∞—Ü–∏—è —Ä—Ç–∞
                let startAngle, endAngle;
                
                switch(this.pacman.direction) {
                    case 'right':
                        startAngle = this.pacman.mouthAngle * Math.PI;
                        endAngle = (2 - this.pacman.mouthAngle) * Math.PI;
                        break;
                    case 'left':
                        startAngle = (1 + this.pacman.mouthAngle) * Math.PI;
                        endAngle = (3 - this.pacman.mouthAngle) * Math.PI;
                        break;
                    case 'up':
                        startAngle = (1.5 + this.pacman.mouthAngle) * Math.PI;
                        endAngle = (1.5 - this.pacman.mouthAngle) * Math.PI + 2 * Math.PI;
                        break;
                    case 'down':
                        startAngle = (0.5 + this.pacman.mouthAngle) * Math.PI;
                        endAngle = (0.5 - this.pacman.mouthAngle) * Math.PI;
                        break;
                    default:
                        startAngle = 0;
                        endAngle = 2 * Math.PI;
                }
                
                this.ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                this.ctx.lineTo(centerX, centerY);
                this.ctx.fill();
            }
            
            /**
             * –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–µ —Å —Ç–µ–∫—É—â–∏–º —Ü–≤–µ—Ç–æ–º
             */
            drawGhost() {
                this.drawGhostFor(this.ghost);
            }
            
            /**
             * –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–µ
             * @param {Object} ghost - –û–±—ä–µ–∫—Ç –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è
             */
            drawGhostFor(ghost) {
                const x = ghost.x * this.cellSize;
                const y = ghost.y * this.cellSize;
                
                // –¢–µ–ª–æ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è
                this.ctx.fillStyle = ghost.color;
                this.ctx.beginPath();
                this.ctx.arc(
                    x + this.cellSize/2, 
                    y + this.cellSize/3, 
                    this.cellSize/2.5, 
                    0, 
                    Math.PI
                );
                this.ctx.lineTo(x + this.cellSize, y + this.cellSize);
                this.ctx.lineTo(x, y + this.cellSize);
                this.ctx.closePath();
                this.ctx.fill();
                
                // –ì–ª–∞–∑–∞
                this.ctx.fillStyle = 'white';
                
                // –õ–µ–≤—ã–π –≥–ª–∞–∑
                this.ctx.beginPath();
                this.ctx.arc(
                    x + this.cellSize/3, 
                    y + this.cellSize/3, 
                    this.cellSize/5, 
                    0, 
                    Math.PI * 2
                );
                this.ctx.fill();
                
                // –ü—Ä–∞–≤—ã–π –≥–ª–∞–∑
                this.ctx.beginPath();
                this.ctx.arc(
                    x + 2 * this.cellSize/3, 
                    y + this.cellSize/3, 
                    this.cellSize/5, 
                    0, 
                    Math.PI * 2
                );
                this.ctx.fill();
                
                // –ó—Ä–∞—á–∫–∏ (–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∑–≥–ª—è–¥–∞)
                this.ctx.fillStyle = 'blue';
                const pupilOffset = this.cellSize/8;
                let pupilX = 0, pupilY = 0;
                
                switch(ghost.direction) {
                    case 'up':
                        pupilY = -pupilOffset;
                        break;
                    case 'down':
                        pupilY = pupilOffset;
                        break;
                    case 'left':
                        pupilX = -pupilOffset;
                        break;
                    case 'right':
                        pupilX = pupilOffset;
                        break;
                }
                
                // –õ–µ–≤—ã–π –∑—Ä–∞—á–æ–∫
                this.ctx.beginPath();
                this.ctx.arc(
                    x + this.cellSize/3 + pupilX, 
                    y + this.cellSize/3 + pupilY, 
                    this.cellSize/10, 
                    0, 
                    Math.PI * 2
                );
                this.ctx.fill();
                
                // –ü—Ä–∞–≤—ã–π –∑—Ä–∞—á–æ–∫
                this.ctx.beginPath();
                this.ctx.arc(
                    x + 2 * this.cellSize/3 + pupilX, 
                    y + this.cellSize/3 + pupilY, 
                    this.cellSize/10, 
                    0, 
                    Math.PI * 2
                );
                this.ctx.fill();
            }
            
            /**
             * –û–±–Ω–æ–≤–ª—è–µ—Ç –º–∏–Ω–∏-–∫–∞—Ä—Ç—É –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É
             */
            updateMiniMap() {
                const mapWidth = this.currentMap[0].length;
                const mapHeight = this.currentMap.length;
                
                // –í—ã—á–∏—Å–ª—è–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —è—á–µ–π–∫–∏ –¥–ª—è –º–∏–Ω–∏-–∫–∞—Ä—Ç—ã
                const cellSize = Math.min(
                    this.miniMapCanvas.width / mapWidth,
                    this.miniMapCanvas.height / mapHeight
                );
                
                // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –º–∏–Ω–∏-–∫–∞—Ä—Ç—É
                const offsetX = (this.miniMapCanvas.width - mapWidth * cellSize) / 2;
                const offsetY = (this.miniMapCanvas.height - mapHeight * cellSize) / 2;
                
                // –û—á–∏—Å—Ç–∫–∞ –º–∏–Ω–∏-–∫–∞—Ä—Ç—ã
                this.miniMapCtx.fillStyle = 'black';
                this.miniMapCtx.fillRect(0, 0, this.miniMapCanvas.width, this.miniMapCanvas.height);
                
                // –†–∏—Å—É–µ–º –∫–∞—Ä—Ç—É
                for (let y = 0; y < mapHeight; y++) {
                    for (let x = 0; x < mapWidth; x++) {
                        const cell = this.currentMap[y][x];
                        
                        if (cell === 0) {
                            this.miniMapCtx.fillStyle = 'blue';
                        } else if (cell === 2 || cell === 3) {
                            this.miniMapCtx.fillStyle = cell === 2 ? 'white' : '#FFD700';
                        } else {
                            continue; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏
                        }
                        
                        this.miniMapCtx.fillRect(
                            offsetX + x * cellSize, 
                            offsetY + y * cellSize, 
                            cellSize - 0.5, 
                            cellSize - 0.5
                        );
                    }
                }
                
                // –ü–æ–∑–∏—Ü–∏—è –ü–∞–∫–º–∞–Ω–∞
                this.miniMapCtx.fillStyle = 'yellow';
                this.miniMapCtx.beginPath();
                this.miniMapCtx.arc(
                    offsetX + this.pacman.x * cellSize + cellSize/2,
                    offsetY + this.pacman.y * cellSize + cellSize/2,
                    cellSize/2.5,
                    0,
                    Math.PI * 2
                );
                this.miniMapCtx.fill();
                
                // –ü–æ–∑–∏—Ü–∏—è –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è
                this.miniMapCtx.fillStyle = this.ghost.color;
                this.miniMapCtx.beginPath();
                this.miniMapCtx.arc(
                    offsetX + this.ghost.x * cellSize + cellSize/2,
                    offsetY + this.ghost.y * cellSize + cellSize/2,
                    cellSize/2.5,
                    0,
                    Math.PI * 2
                );
                this.miniMapCtx.fill();
                
                // –ü–æ–∑–∏—Ü–∏–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–π
                if (this.ghosts) {
                    this.ghosts.forEach(ghost => {
                        this.miniMapCtx.fillStyle = ghost.color;
                        this.miniMapCtx.beginPath();
                        this.miniMapCtx.arc(
                            offsetX + ghost.x * cellSize + cellSize/2,
                            offsetY + ghost.y * cellSize + cellSize/2,
                            cellSize/2.5,
                            0,
                            Math.PI * 2
                        );
                        this.miniMapCtx.fill();
                    });
                }
            }
            
            /**
             * –ó–∞–≥—Ä—É–∂–∞–µ—Ç —É—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
             * @returns {Array} –ú–∞—Å—Å–∏–≤ —É—Ä–æ–∫–æ–≤
             */
            loadLessons() {
                return [
                    {
                        id: 1,
                        title: "–ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª",
                        description: "–£–∑–Ω–∞–π—Ç–µ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª –∏ –ø–æ—á–µ–º—É –æ–Ω –≤–∞–∂–µ–Ω –¥–ª—è 2D-–∏–≥—Ä.",
                        steps: [
                            {
                                highlight: "gameLoop",
                                explanation: "–ú–µ—Ç–æ–¥ gameLoop - —Å–µ—Ä–¥—Ü–µ –ª—é–±–æ–π –∏–≥—Ä—ã. –û–Ω –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã.",
                                codeSnippet: `startGameLoop() {
    if (!this.isRunning) return;
    
    const gameLoop = (timestamp) => {
        // –í—ã—á–∏—Å–ª—è–µ–º deltaTime –¥–ª—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —á–∞—Å—Ç–æ—Ç—ã –∫–∞–¥—Ä–æ–≤
        const deltaTime = timestamp - this.lastTimestamp;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–≥—Ä—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏
        if (deltaTime >= this.gameSpeed) {
            this.update();
            this.lastTimestamp = timestamp;
        }
        
        this.draw();
        this.animationFrameId = requestAnimationFrame(gameLoop);
    };
    
    this.animationFrameId = requestAnimationFrame(gameLoop);
}`
                            },
                            {
                                highlight: "update()",
                                explanation: "–ú–µ—Ç–æ–¥ update() –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª–æ–≥–∏–∫—É –∏–≥—Ä—ã: –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤, –ø—Ä–æ–≤–µ—Ä–∫—É –∫–æ–ª–ª–∏–∑–∏–π –∏ —Ç.–¥.",
                                codeSnippet: `update() {
    this.movePacman();
    this.moveGhost();
    this.checkCollisions();
    this.checkLevelCompletion();
}`
                            },
                            {
                                highlight: "draw()",
                                explanation: "–ú–µ—Ç–æ–¥ draw() –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫—É –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ —ç–∫—Ä–∞–Ω–µ.",
                                codeSnippet: `draw() {
    // –û—á–∏—Å—Ç–∫–∞ —Ö–æ–ª—Å—Ç–∞
    this.ctx.fillStyle = 'black';
    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
    
    // –†–∏—Å—É–µ–º –∫–∞—Ä—Ç—É
    this.drawMap();
    
    // –†–∏—Å—É–µ–º –ü–∞–∫–º–∞–Ω–∞
    this.drawPacman();
    
    // –†–∏—Å—É–µ–º –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–µ
    this.drawGhost();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –º–∏–Ω–∏-–∫–∞—Ä—Ç—É
    this.updateMiniMap();
}`
                            }
                        ]
                    },
                    {
                        id: 2,
                        title: "–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞",
                        description: "–ò–∑—É—á–∏—Ç–µ, –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥ –≤ –∏–≥—Ä–∞—Ö –Ω–∞ JavaScript.",
                        steps: [
                            {
                                highlight: "handleKey",
                                explanation: "–ú–µ—Ç–æ–¥ handleKey –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ü–∞–∫–º–∞–Ω–æ–º.",
                                codeSnippet: `handleKey(e) {
    if (!this.isRunning) return;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
    switch(e.key) {
        case 'ArrowUp':
            this.pacman.nextDirection = 'up';
            e.preventDefault();
            break;
        case 'ArrowDown':
            this.pacman.nextDirection = 'down';
            e.preventDefault();
            break;
        case 'ArrowLeft':
            this.pacman.nextDirection = 'left';
            e.preventDefault();
            break;
        case 'ArrowRight':
            this.pacman.nextDirection = 'right';
            e.preventDefault();
            break;
    }
}`
                            },
                            {
                                highlight: "movePacman",
                                explanation: "–ú–µ—Ç–æ–¥ movePacman –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –ü–∞–∫–º–∞–Ω–∞.",
                                codeSnippet: `movePacman() {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    if (this.pacman.nextDirection) {
        const nextPos = this.getFuturePosition(this.pacman.x, this.pacman.y, this.pacman.nextDirection);
        if (this.isValidMove(nextPos.x, nextPos.y)) {
            this.pacman.direction = this.pacman.nextDirection;
            this.pacman.nextDirection = null;
        }
    }
    
    // –î–≤–∏–∂–µ–Ω–∏–µ –≤ —Ç–µ–∫—É—â–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
    const nextPos = this.getFuturePosition(this.pacman.x, this.pacman.y, this.pacman.direction);
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ—Ä—Ç–∞–ª—ã (–≤—ã—Ö–æ–¥ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ä—Ç—ã)
    if (nextPos.x < 0 || nextPos.x >= this.currentMap[0].length) {
        this.pacman.x = (nextPos.x + this.currentMap[0].length) % this.currentMap[0].length;
        return;
    }
    
    if (this.isValidMove(nextPos.x, nextPos.y)) {
        this.pacman.x = nextPos.x;
        this.pacman.y = nextPos.y;
    }
}`
                            }
                        ]
                    },
                    {
                        id: 3,
                        title: "–ò–ò –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è",
                        description: "–ò–∑—É—á–∏—Ç–µ, –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π, –Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –¥–ª—è –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–π.",
                        steps: [
                            {
                                highlight: "updateGhostMode",
                                explanation: "–ú–µ—Ç–æ–¥ updateGhostMode –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –¥–æ –ü–∞–∫–º–∞–Ω–∞.",
                                codeSnippet: `updateGhostMode() {
    const dx = this.pacman.x - this.ghost.x;
    const dy = this.pacman.y - this.ghost.y;
    const distance = Math.sqrt(dx * dx + dy * dy);
    
    // –†–µ–∂–∏–º —Å—É–ø–µ—Ä-–µ–¥—ã –∞–∫—Ç–∏–≤–µ–Ω
    if (this.powerMode) {
        this.ghost.mode = 'fleeing';
        this.ghost.color = 'blue';
    } 
    // –ë–ª–∏–∑–∫–æ –∫ –ü–∞–∫–º–∞–Ω—É
    else if (distance < 5) {
        this.ghost.mode = 'chasing';
        this.ghost.color = 'red';
    } 
    // –î–∞–ª–µ–∫–æ –æ—Ç –ü–∞–∫–º–∞–Ω–∞
    else {
        this.ghost.mode = 'wandering';
        this.ghost.color = 'pink';
    }
}`
                            },
                            {
                                highlight: "findPathToTarget",
                                explanation: "–ú–µ—Ç–æ–¥ findPathToTarget –Ω–∞—Ö–æ–¥–∏—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∫ —Ü–µ–ª–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–æ—Å—Ç–æ–≥–æ —ç–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞.",
                                codeSnippet: `findPathToTarget(targetX, targetY) {
    const directions = ['up', 'down', 'left', 'right'];
    let bestDirection = null;
    let minDistance = Infinity;
    
    for (const direction of directions) {
        const nextPos = this.getFuturePosition(this.ghost.x, this.ghost.y, direction);
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ö–æ–¥–∞
        if (!this.isValidMove(nextPos.x, nextPos.y, 'ghost') || 
            direction === this.getOppositeDirection(this.ghost.direction)) {
            continue;
        }
        
        // –†–∞—Å—á–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –¥–æ —Ü–µ–ª–∏
        const dx = targetX - nextPos.x;
        const dy = targetY - nextPos.y;
        const distance = dx * dx + dy * dy; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–≤–∞–¥—Ä–∞—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
        
        if (distance < minDistance) {
            minDistance = distance;
            bestDirection = direction;
        }
    }
    
    // –ï—Å–ª–∏ –Ω–µ—Ç –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π, –æ—Å—Ç–∞–µ–º—Å—è –Ω–∞ –º–µ—Å—Ç–µ
    return bestDirection || this.ghost.direction;
}`
                            }
                        ]
                    }
                ];
            }
            
            /**
             * –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —É—á–µ–±–Ω—ã–π —É—Ä–æ–∫
             * @param {number} lessonId - ID —É—Ä–æ–∫–∞
             */
            openLesson(lessonId) {
                this.currentLesson = this.lessons.find(lesson => lesson.id === lessonId);
                this.currentLessonStep = 0;
                this.showLessonStep();
                
                // –ü—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–≥—Ä—É –≤–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è
                this.wasRunning = this.isRunning;
                this.pauseGame();
                
                document.getElementById('lesson-panel').style.display = 'flex';
            }
            
            /**
             * –ó–∞–∫—Ä—ã–≤–∞–µ—Ç —É—á–µ–±–Ω—ã–π —É—Ä–æ–∫
             */
            closeLesson() {
                document.getElementById('lesson-panel').style.display = 'none';
                
                // –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º –∏–≥—Ä—É, –µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞ –∑–∞–ø—É—â–µ–Ω–∞
                if (this.wasRunning) {
                    this.resumeGame();
                }
            }
            
            /**
             * –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —à–∞–≥ —É—Ä–æ–∫–∞
             */
            showLessonStep() {
                const lesson = this.currentLesson;
                const step = lesson.steps[this.currentLessonStep];
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
                document.getElementById('lesson-title').textContent = `${lesson.title} (–®–∞–≥ ${this.currentLessonStep + 1}/${lesson.steps.length})`;
                
                // –û—á–∏—â–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                const content = document.getElementById('lesson-content');
                content.innerHTML = '';
                
                // –î–æ–±–∞–≤–ª—è–µ–º —à–∞–≥
                const stepElement = document.createElement('div');
                stepElement.className = 'lesson-step';
                
                stepElement.innerHTML = `
                    <h4>${step.highlight}</h4>
                    <p>${step.explanation}</p>
                    <div class="code-block">${this.escapeHtml(step.codeSnippet)}</div>
                `;
                
                content.appendChild(stepElement);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
                document.getElementById('lesson-prev').disabled = this.currentLessonStep === 0;
                document.getElementById('lesson-next').disabled = this.currentLessonStep === lesson.steps.length - 1;
            }
            
            /**
             * –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —à–∞–≥—É —É—Ä–æ–∫–∞
             */
            previousLessonStep() {
                if (this.currentLessonStep > 0) {
                    this.currentLessonStep--;
                    this.showLessonStep();
                }
            }
            
            /**
             * –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É —É—Ä–æ–∫–∞
             */
            nextLessonStep() {
                if (this.currentLessonStep < this.currentLesson.steps.length - 1) {
                    this.currentLessonStep++;
                    this.showLessonStep();
                } else {
                    this.closeLesson();
                }
            }
            
            /**
             * –≠–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç HTML –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∫–æ–¥-–±–ª–æ–∫–µ
             * @param {string} unsafe - –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
             * @returns {string} –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
             */
            escapeHtml(unsafe) {
                return unsafe
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "<")
                    .replace(/>/g, ">")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            }
            
            /**
             * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
             * @returns {Array} –ú–∞—Å—Å–∏–≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
             */
            loadAchievements() {
                return [
                    {
                        id: 'first-food',
                        title: '–ü–µ—Ä–≤–∞—è –µ–¥–∞',
                        description: '–°–æ–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–≤—É—é —Ç–æ—á–∫—É –µ–¥—ã',
                        condition: () => this.score >= 10,
                        earned: false
                    },
                    {
                        id: 'level-completed',
                        title: '–ú–∞—Å—Ç–µ—Ä –ª–∞–±–∏—Ä–∏–Ω—Ç–∞',
                        description: '–ü—Ä–æ–π–¥–∏—Ç–µ –ø–µ—Ä–≤—ã–π —É—Ä–æ–≤–µ–Ω—å',
                        condition: () => this.currentLevel > 1,
                        earned: false
                    },
                    {
                        id: 'power-mode',
                        title: '–°—É–ø–µ—Ä–≥–µ—Ä–æ–π',
                        description: '–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —Ä–µ–∂–∏–º —Å—É–ø–µ—Ä-–µ–¥—ã',
                        condition: () => this.powerMode,
                        earned: false
                    },
                    {
                        id: 'code-modified',
                        title: '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫',
                        description: '–ò–∑–º–µ–Ω–∏—Ç–µ –∏–≥—Ä–æ–≤–æ–π –∫–æ–¥ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞',
                        condition: () => this.codeModified,
                        earned: false
                    },
                    {
                        id: 'ghost-destroyed',
                        title: '–û—Ö–æ—Ç–Ω–∏–∫',
                        description: '–£–Ω–∏—á—Ç–æ–∂—å—Ç–µ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º–µ —Å—É–ø–µ—Ä-–µ–¥—ã',
                        condition: () => this.score >= 210,
                        earned: false
                    },
                    {
                        id: 'five-levels',
                        title: '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª',
                        description: '–ü—Ä–æ–π–¥–∏—Ç–µ 5 —É—Ä–æ–≤–Ω–µ–π –ø–æ–¥—Ä—è–¥',
                        condition: () => this.currentLevel > 5,
                        earned: false
                    }
                ];
            }
            
            /**
             * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º—É –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
             */
            initAchievements() {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
                const savedAchievements = JSON.parse(localStorage.getItem('pacmanAchievements') || '[]');
                
                this.achievements.forEach(achievement => {
                    const saved = savedAchievements.find(a => a.id === achievement.id);
                    if (saved) {
                        achievement.earned = saved.earned;
                    }
                });
            }
            
            /**
             * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
             */
            checkAchievements() {
                let newAchievements = 0;
                
                this.achievements.forEach(achievement => {
                    if (!achievement.earned && achievement.condition()) {
                        achievement.earned = true;
                        newAchievements++;
                        this.showAchievement(achievement);
                    }
                });
                
                if (newAchievements > 0) {
                    this.saveAchievements();
                    this.renderAchievements();
                }
            }
            
            /**
             * –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
             * @param {Object} achievement - –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
             */
            showAchievement(achievement) {
                const notification = document.getElementById('notification');
                notification.textContent = `–ù–æ–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: ${achievement.title} - ${achievement.description}`;
                notification.className = 'notification';
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            /**
             * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –≤ localStorage
             */
            saveAchievements() {
                const earnedAchievements = this.achievements.map(a => ({
                    id: a.id,
                    earned: a.earned
                }));
                
                localStorage.setItem('pacmanAchievements', JSON.stringify(earnedAchievements));
            }
            
            /**
             * –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –≤ –ø–∞–Ω–µ–ª–∏
             */
            renderAchievements() {
                const achievementsList = document.getElementById('achievements-list');
                achievementsList.innerHTML = '';
                
                this.achievements.forEach(achievement => {
                    const item = document.createElement('div');
                    item.className = 'achievement-item';
                    
                    const statusClass = achievement.earned ? 'achievement-earned' : 'achievement-locked';
                    const statusText = achievement.earned ? '–ü–æ–ª—É—á–µ–Ω–æ' : '–ù–µ –ø–æ–ª—É—á–µ–Ω–æ';
                    const icon = achievement.earned ? 'üèÜ' : 'üî≤';
                    
                    item.innerHTML = `
                        <div class="achievement-title ${statusClass}">
                            ${icon} ${achievement.title} <span>(${statusText})</span>
                        </div>
                        <div class="achievement-description">${achievement.description}</div>
                    `;
                    
                    achievementsList.appendChild(item);
                });
            }
            
            /**
             * –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
             */
            toggleAchievementsPanel() {
                const panel = document.getElementById('achievements-panel');
                panel.classList.toggle('open');
            }
            
            /**
             * –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
             */
            closeAchievementsPanel() {
                document.getElementById('achievements-panel').classList.remove('open');
            }
            
            /**
             * –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–µ—Å—Ç—ã
             * @returns {Array} –ú–∞—Å—Å–∏–≤ —Ç–µ—Å—Ç–æ–≤
             */
            loadTests() {
                return [
                    {
                        id: 'game-loop',
                        title: '–ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª',
                        questions: [
                            {
                                question: '–ö–∞–∫–æ–π –º–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã?',
                                options: [
                                    'update()',
                                    'draw()',
                                    'gameLoop()',
                                    'startGameLoop()'
                                ],
                                correctAnswer: 2,
                                explanation: '–ú–µ—Ç–æ–¥ gameLoop() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —á–µ—Ä–µ–∑ requestAnimationFrame –∏ —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–æ–π –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞.'
                            },
                            {
                                question: '–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –º–µ—Ç–æ–¥ update()?',
                                options: [
                                    '–û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç –∏–≥—Ä—É',
                                    '–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª–æ–≥–∏–∫—É –∏–≥—Ä—ã',
                                    '–£–ø—Ä–∞–≤–ª—è–µ—Ç –∑–≤—É–∫–æ–º',
                                    '–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'
                                ],
                                correctAnswer: 1,
                                explanation: '–ú–µ—Ç–æ–¥ update() –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –∏–≥—Ä–æ–≤–æ–π –ª–æ–≥–∏–∫–∏: –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤, –ø—Ä–æ–≤–µ—Ä–∫—É –∫–æ–ª–ª–∏–∑–∏–π –∏ —Ç.–¥.'
                            },
                            {
                                question: '–ö–∞–∫–æ–π –º–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∏–≥—Ä—ã?',
                                options: [
                                    'update()',
                                    'draw()',
                                    'gameLoop()',
                                    'render()'
                                ],
                                correctAnswer: 1,
                                explanation: '–ú–µ—Ç–æ–¥ draw() –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫—É –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ —ç–∫—Ä–∞–Ω–µ.'
                            }
                        ]
                    },
                    {
                        id: 'input-handling',
                        title: '–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞',
                        questions: [
                            {
                                question: '–ö–∞–∫–æ–π –º–µ—Ç–æ–¥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à?',
                                options: [
                                    'handleInput()',
                                    'handleKey()',
                                    'processInput()',
                                    'processKey()'
                                ],
                                correctAnswer: 1,
                                explanation: '–ú–µ—Ç–æ–¥ handleKey() –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ü–∞–∫–º–∞–Ω–æ–º.'
                            },
                            {
                                question: '–ö–∞–∫–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ü–∞–∫–º–∞–Ω–∞?',
                                options: [
                                    'direction',
                                    'nextDirection',
                                    'targetDirection',
                                    'moveDirection'
                                ],
                                correctAnswer: 1,
                                explanation: '–°–≤–æ–π—Å—Ç–≤–æ nextDirection –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ü–∞–∫–º–∞–Ω–∞.'
                            }
                        ]
                    }
                ];
            }
            
            /**
             * –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç
             * @param {number} testId - ID —Ç–µ—Å—Ç–∞
             */
            startTest(testId) {
                this.currentTest = this.tests.find(test => test.id === testId);
                this.currentQuestion = 0;
                this.testScore = 0;
                
                const testPanel = document.getElementById('test-panel');
                testPanel.style.display = 'block';
                
                this.showTestQuestion();
            }
            
            /**
             * –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å —Ç–µ—Å—Ç–∞
             */
            showTestQuestion() {
                const question = this.currentTest.questions[this.currentQuestion];
                const testPanel = document.getElementById('test-panel');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
                document.getElementById('test-title').textContent = this.currentTest.title;
                document.getElementById('test-question-count').textContent = 
                    `–í–æ–ø—Ä–æ—Å ${this.currentQuestion + 1} –∏–∑ ${this.currentTest.questions.length}`;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤–æ–ø—Ä–æ—Å
                document.getElementById('test-question').textContent = question.question;
                
                // –û—á–∏—â–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
                const optionsContainer = document.getElementById('test-options');
                optionsContainer.innerHTML = '';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
                question.options.forEach((option, index) => {
                    const optionElement = document.createElement('button');
                    optionElement.className = 'test-option';
                    optionElement.dataset.index = index;
                    optionElement.textContent = option;
                    optionsContainer.appendChild(optionElement);
                });
                
                // –°–∫—Ä—ã–≤–∞–µ–º –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å
                document.getElementById('test-feedback').style.display = 'none';
            }
            
            /**
             * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å
             * @param {number} selectedIndex - –ò–Ω–¥–µ–∫—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
             */
            checkAnswer(selectedIndex) {
                const question = this.currentTest.questions[this.currentQuestion];
                const isCorrect = selectedIndex === question.correctAnswer;
                const feedback = document.getElementById('test-feedback');
                
                if (isCorrect) {
                    this.testScore++;
                    feedback.className = 'feedback success';
                    feedback.textContent = `–ü—Ä–∞–≤–∏–ª—å–Ω–æ! ${question.explanation}`;
                } else {
                    feedback.className = 'feedback error';
                    feedback.textContent = `–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. ${question.explanation}`;
                }
                
                feedback.style.display = 'block';
                
                // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É –∏–ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞
                setTimeout(() => {
                    this.currentQuestion++;
                    if (this.currentQuestion < this.currentTest.questions.length) {
                        this.showTestQuestion();
                    } else {
                        this.showTestResults();
                    }
                }, 2000);
            }
            
            /**
             * –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞
             */
            showTestResults() {
                const testPanel = document.getElementById('test-panel');
                const score = Math.round((this.testScore / this.currentTest.questions.length) * 100);
                
                testPanel.innerHTML = `
                    <h3>${this.currentTest.title}</h3>
                    <div class="test-results">
                        <div class="test-score">${score}%</div>
                        <p>–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${this.testScore} –∏–∑ ${this.currentTest.questions.length}</p>
                        <button id="test-retry" class="lesson-nav-btn" style="margin-top: 20px;">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                    </div>
                `;
                
                document.getElementById('test-retry').addEventListener('click', () => {
                    this.startTest(this.currentTest.id);
                });
            }
            
            /**
             * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –∏–≥—Ä—ã
             */
            saveProgress() {
                const progress = {
                    version: '1.1',
                    highScore: this.highScore,
                    currentLevel: this.currentLevel,
                    unlockedLevels: Math.min(this.levels.length, this.currentLevel),
                    achievements: this.achievements.filter(a => a.earned).map(a => a.id),
                    settings: {
                        soundEnabled: this.isSoundEnabled,
                        learningMode: this.isLearningMode,
                        theme: this.isDarkTheme ? 'dark' : 'light'
                    }
                };
                
                localStorage.setItem('pacmanProgress', JSON.stringify(progress));
                this.showNotification('–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
            }
            
            /**
             * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –∏–≥—Ä—ã
             * @returns {boolean} –£—Å–ø–µ—à–Ω–æ –ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
             */
            loadProgress() {
                const saved = localStorage.getItem('pacmanProgress');
                if (saved) {
                    try {
                        const progress = JSON.parse(saved);
                        
                        if (progress.version === '1.1') {
                            this.highScore = progress.highScore;
                            this.currentLevel = Math.min(progress.currentLevel, this.levels.length);
                            
                            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
                            progress.achievements.forEach(id => {
                                const achievement = this.achievements.find(a => a.id === id);
                                if (achievement) achievement.earned = true;
                            });
                            
                            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                            if (progress.settings) {
                                this.isSoundEnabled = progress.settings.soundEnabled;
                                this.isLearningMode = progress.settings.learningMode;
                                
                                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç–µ–º—É, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                                if (progress.settings.theme !== (this.isDarkTheme ? 'dark' : 'light')) {
                                    this.toggleTheme();
                                }
                            }
                            
                            this.updateUI();
                            return true;
                        }
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:', e);
                    }
                }
                return false;
            }
            
            /**
             * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
             * @param {string} message - –¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
             * @param {string} [type='success'] - –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (success, error)
             */
            showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = 'notification';
                notification.classList.add('show');
                
                if (type === 'error') {
                    notification.classList.add('error');
                }
                
                setTimeout(() => {
                    notification.classList.remove('show');
                    notification.classList.remove('error');
                }, 3000);
            }
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = () => {
            try {
                new PacmanGame();
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã:", error);
                alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∏–≥—Ä—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.");
            }
        };
    </script>
</body>
</html>