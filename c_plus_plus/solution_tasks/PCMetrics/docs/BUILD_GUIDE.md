# Руководство по сборке и запуску PCMetrics

## Содержание
1. [Требования к системе](#требования-к-системе)
2. [Структура проекта](#структура-проекта)
3. [Сборка с использованием CMake (рекомендуется)](#сборка-с-использованием-cmake-рекомендуется)
4. [Ручная сборка с помощью компилятора](#ручная-сборка-с-помощью-компилятора)
5. [Запуск приложения](#запуск-приложения)
6. [Запуск тестов](#запуск-тестов)
7. [Устранение неполадок](#устранение-неполадок)

## Требования к системе

- **Операционная система**: Windows 7 или выше (64-bit)
- **Компилятор**: MinGW-w64 или Visual Studio с поддержкой C++11
- **Система сборки**: CMake 3.10 или выше
- **Библиотеки**: 
  - Windows PDH (Performance Data Helper) - входит в состав Windows
  - Опционально: NVIDIA NVML, AMD ADL, Intel GPA (для мониторинга GPU)

## Структура проекта

```
PCMetrics/
├── include/              # Заголовочные файлы (.h)
├── src/                  # Исходные файлы (.cpp)
├── libs/                 # Внешние библиотеки (NVML, ADL, Intel GPA)
├── tests/                # Тестовые файлы
├── docs/                 # Документация
├── CMakeLists.txt        # Конфигурация сборки CMake
├── BUILD_GUIDE.md        # Этот файл
├── README.md             # Основная документация
└── .gitignore            # Файлы игнорируемые Git
```

## Сборка с использованием CMake (рекомендуется)

### Шаг 1: Подготовка среды сборки

1. Откройте командную строку или PowerShell
2. Перейдите в корневую директорию проекта:
   ```cmd
   cd путь\к\PCMetrics
   ```

### Шаг 2: Создание директории сборки

```cmd
mkdir build
cd build
```

### Шаг 3: Генерация файлов сборки

Для MinGW:
```cmd
cmake .. -G "MinGW Makefiles"
```

Для Visual Studio (если установлен):
```cmd
cmake .. -G "Visual Studio 16 2019"
```

### Шаг 4: Компиляция проекта

```cmd
cmake --build .
```

После успешной сборки вы найдете исполняемые файлы:
- `pcmetrics.exe` - основное приложение
- `pcmetrics_test.exe` - тестовое приложение (в подкаталоге bin/)

## Ручная сборка с помощью компилятора

Если вы предпочитаете собирать проект вручную без CMake:

### С использованием g++ (MinGW)

```cmd
g++ -I include src/main.cpp src/cpu_monitor.cpp src/disk_monitor.cpp src/gpu_monitor.cpp src/logger.cpp src/memory_monitor.cpp src/metrics_exporter.cpp -o pcmetrics.exe -lpdh -std=c++11
```

### С использованием Visual Studio Compiler

```cmd
cl /I include src/main.cpp src/cpu_monitor.cpp src/disk_monitor.cpp src/gpu_monitor.cpp src/logger.cpp src/memory_monitor.cpp src/metrics_exporter.cpp pdh.lib /std:c++11 /out:pcmetrics.exe
```

## Запуск приложения

### Из директории сборки (CMake)

```cmd
# Для запуска основного приложения
./pcmetrics.exe

# Или если вы используете Windows Command Prompt
pcmetrics.exe
```

### Из корневой директории проекта (ручная сборка)

```cmd
# Для запуска основного приложения
./pcmetrics.exe
```

### Возможные параметры запуска

Приложение не требует специальных параметров запуска. Все настройки задаются внутри программы во время выполнения.

## Запуск тестов

### Из директории сборки (CMake)

```cmd
./bin/pcmetrics_test.exe
```

Тесты проверяют:
- Работу системы логирования
- Корректность получения информации о памяти
- Общую функциональность мониторинга

## Устранение неполадок

### Проблемы с компиляцией

1. **Ошибка "undefined reference"**
   - Причина: Не все файлы .cpp были включены в команду компиляции
   - Решение: Убедитесь, что все .cpp файлы из директории src включены в команду компиляции

2. **Ошибка "pdh.h: No such file or directory"**
   - Причина: Отсутствуют заголовочные файлы Windows PDH
   - Решение: Убедитесь, что у вас установлена Windows SDK

3. **Ошибка линковки с библиотекой pdh**
   - Причина: Компилятор не может найти библиотеку pdh.lib
   - Решение: Убедитесь, что указали ключ -lpdh в команде компиляции

### Проблемы с выполнением

1. **Ошибки PDH при запуске**
   - Причина: Проблемы с доступом к счетчикам производительности Windows
   - Решение: 
     - Запустите приложение от имени администратора
     - Проверьте, что служба счетчиков производительности Windows запущена
     - Выполните команду: `lodctr /R` от имени администратора

2. **Отсутствие информации о GPU**
   - Причина: Не установлены дополнительные библиотеки GPU
   - Решение: 
     - Поместите соответствующие библиотеки в директории libs/nvml, libs/adl, libs/intel
     - Пересоберите проект с флагами:
       ```cmd
       cmake .. -DENABLE_NVML=ON -DENABLE_ADL=ON -DENABLE_INTEL_GPA=ON
       ```

### Проблемы с CMake

1. **Ошибка "no such file or directory" при запуске cmake**
   - Причина: CMake не может найти компилятор
   - Решение: Убедитесь, что компилятор (gcc/g++ или cl) находится в PATH

2. **Предупреждения о не найденных библиотеках GPU**
   - Причина: Библиотеки не найдены в директориях libs/*
   - Решение: Это нормальное поведение, если вы не планируете использовать мониторинг GPU

## Дополнительная информация

### Сборка с поддержкой GPU

Для включения поддержки мониторинга GPU необходимо:

1. Скачать соответствующие библиотеки:
   - NVIDIA NVML: [Ссылка на скачивание]
   - AMD ADL SDK: [Ссылка на скачивание]
   - Intel GPA: [Ссылка на скачивание]

2. Поместить библиотеки в соответствующие директории:
   - NVML: libs/nvml/
   - ADL: libs/adl/
   - Intel GPA: libs/intel/

3. Пересобрать проект с флагами:
   ```cmd
   cmake .. -DENABLE_NVML=ON -DENABLE_ADL=ON -DENABLE_INTEL_GPA=ON
   cmake --build .
   ```

### Настройка логирования

Логирование настраивается автоматически при запуске приложения. По умолчанию:
- Логи сохраняются в файл `pcmetrics.log`
- Уровень логирования: INFO
- Вывод в консоль: включен

Эти параметры можно изменить в коде в файле `src/main.cpp`.

### Экспорт данных

Приложение поддерживает экспорт данных в форматах:
- CSV (значения разделенные запятыми)
- JSON (JavaScript Object Notation)

Функция экспорта активируется в конце работы программы по запросу пользователя.