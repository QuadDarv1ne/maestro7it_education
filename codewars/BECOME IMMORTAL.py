'''
https://www.codewars.com/kata/59568be9cc15b57637000054/train/python

–ê–≤—Ç–æ—Ä: –î—É–ø–ª–µ–π –ú–∞–∫—Å–∏–º –ò–≥–æ—Ä–µ–≤–∏—á
ORCID: https://orcid.org/0009-0007-7605-539X
GitHub: https://github.com/QuadDarv1ne/
'''

def elder_age(m, n, l, t):
    """–í—ã—á–∏—Å–ª—è–µ—Ç —Å—É–º–º–∞—Ä–Ω—É—é —Å–∏–ª—É –¥—Ä–µ–≤–Ω–µ–≥–æ —Å—É—â–µ—Å—Ç–≤–∞ –Ω–∞ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–π —Å–µ—Ç–∫–µ —Å —É—á—ë—Ç–æ–º –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ –±–∞—Ä—å–µ—Ä–∞.

    –°–∏–ª–∞ –≤ –∫–ª–µ—Ç–∫–µ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ (i, j) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–∞–∫ max(0, (i XOR j) - l).
    –§—É–Ω–∫—Ü–∏—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Ä–∞–∑–±–∏–≤–∞–µ—Ç –æ–±–ª–∞—Å—Ç—å [0, m) √ó [0, n) –Ω–∞ –±–ª–æ–∫–∏, –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω—ã–µ –ø–æ —Å—Ç–µ–ø–µ–Ω—è–º –¥–≤–æ–π–∫–∏,
    –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–æ—Ä–º—É–ª—ã –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—É–º–º—ã –±–µ–∑ –ø–µ—Ä–µ–±–æ—Ä–∞.

    Args:
        m (int): –í—ã—Å–æ—Ç–∞ —Å–µ—Ç–∫–∏ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫).
        n (int): –®–∏—Ä–∏–Ω–∞ —Å–µ—Ç–∫–∏ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–æ–ª–±—Ü–æ–≤).
        l (int): –£—Ä–æ–≤–µ–Ω—å –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ –±–∞—Ä—å–µ—Ä–∞ (–ø–æ—Ä–æ–≥, –Ω–∏–∂–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–∏–ª–∞ –æ–±–Ω—É–ª—è–µ—Ç—Å—è).
        t (int): –ú–æ–¥—É–ª—å, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∏—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

    Returns:
        int: –°—É–º–º–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö —Å–∏–ª –≤—Å–µ—Ö –∫–ª–µ—Ç–æ–∫ –ø–æ –º–æ–¥—É–ª—é `t`.

    Examples:
        >>> elder_age(8, 5, 1, 100)
        5
        >>> elder_age(8, 8, 0, 100007)
        224
        >>> elder_age(545, 435, 342, 1000007)
        808451
        >>> elder_age(28827050410, 35165045587, 7109602, 13719506)
        5456283
    """
    # –ë–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π: –µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –∏–∑ —Å—Ç–æ—Ä–æ–Ω —Ä–∞–≤–Ω–∞ –Ω—É–ª—é ‚Äî –ø–ª–æ—â–∞–¥—å –ø—É—Å—Ç–∞
    if m == 0 or n == 0:
        return 0

    # –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º, —á—Ç–æ m <= n –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ (—Å–∏–º–º–µ—Ç—Ä–∏—è –∑–∞–¥–∞—á–∏)
    if m > n:
        m, n = n, m

    # –ù–∞—Ö–æ–¥–∏–º –Ω–∞–∏–º–µ–Ω—å—à–∏–µ —Å—Ç–µ–ø–µ–Ω–∏ –¥–≤–æ–π–∫–∏, –Ω–µ –º–µ–Ω—å—à–∏–µ m –∏ n
    loss_m, loss_n = power_2(m), power_2(n)

    # –ï—Å–ª–∏ –±–∞—Ä—å–µ—Ä l –ø—Ä–µ–≤—ã—à–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤–æ–∑–º–æ–∂–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ XOR –≤ –æ–±–ª–∞—Å—Ç–∏ ‚Äî —Å–∏–ª–∞ –≤–µ–∑–¥–µ –Ω—É–ª–µ–≤–∞—è
    if l > loss_n:
        return 0

    # –°–ª—É—á–∞–π, –∫–æ–≥–¥–∞ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã –ª–µ–∂–∞—Ç –≤ –æ–¥–Ω–æ–º –±–ª–æ–∫–µ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ (2^k √ó 2^k)
    if loss_m == loss_n:
        # –°—É–º–º–∏—Ä—É–µ–º –≤–∫–ª–∞–¥ –∏–∑ "–≤–Ω–µ—à–Ω–µ–π —Ä–∞–º–∫–∏" –∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Å—Ç–∞—Ç–æ–∫
        return (
            sum_terms_in_range(1, loss_n - l - 1) * (m + n - loss_n)
            + elder_age(loss_n - n, loss_m - m, l, t)
        ) % t

    # –°–ª—É—á–∞–π, –∫–æ–≥–¥–∞ –±–ª–æ–∫–∏ –∏–º–µ—é—Ç —Ä–∞–∑–Ω—ã–π —Ä–∞–∑–º–µ—Ä (loss_m < loss_n)
    if loss_m < loss_n:
        # –í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º loss_m –¥–æ –ø–æ–ª–æ–≤–∏–Ω—ã loss_n (—Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è —Ä–∞–∑–±–∏–µ–Ω–∏—è)
        loss_m = loss_n // 2

        # –û—Å–Ω–æ–≤–Ω–æ–π –≤–∫–ª–∞–¥: —Å—É–º–º–∞ –ø–æ –ø–æ–ª–Ω–æ–º—É –±–ª–æ–∫—É [0, m) √ó [0, loss_n),
        # —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ "–æ–±—Ä–µ–∑–∞–Ω–Ω—ã–π" –ø—Ä–∞–≤—ã–π –∫—Ä–∞–π (loss_n - n)
        aux = (
            sum_terms_in_range(1, loss_n - l - 1) * m
            - (loss_n - n) * sum_terms_in_range(max(0, loss_m - l), loss_n - l - 1)
        )

        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –≤–∫–ª–∞–¥ –∏–∑ —É–≥–ª–æ–≤–æ–≥–æ –ø–æ–¥–±–ª–æ–∫–∞ [loss_m, m) √ó [loss_n, n)
        if l <= loss_m:
            # –ï—Å–ª–∏ –±–∞—Ä—å–µ—Ä –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–¥–±–ª–æ–∫ ‚Äî —É—á–∏—Ç—ã–≤–∞–µ–º –µ–≥–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é
            aux += (
                (loss_m - l) * (loss_m - m) * (loss_n - n)
                + elder_age(loss_m - m, loss_n - n, 0, t)
            )
        else:
            # –ò–Ω–∞—á–µ ‚Äî —Å–¥–≤–∏–≥–∞–µ–º –±–∞—Ä—å–µ—Ä –∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ–¥–±–ª–æ–∫
            aux += elder_age(loss_m - m, loss_n - n, l - loss_m, t)

        return aux % t


def sum_terms_in_range(l, r):
    """–í—ã—á–∏—Å–ª—è–µ—Ç —Å—É–º–º—É —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª –≤ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–∏ –æ—Ç l –¥–æ r –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ.

    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–æ—Ä–º—É–ª–∞: S = (–ø–µ—Ä–≤—ã–π + –ø–æ—Å–ª–µ–¥–Ω–∏–π) * –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ / 2.
    –ï—Å–ª–∏ l > r, —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0 (–ø—É—Å—Ç–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω).
    """
    if l > r:
        return 0
    return (l + r) * (r - l + 1) // 2


def power_2(x):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–∏–º–µ–Ω—å—à—É—é —Å—Ç–µ–ø–µ–Ω—å –¥–≤–æ–π–∫–∏, –∫–æ—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–≥–æ –±–æ–ª—å—à–µ x.

    –ü—Ä–∏–º–µ—Ä—ã:
        power_2(5)  ‚Üí 8   (2^3)
        power_2(8)  ‚Üí 16  (2^4)
        power_2(0)  ‚Üí 1   (2^0)
    """
    time = 1
    while time < x:
        time <<= 1  # —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ time *= 2
    return time

''' –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏: '''
# 1. üí†Telegramüí†‚ùÉ –•–∏–∂–∏–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞ √Ü: https://t.me/hut_programmer_07
# 2. üí†Telegram ‚Ññ1üí† @quadd4rv1n7
# 3. üí†Telegram ‚Ññ2üí† @dupley_maxim_1999
# 4. Rutube –∫–∞–Ω–∞–ª: https://rutube.ru/channel/4218729/
# 5. Plvideo –∫–∞–Ω–∞–ª: https://plvideo.ru/channel/AUPv_p1r5AQJ
# 6. YouTube –∫–∞–Ω–∞–ª: https://www.youtube.com/@it-coders
# 7. –í–ö –≥—Ä—É–ø–ø–∞: https://vk.com/science_geeks