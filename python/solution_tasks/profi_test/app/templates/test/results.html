                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Load rating status
    fetch(`/test/{{ result.id }}/rating_status`)
        .then(response => response.json())
        .then(data => {
            document.getElementById('likeCount').textContent = data.likes;
            document.getElementById('dislikeCount').textContent = data.dislikes;
            
            // Update button states based on current rating
            if (data.current_rating === 'like') {
                document.getElementById('likeBtn').classList.add('active', 'btn-success');
                document.getElementById('likeBtn').classList.remove('btn-outline-success');
            } else if (data.current_rating === 'dislike') {
                document.getElementById('dislikeBtn').classList.add('active', 'btn-danger');
                document.getElementById('dislikeBtn').classList.remove('btn-outline-danger');
            }
        })
        .catch(error => console.error('Error loading rating status:', error));

    // Like button handler
    document.getElementById('likeBtn').addEventListener('click', function() {
        const currentClassList = this.classList;
        const isCurrentlyLiked = currentClassList.contains('active');
        
        fetch(`/rate/test/{{ result.id }}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                rating_type: isCurrentlyLiked ? 'like' : 'like'
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update counts
                document.getElementById('likeCount').textContent = data.likes;
                document.getElementById('dislikeCount').textContent = data.dislikes;
                
                // Update button states
                if (data.action === 'unrated') {
                    // Remove active state
                    this.classList.remove('active', 'btn-success');
                    this.classList.add('btn-outline-success');
                    document.getElementById('dislikeBtn').classList.remove('active', 'btn-danger');
                    document.getElementById('dislikeBtn').classList.add('btn-outline-danger');
                } else if (data.action === 'rated' || data.action === 'changed') {
                    // Set like active, remove dislike active
                    this.classList.add('active', 'btn-success');
                    this.classList.remove('btn-outline-success');
                    document.getElementById('dislikeBtn').classList.remove('active', 'btn-danger');
                    document.getElementById('dislikeBtn').classList.add('btn-outline-danger');
                }
            } else {
                alert('Ошибка: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Произошла ошибка при оценке');
        });
    });

    // Dislike button handler
    document.getElementById('dislikeBtn').addEventListener('click', function() {
        const currentClassList = this.classList;
        const isCurrentlyDisliked = currentClassList.contains('active');
        
        fetch(`/rate/test/{{ result.id }}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                rating_type: isCurrentlyDisliked ? 'dislike' : 'dislike'
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update counts
                document.getElementById('likeCount').textContent = data.likes;
                document.getElementById('dislikeCount').textContent = data.dislikes;
                
                // Update button states
                if (data.action === 'unrated') {
                    // Remove active state
                    this.classList.remove('active', 'btn-danger');
                    this.classList.add('btn-outline-danger');
                    document.getElementById('likeBtn').classList.remove('active', 'btn-success');
                    document.getElementById('likeBtn').classList.add('btn-outline-success');
                } else if (data.action === 'rated' || data.action === 'changed') {
                    // Set dislike active, remove like active
                    this.classList.add('active', 'btn-danger');
                    this.classList.remove('btn-outline-danger');
                    document.getElementById('likeBtn').classList.remove('active', 'btn-success');
                    document.getElementById('likeBtn').classList.add('btn-outline-success');
                }
            } else {
                alert('Ошибка: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Произошла ошибка при оценке');
        });
    });
});
</script>
{% endblock %}