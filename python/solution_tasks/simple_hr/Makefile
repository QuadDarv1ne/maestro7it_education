# Makefile Ð´Ð»Ñ Simple HR

.PHONY: help install test run clean docker-build docker-up docker-down migrate backup

help:
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘          Simple HR - Makefile ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ (v2.4)               â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¸ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ:"
	@echo "  make install       - Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸"
	@echo "  make dev-install   - Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ + dev tools"
	@echo "  make clean         - ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹"
	@echo ""
	@echo "ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ:"
	@echo "  make test          - Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð²ÑÐµ Ñ‚ÐµÑÑ‚Ñ‹"
	@echo "  make test-unit     - Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ unit Ñ‚ÐµÑÑ‚Ñ‹"
	@echo "  make test-api      - Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ API Ñ‚ÐµÑÑ‚Ñ‹"
	@echo "  make coverage      - Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ñ‚ÐµÑÑ‚Ñ‹ Ñ Ð¿Ð¾ÐºÑ€Ñ‹Ñ‚Ð¸ÐµÐ¼"
	@echo ""
	@echo "ðŸŽ¨ ÐšÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ ÐºÐ¾Ð´Ð°:"
	@echo "  make lint          - ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÐºÐ¾Ð´ (ruff)"
	@echo "  make format        - Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð´ (black, isort)"
	@echo "  make type-check    - ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‚Ð¸Ð¿Ð¾Ð² (mypy)"
	@echo "  make quality       - Ð’ÑÐµ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°"
	@echo ""
	@echo "ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ:"
	@echo "  make run           - Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ production"
	@echo "  make dev           - Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð² Ñ€ÐµÐ¶Ð¸Ð¼Ðµ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸"
	@echo ""
	@echo "ðŸ³ Docker:"
	@echo "  make docker-build  - Ð¡Ð¾Ð±Ñ€Ð°Ñ‚ÑŒ Docker Ð¾Ð±Ñ€Ð°Ð·"
	@echo "  make docker-up     - Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹"
	@echo "  make docker-down   - ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹"
	@echo "  make docker-logs   - ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð»Ð¾Ð³Ð¾Ð²"
	@echo ""
	@echo "ðŸ—„ï¸  Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…:"
	@echo "  make migrate       - Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð‘Ð”"
	@echo "  make migrate-init  - Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸"
	@echo "  make migrate-create - Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²ÑƒÑŽ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ"
	@echo "  make backup        - Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ€ÐµÐ·ÐµÑ€Ð²Ð½ÑƒÑŽ ÐºÐ¾Ð¿Ð¸ÑŽ Ð‘Ð”"
	@echo "  make init-db       - Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð‘Ð”"
	@echo "  make seed-db       - Ð—Ð°Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ Ð‘Ð” Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¼Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸"
	@echo ""
	@echo "ðŸ“Š Ð£Ñ‚Ð¸Ð»Ð¸Ñ‚Ñ‹:"
	@echo "  make shell         - Flask shell"
	@echo "  make stats         - Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð‘Ð”"
	@echo "  make create-user   - Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ"
	@echo "  make requirements  - ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ requirements.txt"
	@echo "  make security-check - ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸"

install:
	pip install -r requirements.txt

dev-install:
	pip install -r requirements.txt
	pip install -r requirements-dev.txt

test:
	pytest -v

test-unit:
	pytest -v -m unit

test-api:
	pytest -v -m api

coverage:
	pytest --cov=app --cov-report=html --cov-report=term-missing

lint:
	ruff check app/

format:
	black app/
	isort app/

type-check:
	mypy app/ --ignore-missing-imports

quality: lint type-check

run:
	python run.py

dev:
	set FLASK_ENV=development && python -m flask run --reload

clean:
	find . -type d -name __pycache__ -exec rm -rf {} +
	find . -type f -name "*.pyc" -delete
	find . -type f -name "*.pyo" -delete
	find . -type f -name "*.coverage" -delete
	rm -rf htmlcov/
	rm -rf .pytest_cache/
	rm -rf *.egg-info/
	rm -rf dist/
	rm -rf build/

lint:
	flake8 app --count --select=E9,F63,F7,F82 --show-source --statistics
	flake8 app --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics

format:
	black app/
	isort app/

docker-build:
	docker-compose build

docker-up:
	docker-compose up -d

docker-down:
	docker-compose down

docker-logs:
	docker-compose logs -f

migrate:
	flask db upgrade

migrate-init:
	flask db init

migrate-create:
	flask db migrate -m "$(message)"

backup:
	python -c "from app.utils.backup import backup_database; backup_database()"

init-db:
	flask cli init-db

seed-db:
	flask cli seed-db

create-user:
	flask cli create-user

stats:
	flask cli stats

requirements:
	pip freeze > requirements.txt

security-check:
	safety check
	bandit -r app

shell:
	flask shell
