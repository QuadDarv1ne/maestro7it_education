# Простая система управления HR

Простая система управления `HR`, построенная на `Flask` для управления сотрудниками, отделами, должностями, приказами и отпусками.

## Возможности

- Аутентификация пользователей (**роли admin/hr**)
- Управление сотрудниками (**операции CRUD**)
- Управление отделами и должностями
- Управление приказами (**прием, переводы, увольнения**)
- Отслеживание отпусков с календарем
- Расширенные возможности отчетности
- Функциональность импорта/экспорта `CSV`
- Адаптивный веб-интерфейс
- **Новое:** Миграции базы данных (Flask-Migrate)
- **Новое:** Защита от брутфорса (Rate Limiting)
- **Новое:** Кэширование для производительности
- **Новое:** Безопасные заголовки (CSP, CORS)
- **Новое:** Docker поддержка
- **Новое:** Журнал аудита
- **Новое:** Система уведомлений
- **Новое:** Аналитика и визуализация данных

## Используемые технологии

- **Бэкенд**: Flask (Python)
- **База данных**: MySQL с ORM SQLAlchemy (поддержка SQLite для тестирования)
- **Миграции БД**: Flask-Migrate (Alembic)
- **Фронтенд**: Bootstrap 5, HTML, CSS
- **Аутентификация**: Flask-Login
- **Обработка данных**: pandas, chardet
- **Визуализация данных**: matplotlib, seaborn, plotly
- **Формы**: Flask-WTF, WTForms
- **Безопасность**: Flask-Limiter, Flask-CORS, bcrypt
- **Кэширование**: Flask-Caching
- **Контейнеризация**: Docker, Docker Compose

## Установка

1. Клонируйте репозиторий:

   ```bash
   git clone <repository-url>
   cd simple_hr
   ```

2. Создайте виртуальное окружение:

   ```bash
   python -m venv venv
   source venv/bin/activate  # В Windows: venv\Scripts\activate
   ```

3. **Установите зависимости:**

   ```bash
   pip install -r requirements.txt
   ```

4. **Настройте базу данных:**

   - Создайте базу данных `MySQL`
   - Обновите файл `.env` своими учетными данными базы данных
   - **Запустите SQL-скрипт для создания таблиц:**

     ```bash
     mysql -u username -p database_name < create_simple_hr_db.sql
     ```

5. **Настройте переменные окружения в `.env`:**

   ```bash
   SECRET_KEY=your_secret_key_here
   MYSQL_USER=your_mysql_username
   MYSQL_PASSWORD=your_mysql_password
   MYSQL_HOST=localhost
   MYSQL_DB=simple_hr_db
   ```

6. **Заполните начальные данные:**

   ```bash
   python seed_data.py
   ```

## Запуск приложения

```bash
python run.py
```

Приложение будет доступно по адресу `http://localhost:5000`

### Режимы запуска

**Режим разработки:**
```bash
python run.py
```

**С использованием Flask CLI:**
```bash
export FLASK_APP=run.py
export FLASK_ENV=development
flask run
```

**С Docker:**
```bash
# Быстрый старт
docker-compose up -d

# Просмотр логов
docker-compose logs -f

# Остановка
docker-compose down
```

См. [DOCKER.md](DOCKER.md) для подробной информации о Docker.

## Пользователи по умолчанию

- Администратор: имя пользователя `admin`, пароль `admin`
- HR: имя пользователя `hr`, пароль `hr`

## Структура проекта

```bash
simple_hr/
├── app/
│   ├── routes/          # Обработчики маршрутов
│   ├── templates/       # HTML шаблоны
│   ├── utils/           # Вспомогательные функции
│   ├── __init__.py      # Фабрика приложения
│   └── models.py        # Модели базы данных
├── instance/
│   └── config.py        # Конфигурация
├── .env                 # Переменные окружения
├── create_simple_hr_db.sql  # Схема базы данных
├── requirements.txt     # Зависимости
├── run.py              # Точка входа в приложение
└── seed_data.py        # Начальное заполнение данных
```

## Функциональность

### Управление сотрудниками

- Добавление, редактирование, удаление сотрудников
- Просмотр деталей сотрудника
- Фильтрация сотрудников по отделам

### Управление отделами и должностями

- Управление отделами и должностями
- Предотвращение удаления при использовании

### Приказы

- Создание приказов о приеме, переводах и увольнениях
- Отслеживание перемещений сотрудников

### Отпуска

- Запись отпусков сотрудников
- Отслеживание типов отпусков (оплачиваемый, неоплачиваемый, больничный)
- Календарный вид отпусков
- Проверка на пересечение отпусков

### Отчеты

- Генерация отчетов по сотрудникам
- Экспорт данных в CSV
- Просмотр статистики по отделам
- Отчет по производительности
- Зарплатный отчет
- Аналитика текучести кадров

### Импорт/Экспорт CSV

- Импорт данных сотрудников из CSV файлов
- Экспорт отчетов в формат CSV
- Автоматическое определение кодировки

## Безопасность

### Реализованные меры безопасности

- **Хеширование паролей** - PBKDF2 через Werkzeug
- **CSRF защита** - Flask-WTF
- **Rate Limiting** - защита от брутфорса и DDoS
  - Вход: 5 попыток в минуту
  - Регистрация: 3 попытки в час
- **Безопасные заголовки**
  - X-Content-Type-Options
  - X-Frame-Options
  - X-XSS-Protection
  - Strict-Transport-Security
  - Content-Security-Policy
- **CORS** - настраиваемые origins
- **Валидация паролей** - минимум 6 символов, буквы и цифры
- **Журнал аудита** - логирование всех действий пользователей
- **Токены восстановления пароля** - безопасное восстановление

## API Документация

Полная документация API доступна в файле [API.md](API.md)

## Docker

Приложение полностью поддерживает Docker. См. [DOCKER.md](DOCKER.md) для инструкций.

### Быстрый старт с Docker

```bash
# Скопируйте .env файл
cp .env.example .env

# Запустите контейнеры
docker-compose up -d

# Инициализируйте БД
docker-compose exec web flask db upgrade
docker-compose exec web python seed_data.py
```

## Миграции базы данных

Проект использует Flask-Migrate для управления схемой БД:

```bash
# Инициализация миграций (только первый раз)
flask db init

# Создание новой миграции
flask db migrate -m "Описание изменений"

# Применение миграций
flask db upgrade

# Откат миграции
flask db downgrade
```

## Тестирование

```bash
# Запуск тестов
pytest

# С покрытием кода
pytest --cov=app --cov-report=html

# Просмотр отчёта
open htmlcov/index.html
```

## Production рекомендации

1. **Измените SECRET_KEY** на уникальное значение
2. **Настройте MySQL** вместо SQLite
3. **Используйте HTTPS** с SSL сертификатами
4. **Настройте reverse proxy** (nginx/Apache)
5. **Включите logrotate** для логов
6. **Регулярно создавайте backup** базы данных
7. **Мониторинг** - настройте Sentry или аналог
8. **Настройте firewall** и security groups
9. **Используйте gunicorn/uwsgi** вместо Flask dev server

## Лицензия

Этот проект предназначен для образовательных целей.

---

## Документация

- [API Документация](API.md) - Полное описание всех endpoints
- [Docker Руководство](DOCKER.md) - Использование Docker и Docker Compose
- [CLI Команды](CLI.md) - Управление через командную строку
- [История изменений](CHANGELOG.md) - Список всех изменений

## Полезные ссылки

- [Flask Documentation](https://flask.palletsprojects.com/)
- [SQLAlchemy Documentation](https://www.sqlalchemy.org/)
- [Bootstrap 5](https://getbootstrap.com/)

## Поддержка

По вопросам и предложениям создавайте issue в GitHub репозитории.

**Автор:** Дуплей Максим Игоревич  
**Telegram:** @quadd4rv1n7  
**Email:** maksimqwe42@mail.ru  
**Версия:** 2.0

