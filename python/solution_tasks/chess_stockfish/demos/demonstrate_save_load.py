#!/usr/bin/env python3
"""
–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä—Ç–∏–π –≤ chess_stockfish.
"""

import sys
import os
import time
import json

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –º–æ–¥—É–ª—è–º –∏–≥—Ä—ã
sys.path.append(os.path.join(os.path.dirname(__file__), '..'))

def demonstrate_save_load_functionality():
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä—Ç–∏–π."""
    print("–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä—Ç–∏–π")
    print("=" * 60)
    
    try:
        from game.chess_game import ChessGame
        
        # –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∏–≥—Ä—ã
        print("1. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —à–∞—Ö–º–∞—Ç–Ω–æ–π –ø–∞—Ä—Ç–∏–∏...")
        game = ChessGame()
        print("   ‚úì –ò–≥—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
        print("\n2. –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è:")
        board = game.get_board_state()
        print_board(board)
        
        # –î–µ–ª–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ö–æ–¥–æ–≤ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
        print("\n3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ö–æ–¥–æ–≤...")
        # –ë–µ–ª—ã–µ: e2-e4
        game.engine.make_move("e2e4")
        game.move_history.append("e2e4")
        print("   –•–æ–¥ –±–µ–ª—ã—Ö: e2-e4")
        
        # –ß–µ—Ä–Ω—ã–µ: e7-e5
        game.engine.make_move("e7e5")
        game.move_history.append("e7e5")
        print("   –•–æ–¥ —á–µ—Ä–Ω—ã—Ö: e7-e5")
        
        # –ë–µ–ª—ã–µ: g1-f3
        game.engine.make_move("g1f3")
        game.move_history.append("g1f3")
        print("   –•–æ–¥ –±–µ–ª—ã—Ö: g1-f3 (–ö–æ–Ω—å g1->f3)")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é
        print("\n4. –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è –ø–æ—Å–ª–µ 3 —Ö–æ–¥–æ–≤:")
        board = game.get_board_state()
        print_board(board)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–≥—Ä—É –≤ —Ñ–∞–π–ª
        print("\n5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏–∏ –≤ —Ñ–∞–π–ª...")
        game._save_game_to_file("demo_game.json")
        print("   ‚úì –ü–∞—Ä—Ç–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ —Ñ–∞–π–ª demo_game.json")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–∏–π
        print("\n6. –°–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–∏–π:")
        saved_games = game._list_saved_games()
        if saved_games:
            for filename in saved_games:
                print(f"   - {filename}")
        else:
            print("   –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–∏–π")
        
        # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∏–≥—Ä—É –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é
        print("\n7. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∏–≥—Ä—ã –∏ –∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –ø–∞—Ä—Ç–∏–∏...")
        new_game = ChessGame()
        print("   –ù–æ–≤–∞—è –∏–≥—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞")
        
        # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –ø–∞—Ä—Ç–∏—é
        new_game._load_game_from_file("demo_game.json")
        print("   –ü–∞—Ä—Ç–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ —Ñ–∞–π–ª–∞")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
        print("\n8. –ü–æ–∑–∏—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –ø–∞—Ä—Ç–∏–∏:")
        loaded_board = new_game.get_board_state()
        print_board(loaded_board)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–∑–∏—Ü–∏–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç
        if board == loaded_board:
            print("\n9. ‚úì –ü—Ä–æ–≤–µ—Ä–∫–∞: –ø–æ–∑–∏—Ü–∏–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏")
        else:
            print("\n9. ‚úó –ü—Ä–æ–≤–µ—Ä–∫–∞: –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏")
        
        print("\n" + "=" * 60)
        print("–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!")
        print("\n–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:")
        print("  üìÅ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏–π –≤ —Ñ–∞–π–ª—ã")
        print("  üìÇ –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä—Ç–∏–π –∏–∑ —Ñ–∞–π–ª–æ–≤")
        print("  üìã –°–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–∏–π")
        print("  üîÑ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–≥—Ä—É –ø–æ–∑–∂–µ")
        
    except Exception as e:
        print(f"\n‚ùå –û—à–∏–±–∫–∞ –≤–æ –≤—Ä–µ–º—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏: {e}")
        import traceback
        traceback.print_exc()
        return False
    
    return True

def print_board(board):
    """–í—ã–≤–æ–¥ –¥–æ—Å–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª—å."""
    print("  a b c d e f g h")
    for i, row in enumerate(board):
        print(f"{8-i} ", end="")
        for cell in row:
            if cell is None:
                print(". ", end="")
            else:
                print(f"{cell} ", end="")
        print(f" {8-i}")
    print("  a b c d e f g h")

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏."""
    print("–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä—Ç–∏–π chess_stockfish")
    print("=" * 80)
    
    success = demonstrate_save_load_functionality()
    
    if success:
        print("\nüéâ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!")
        print("\n–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç:")
        print("  ‚Ä¢ –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–∞—Ä—Ç–∏–∏ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –ø–æ–∑–∂–µ")
        print("  ‚Ä¢ –ó–∞–≥—Ä—É–∂–∞—Ç—å —Ä–∞–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–∞—Ä—Ç–∏–∏")
        print("  ‚Ä¢ –£–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∏–≥—Ä")
        print("  ‚Ä¢ –ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å –∏–≥—Ä—É —Å –ª—é–±–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è")
    else:
        print("\n‚ùå –í–æ–∑–Ω–∏–∫–ª–∏ –æ—à–∏–±–∫–∏ –≤–æ –≤—Ä–µ–º—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏.")
        print("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã—à–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.")

if __name__ == "__main__":
    main()