#!/usr/bin/env python3
"""
–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ç–µ—Å—Ç –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –≤ –∏–≥—Ä–µ.
"""

import pygame
import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –º–æ–¥—É–ª—è–º –∏–≥—Ä—ã
sys.path.append(os.path.join(os.path.dirname(__file__), '..'))

from game.chess_game import ChessGame
from ui.board_renderer import BoardRenderer
from utils.sound_manager import SoundManager
from game.in_game_menu import InGameMenu
from game.menu import main_menu

def test_all_components():
    """–¢–µ—Å—Ç –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏–≥—Ä—ã."""
    pygame.init()
    
    try:
        print("üöÄ –ó–∞–ø—É—Å–∫ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞...")
        
        # –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Pygame
        print("–¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Pygame")
        assert pygame.get_init(), "Pygame –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"
        print("‚úÖ Pygame –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
        
        # –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —ç–∫—Ä–∞–Ω–∞
        print("–¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —ç–∫—Ä–∞–Ω–∞")
        screen = pygame.display.set_mode((512, 612))
        assert screen is not None, "–≠–∫—Ä–∞–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω"
        print("‚úÖ –≠–∫—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω")
        
        # –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–≤—É–∫–æ–≤–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
        print("–¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–≤—É–∫–æ–≤–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞")
        sound_manager = SoundManager()
        sound_manager.load_sounds()
        assert hasattr(sound_manager, 'sounds'), "–ú–µ–Ω–µ–¥–∂–µ—Ä –∑–≤—É–∫–æ–≤ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –∞—Ç—Ä–∏–±—É—Ç sounds"
        assert "button" in sound_manager.sounds, "–ú–µ–Ω–µ–¥–∂–µ—Ä –∑–≤—É–∫–æ–≤ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–≤—É–∫ –∫–Ω–æ–ø–∫–∏"
        print("‚úÖ –ó–≤—É–∫–æ–≤–æ–π –º–µ–Ω–µ–¥–∂–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç")
        
        # –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞
        print("–¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞")
        renderer = BoardRenderer(screen, 'white')
        assert renderer is not None, "–†–µ–Ω–¥–µ—Ä–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω"
        assert hasattr(renderer, 'effect_renderer'), "–†–µ–Ω–¥–µ—Ä–µ—Ä –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å effect_renderer"
        print("‚úÖ –†–µ–Ω–¥–µ—Ä–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç")
        
        # –¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–≥—Ä–æ–≤–æ–≥–æ –º–µ–Ω—é
        print("–¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–≥—Ä–æ–≤–æ–≥–æ –º–µ–Ω—é")
        menu = InGameMenu(screen, sound_manager)
        assert menu is not None, "–ú–µ–Ω—é –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–æ"
        assert len(menu.menu_items) > 0, "–ú–µ–Ω—é –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã"
        print("‚úÖ –ò–≥—Ä–æ–≤–æ–µ –º–µ–Ω—é —Ä–∞–±–æ—Ç–∞–µ—Ç")
        
        # –¢–µ—Å—Ç 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é
        print("–¢–µ—Å—Ç 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é")
        menu.show()
        assert menu.visible == True, "–ú–µ–Ω—é –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∏–¥–∏–º—ã–º –ø–æ—Å–ª–µ show()"
        menu.hide()
        assert menu.visible == False, "–ú–µ–Ω—é –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–∫—Ä—ã—Ç—ã–º –ø–æ—Å–ª–µ hide()"
        print("‚úÖ –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é —Ä–∞–±–æ—Ç–∞–µ—Ç")
        
        # –¢–µ—Å—Ç 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π –º–µ–Ω—é
        print("–¢–µ—Å—Ç 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π –º–µ–Ω—é")
        menu.show()
        # –°–æ–∑–¥–∞–µ–º —Ñ–∏–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
        event = pygame.event.Event(pygame.KEYDOWN, key=pygame.K_ESCAPE)
        result = menu.handle_event(event)
        assert menu.visible == False, "–ú–µ–Ω—é –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–∫—Ä—ã—Ç–æ –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è ESC"
        print("‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –º–µ–Ω—é —Ä–∞–±–æ—Ç–∞–µ—Ç")
        
        # –¢–µ—Å—Ç 8: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –º–µ–Ω—é
        print("–¢–µ—Å—Ç 8: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –º–µ–Ω—é")
        menu.show()
        menu.draw()
        # –ï—Å–ª–∏ –º—ã –¥–æ—à–ª–∏ –¥–æ —ç—Ç–æ–π —Ç–æ—á–∫–∏, –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
        print("‚úÖ –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –º–µ–Ω—é —Ä–∞–±–æ—Ç–∞–µ—Ç")
        
        # –¢–µ—Å—Ç 9: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–≤—É–∫–æ–≤
        print("–¢–µ—Å—Ç 9: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–≤—É–∫–æ–≤")
        sound_manager.play_sound("button")
        # –ï—Å–ª–∏ –º—ã –¥–æ—à–ª–∏ –¥–æ —ç—Ç–æ–π —Ç–æ—á–∫–∏, –∑–≤—É–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
        print("‚úÖ –ó–≤—É–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç")
        
        # –¢–µ—Å—Ç 10: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∑–≤—É–∫–∞
        print("–¢–µ—Å—Ç 10: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∑–≤—É–∫–∞")
        original_state = sound_manager.sound_enabled
        new_state = sound_manager.toggle_sound()
        assert new_state != original_state, "–°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–≤—É–∫–∞ –¥–æ–ª–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è"
        sound_manager.toggle_sound()  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ
        print("‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç")
        
        # –û—á–∏—â–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã
        pygame.quit()
        
        print("\nüéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!")
        print("‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
        print("‚úÖ –û—à–∏–±–∫–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã")
        
    except Exception as e:
        pygame.quit()
        print(f"\n‚ùå –¢–µ—Å—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω: {e}")
        import traceback
        traceback.print_exc()
        sys.exit(1)

if __name__ == "__main__":
    test_all_components()