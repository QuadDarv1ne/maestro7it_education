#!/usr/bin/env python3
"""
Integration test for the complete chess game system.
"""

import pygame
import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –º–æ–¥—É–ª—è–º –∏–≥—Ä—ã
sys.path.append(os.path.join(os.path.dirname(__file__), '..'))

from game.chess_game import ChessGame
from utils.sound_manager import SoundManager
from game.in_game_menu import InGameMenu

def test_integration():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤."""
    print("üöÄ –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞...")
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Pygame
    pygame.init()
    
    try:
        # –°–æ–∑–¥–∞–µ–º –∏–≥—Ä—É
        print("üéÆ –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã...")
        game = ChessGame(player_color='white', skill_level=1, theme='classic')
        print("‚úÖ –ò–≥—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∑–≤—É–∫–æ–≤
        assert hasattr(game, 'sound_manager'), "–ò–≥—Ä–∞ –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä –∑–≤—É–∫–æ–≤"
        assert isinstance(game.sound_manager, SoundManager), "–ú–µ–Ω–µ–¥–∂–µ—Ä –∑–≤—É–∫–æ–≤ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–º SoundManager"
        print("‚úÖ –ú–µ–Ω–µ–¥–∂–µ—Ä –∑–≤—É–∫–æ–≤ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏–≥—Ä–æ–≤–æ–≥–æ –º–µ–Ω—é
        assert hasattr(game, 'in_game_menu'), "–ò–≥—Ä–∞ –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å –∏–≥—Ä–æ–≤–æ–µ –º–µ–Ω—é"
        assert isinstance(game.in_game_menu, InGameMenu), "–ò–≥—Ä–æ–≤–æ–µ –º–µ–Ω—é –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–º InGameMenu"
        print("‚úÖ –ò–≥—Ä–æ–≤–æ–µ –º–µ–Ω—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∑–≤—É–∫–æ–≤ —Å –º–µ–Ω—é
        assert game.in_game_menu.sound_manager == game.sound_manager, "–ú–µ–Ω–µ–¥–∂–µ—Ä –∑–≤—É–∫–æ–≤ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–µ—Ä–µ–¥–∞–Ω –≤ –º–µ–Ω—é"
        print("‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∑–≤—É–∫–æ–≤ —Å –º–µ–Ω—é —É—Å–ø–µ—à–Ω–∞")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–Ω—é
        assert not game.in_game_menu.visible, "–ú–µ–Ω—é –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"
        print("‚úÖ –ú–µ–Ω—é —Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –º–µ–Ω—é
        game.in_game_menu.show()
        assert game.in_game_menu.visible, "–ú–µ–Ω—é –¥–æ–ª–∂–Ω–æ —Å—Ç–∞—Ç—å –≤–∏–¥–∏–º—ã–º"
        print("‚úÖ –ú–µ–Ω—é —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–∏–¥–∏–º—ã–º")
        
        game.in_game_menu.hide()
        assert not game.in_game_menu.visible, "–ú–µ–Ω—é –¥–æ–ª–∂–Ω–æ —Å—Ç–∞—Ç—å —Å–∫—Ä—ã—Ç—ã–º"
        print("‚úÖ –ú–µ–Ω—é —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–∫—Ä—ã—Ç—ã–º")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –º–µ–Ω—é
        menu_items = game.in_game_menu.menu_items
        assert len(menu_items) >= 5, "–ú–µ–Ω—é –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–∞–∫ –º–∏–Ω–∏–º—É–º 5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤"
        print(f"‚úÖ –ú–µ–Ω—é —Å–æ–¥–µ—Ä–∂–∏—Ç {len(menu_items)} —ç–ª–µ–º–µ–Ω—Ç–æ–≤")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        actions = [item['action'] for item in menu_items]
        assert 'resume' in actions, "–ú–µ–Ω—é –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ 'resume'"
        assert 'new_game' in actions, "–ú–µ–Ω—é –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ 'new_game'"
        assert 'main_menu' in actions, "–ú–µ–Ω—é –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ 'main_menu'"
        assert 'quit' in actions, "–ú–µ–Ω—é –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ 'quit'"
        print("‚úÖ –í—Å–µ –∫–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –º–µ–Ω—é –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç")
        
        # –û—á–∏—â–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã
        game.renderer.cleanup()
        pygame.quit()
        
        print("\nüéâ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ!")
        print("‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ")
        print("‚úÖ –ò–≥—Ä–æ–≤–æ–µ –º–µ–Ω—é —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
        print("‚úÖ –ú–µ–Ω–µ–¥–∂–µ—Ä –∑–≤—É–∫–æ–≤ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω")
        print("‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é")
        
    except Exception as e:
        pygame.quit()
        print(f"\n‚ùå –¢–µ—Å—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω: {e}")
        sys.exit(1)

if __name__ == "__main__":
    test_integration()