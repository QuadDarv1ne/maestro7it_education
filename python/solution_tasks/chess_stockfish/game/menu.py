# ============================================================================
# game/menu.py
# ============================================================================

"""
–ú–æ–¥—É–ª—å: game/menu.py

–û–ø–∏—Å–∞–Ω–∏–µ:
    –°–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–≥—Ä—ã.
    –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏–≥—Ä–æ–∫—É –≤—ã–±—Ä–∞—Ç—å:
    - –°—Ç–æ—Ä–æ–Ω—É (–±–µ–ª—ã–µ/—á—ë—Ä–Ω—ã–µ)
    - –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ Stockfish (0-20)
    - –†–µ–∂–∏–º –∏–≥—Ä—ã (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π, –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∏, –Ω–∞ –≤—Ä–µ–º—è, –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π)
    
–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
    - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞
    - –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞ –ø–æ —É—Ä–æ–≤–Ω—è–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
    - –ö—Ä–∞—Å–∏–≤–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∫–æ–Ω—Å–æ–ª–∏
"""

from typing import Tuple
from utils.game_stats import GameStatistics


def show_difficulty_guide():
    """
    –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É –ø–æ —É—Ä–æ–≤–Ω—è–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ Stockfish.
    
    –û–±—ä—è—Å–Ω—è–µ—Ç, —á—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç —Ä–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.
    """
    print("\nüìö –£—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ Stockfish:")
    print("   0-3   : –ù–æ–≤–∏—á–æ–∫ (–æ—á–µ–Ω—å –ª—ë–≥–∫–∏–π)")
    print("   4-7   : –õ—é–±–∏—Ç–µ–ª—å (–ª—ë–≥–∫–∏–π)")
    print("   8-11  : –°—Ä–µ–¥–Ω–∏–π (—É–º–µ—Ä–µ–Ω–Ω—ã–π)")
    print("   12-15 : –°–∏–ª—å–Ω—ã–π (—Å–ª–æ–∂–Ω—ã–π)")
    print("   16-20 : –≠–∫—Å–ø–µ—Ä—Ç (–æ—á–µ–Ω—å —Å–ª–æ–∂–Ω—ã–π)")
    print()


def show_game_modes():
    """
    –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É –ø–æ —Ä–µ–∂–∏–º–∞–º –∏–≥—Ä—ã.
    
    –û–±—ä—è—Å–Ω—è–µ—Ç, —á—Ç–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Å–æ–±–æ–π —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ä–µ–∂–∏–º—ã –∏–≥—Ä—ã.
    """
    print("\nüéÆ –†–µ–∂–∏–º—ã –∏–≥—Ä—ã:")
    print("   classic     : –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∏–≥—Ä–∞ –ø—Ä–æ—Ç–∏–≤ Stockfish")
    print("   puzzle      : –†–µ—à–µ–Ω–∏–µ —à–∞—Ö–º–∞—Ç–Ω—ã—Ö –≥–æ–ª–æ–≤–æ–ª–æ–º–æ–∫")
    print("   timed       : –ò–≥—Ä–∞ –Ω–∞ –≤—Ä–µ–º—è (–±–ª–∏—Ü, —Ä–∞–ø–∏–¥, –ø—É–ª—è)")
    print("   adaptive    : –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥ –≤–∞—à —É—Ä–æ–≤–µ–Ω—å")
    print()


def show_stats():
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä."""
    try:
        stats = GameStatistics()
        summary = stats.get_summary()
        print(f"\nüìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä:")
        print(f"   –í—Å–µ–≥–æ –∏–≥—Ä: {summary['total_games']}")
        print(f"   –ü–æ–±–µ–¥: {summary['total_wins']}")
        print(f"   –ü–æ—Ä–∞–∂–µ–Ω–∏–π: {summary['total_losses']}")
        print(f"   –ù–∏—á—å–∏—Ö: {summary['total_draws']}")
        if summary['total_games'] > 0:
            print(f"   –ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥: {summary['win_rate']:.1f}%")
        print()
        
        # –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —É—Ä–æ–≤–Ω—è–º
        level_stats = stats.get_level_performance()
        if level_stats:
            print("üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —É—Ä–æ–≤–Ω—è–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:")
            for level in sorted(level_stats.keys()):
                ls = level_stats[level]
                print(f"   –£—Ä–æ–≤–µ–Ω—å {level}: {ls['wins']}/{ls['total']} –ø–æ–±–µ–¥ ({ls['win_rate']:.1f}%)")
            print()
    except Exception as e:
        print(f"‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: {e}")


def main_menu() -> Tuple[str, int, str, str]:
    """
    –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–≥—Ä—ã.
    
    –í—ã–≤–æ–¥–∏—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, —Å–ø—Ä–∞–≤–∫—É –∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–≥—Ä—ã.
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
        Tuple[str, int, str, str]: –ö–æ—Ä—Ç–µ–∂ (color, skill_level, theme, game_mode)
            - color: 'white' –∏–ª–∏ 'black'
            - skill_level: —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (0-20)
            - theme: —Ü–≤–µ—Ç–æ–≤–∞—è —Ç–µ–º–∞
            - game_mode: —Ä–µ–∂–∏–º –∏–≥—Ä—ã ('classic', 'puzzle', 'timed', 'adaptive')
    """
    print("\n" + "="*70)
    print("‚ôüÔ∏è  chess_stockfish ‚Äî –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø ‚Äî Maestro7IT Education")
    print("="*70)
    print("\nüéØ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —à–∞—Ö–º–∞—Ç–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä —Å–æ Stockfish!\n")
    print("‚ú® –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–ª—É—á—à–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏:")
    print("   ‚úì –û—Ü–µ–Ω–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏")
    print("   ‚úì –í—ã–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ö–æ–¥–æ–≤")
    print("   ‚úì –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π")
    print("   ‚úì –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω (–±–µ–ª—ã–µ/—á—ë—Ä–Ω—ã–µ)")
    print("   ‚úì –†–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (0-20)")
    print("   ‚úì –ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤ –∏ –ø–æ–∑–∏—Ü–∏–π")
    print("   ‚úì –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å")
    print("   ‚úì –ù–æ–≤—ã–µ —Ä–µ–∂–∏–º—ã –∏–≥—Ä—ã: –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∏, –Ω–∞ –≤—Ä–µ–º—è, –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π")
    print()
    
    # –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    show_stats()
    
    show_difficulty_guide()
    show_game_modes()
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    player_color = 'white'
    level = 5
    theme = 'classic'
    game_mode = 'classic'
    
    # –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –∏–≥—Ä—ã
    while True:
        mode_input = input("–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –∏–≥—Ä—ã (classic/puzzle/timed/adaptive): ").strip().lower()
        if mode_input in ('classic', 'puzzle', 'timed', 'adaptive'):
            game_mode = mode_input
            break
        else:
            print("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥! –í–≤–µ–¥–∏—Ç–µ 'classic', 'puzzle', 'timed' –∏–ª–∏ 'adaptive'")
    
    # –î–ª—è —Ä–µ–∂–∏–º–∞ –≥–æ–ª–æ–≤–æ–ª–æ–º–æ–∫ –∏ —É—Ä–æ–≤–Ω—è
    if game_mode == 'puzzle':
        # –í—ã–±–æ—Ä —Ç–µ–º—ã
        print("\nüé® –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–º—ã: classic, dark, blue, green, contrast, purple, wood, sunset")
        theme_input = input("–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é classic): ").strip().lower()
        if theme_input in ('classic', 'dark', 'blue', 'green', 'contrast', 'purple', 'wood', 'sunset'):
            theme = theme_input
        else:
            theme = 'classic'
            
        print(f"\n‚úÖ –†–µ–∂–∏–º –≥–æ–ª–æ–≤–æ–ª–æ–º–æ–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å —Ç–µ–º–æ–π: {theme}")
        print(f"\n{'='*70}\n")
        return 'white', 10, theme, 'puzzle'  # –î–ª—è –≥–æ–ª–æ–≤–æ–ª–æ–º–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    
    # –î–ª—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ —Ç—Ä–µ–±—É—é—Ç—Å—è –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    if game_mode in ('classic', 'adaptive'):
        # –í—ã–±–æ—Ä —Å—Ç–æ—Ä–æ–Ω—ã
        while True:
            side_input = input("–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–æ—Ä–æ–Ω—É (white/w, black/b): ").strip().lower()
            if side_input in ('white', 'w'):
                player_color = 'white'
                break
            elif side_input in ('black', 'b'):
                player_color = 'black'
                break
            else:
                print("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥! –í–≤–µ–¥–∏—Ç–µ 'white' (–∏–ª–∏ 'w') –∏–ª–∏ 'black' (–∏–ª–∏ 'b')")
        
        # –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        while True:
            try:
                level_input = input("\n–£—Ä–æ–≤–µ–Ω—å Stockfish (0-20, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 5-10): ").strip()
                if level_input == '':
                    level = 5  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å
                    break
                level = int(level_input)
                if 0 <= level <= 20:
                    break
                else:
                    print("‚ùå –£—Ä–æ–≤–µ–Ω—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 0 –¥–æ 20")
            except ValueError:
                print("‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 20")
    
    # –î–ª—è —Ä–µ–∂–∏–º–∞ –Ω–∞ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    elif game_mode == 'timed':
        # –í—ã–±–æ—Ä —Å—Ç–æ—Ä–æ–Ω—ã
        while True:
            side_input = input("–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–æ—Ä–æ–Ω—É (white/w, black/b): ").strip().lower()
            if side_input in ('white', 'w'):
                player_color = 'white'
                break
            elif side_input in ('black', 'b'):
                player_color = 'black'
                break
            else:
                print("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥! –í–≤–µ–¥–∏—Ç–µ 'white' (–∏–ª–∏ 'w') –∏–ª–∏ 'black' (–∏–ª–∏ 'b')")
        
        # –î–ª—è —Ä–µ–∂–∏–º–∞ –Ω–∞ –≤—Ä–µ–º—è —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω
        level = 10  # –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –¥–ª—è —Ä–µ–∂–∏–º–∞ –Ω–∞ –≤—Ä–µ–º—è
    
    # –í—ã–±–æ—Ä —Ç–µ–º—ã
    print("\nüé® –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–º—ã: classic, dark, blue, green, contrast, purple, wood, sunset")
    theme_input = input("–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é classic): ").strip().lower()
    if theme_input in ('classic', 'dark', 'blue', 'green', 'contrast', 'purple', 'wood', 'sunset'):
        theme = theme_input
    else:
        theme = 'classic'
    
    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    print(f"\n‚úÖ –ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è:")
    print(f"   –†–µ–∂–∏–º: {game_mode}")
    print(f"   –í—ã: {player_color.upper()}")
    print(f"   –ü–ö: {('BLACK' if player_color == 'white' else 'WHITE')}")
    print(f"   –£—Ä–æ–≤–µ–Ω—å: {level}/20")
    print(f"   –¢–µ–º–∞: {theme}")
    print(f"\n{'='*70}\n")
    
    return player_color, level, theme, game_mode